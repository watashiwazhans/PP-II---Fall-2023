'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[8],{1493:function(E,M,c){c.r(M);c.d(M,"RtcUtils",function(){return l});E=c(0);var m=c(7),e=c(1523),a=c(35);class l{static s6e(y,z=e.RealtimeChannel.nMf){let n;try{n=a.c(y)}catch(v){throw y=String.format("Failed to JSON-serialize payload : {0}",v),m.ULS.sendTraceTag(18637072,500,10,y),Error.argument("payload",y);}if(n.length>z)throw y=String.format("Payload exceeds maximum length: {0} > {1}.",n.length,z),m.ULS.sendTraceTag(18637074,
500,10,y),Error.argument("payload",y);return n}static deserialize(y,z,n){if(!y)return null;if(Object.getType(y)!==String){var v=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}].",z,Object.getType(y).getName(),n);m.ULS.sendTraceTag(18637075,500,10,v);return null}v=null;try{v=a.a(y)}catch(A){y=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}].",z,A,n),m.ULS.sendTraceTag(18637077,
500,10,y)}return v}static fec(y){if(!y)return"";if("string"===typeof y)return y.toString();try{return a.c(y)}catch(z){return y.toString()}}static Hxl(y){let z,n,v;z=0;v=n=null;if(!y)return{Wni:z,Yni:n,exception:v};try{const A=y.source;A&&Object.getType(A)===String&&(v=A);const w=y.context;w&&(y=w,z=y.status?y.status:0,n=y.statusText?y.statusText:null)}catch(A){}return{Wni:z,Yni:n,exception:v}}}Object(E.a)(l,"RtcUtils",null,[])},1513:function(E,M,c){c.r(M);E=c(0);var m=c(7),e=c(55),a=c(82),l;(function(v){v[v.SendNotification=
0]="SendNotification";v[v.SendPersistentState=1]="SendPersistentState";v[v.FindSession=2]="FindSession";v[v.Last=3]="Last"})(l||(l={}));Object(E.b)("ApiType",l);var y;(function(v){v[v.AttemptCount=0]="AttemptCount";v[v.SuccessCount=1]="SuccessCount";v[v.DropCount=2]="DropCount";v[v.FailedCount=3]="FailedCount";v[v.LatencyOverThresholdCount=4]="LatencyOverThresholdCount";v[v.LatencyUnderThresholdCount=5]="LatencyUnderThresholdCount";v[v.ThrottledCount=6]="ThrottledCount";v[v.Last=7]="Last"})(y||(y=
{}));Object(E.b)("EventCountType",y);var z=c(1612);c.d(M,"FrequentLoggingMetrics",function(){return n});class n{constructor(v){this.XGh=this.TZh=null;this.mMi=this.M1h=0;this.Kt=null;this.o5g=this.dJe=0;this.Wf=v;this.Lxm();this.Qze=this.ZUg=this.NJe=!1;this.rwc=0}get Zwl(){return this.Qze}Wzo(v){this.o5g=v;window.setInterval(Object(e.a)(this,this.BKf,"logMetricsBatchAndReset"),v);this.dJe=(new Date).getTime()}UO(v,A){this.Goo(v)&&!this.ZUg||this.Zwl||!window.navigator.onLine||this.Wf.gQa||(this.Kt[v][A]++,
this.NJe=!0)}Lxm(){this.Kt=Array(3);for(let v=0;3>v;v++){this.Kt[v]=Array(7);for(let A=0;7>A;A++)this.Kt[v][A]=0}}GMk(){const v={};for(let A=0;3>A;A++)for(let w=0;7>w;w++)this.YSm(A,w)&&(v[l[A]+y[w]]=this.Kt[A][w]);v.FSDomain=this.TZh;v.ConnectionDomain=this.XGh;v.FSRetryInterval=this.M1h;v.MaxPayloadSize=this.mMi;v.LogNumber=this.rwc;1===this.rwc&&(v.FSLatencies=z.a.instance.aVl(),v.ConLatencies=z.a.instance.IPl());return v}YSm(v,A){return 2===v&&3!==A&&0!==A?!1:!0}Goo(v){return 2===v?!1:!0}BKf(){if(this.NJe){this.rwc++;
if((new Date).getTime()-this.dJe<5E3+this.o5g){var v=a.a.toJSON(this.GMk());m.ULS.sendTraceTag(50644352,500,15,v)}this.dJe=(new Date).getTime();for(v=0;3>v;v++)for(let A=0;7>A;A++)this.Kt[v][A]=0;this.NJe=!1}}N8m(){this.ZUg=!0}static get instance(){return n._instance}static create(v){n.instance||(n._instance=new n(v));return n.instance}}n._instance=null;Object(E.a)(n,"FrequentLoggingMetrics",null,[888])},1523:function(E,M,c){c.r(M);E=c(0);var m=c(7),e=c(55),a=c(457),l=c(872),y=c(77),z=c(2);class n{constructor(oa,
Ca){this.status=oa;this.qcc=Ca}}Object(E.a)(n,"UserStatusInfo",null,[]);var v=c(57),A=c(1612);class w{constructor(oa,Ca){this.data=oa;this.timeStamp=Ca}}Object(E.a)(w,"PresenceData",null,[]);class G{constructor(oa){this.GBa=!1;this.Vxb=0;this.Nve=!1;this.setTimeout=G.Scf;this.clearTimeout=G.Lcf;this.f6m=Object(e.a)(this,this.U4m,"logRtcConnectingUsageStatement");this.Bw=oa}Gkn(){this.GBa||(this.Vxb=this.setTimeout(()=>{this.GBa=!1;this.EJi()},8E3),this.GBa=!0,this.Nve=!1)}zln(){this.f_()}zsn(){this.EJi()}EJi(){this.f_();
this.Nve||(this.Nve=!0,this.f6m())}U4m(){m.ULS.sendTraceTag(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",this.Bw)}f_(){this.GBa&&this.clearTimeout(this.Vxb);this.Vxb=0;this.GBa=!1}static Scf(oa,Ca){return window.setTimeout(oa,Ca)}static Lcf(oa){window.clearTimeout(oa)}}Object(E.a)(G,"ConnectedUsageKpiLogger",null,[906]);class F{constructor(){this.v6i=this.e3f;this.y6i=this.h3f;this.x6i=this.g3f;this.C6i=this.j3f;this.B6i=this.i3f;this.u3f=this.v3f;this.m3c=this.s3f;this.mMb=
this.q3f;this.nMb=this.r3f;this.w6i=this.f3f;this.kRa=this.qQf;this.slb=this.rQf}e3f(){}h3f(){}g3f(){}j3f(){}i3f(){}s3f(){}r3f(){}q3f(){}v3f(){}f3f(){}qQf(){}rQf(){}}Object(E.a)(F,"NoopRealtimeChannelMetrics",null,[898,232]);class I{}I.Kad="presenceUpdated";I.updateNotification="updateNotification";I.r0i="persistentStateCleared";I.updatePersistentState="persistentStateUpdated";Object(E.a)(I,"RtcClientMethodNames",null,[]);class K{}K.vsm="realtimeChannelHub";K.Kad="UpdatePresence";K.XM="SendUpdateNotification";
K.gof="GetCompletePersistentStateWithMetadata";K.updatePersistentState="UpdatePersistentState";K.cqb="UpdateClientInfo";Object(E.a)(K,"RtcHubMethodNames",null,[]);class J{constructor(oa){this.Uv=oa}hVn(oa){this.Uv.on(I.Kad,oa)}bWn(oa){this.Uv.on(I.updateNotification,oa)}gVn(oa){this.Uv.on(I.updatePersistentState,oa)}fVn(oa){this.Uv.on(I.r0i,oa)}KPo(oa){this.Uv.off(I.Kad,oa)}UPo(oa){this.Uv.off(I.updateNotification,oa)}JPo(oa){this.Uv.off(I.updatePersistentState,oa)}IPo(oa){this.Uv.off(I.r0i,oa)}Kad(oa){return this.Uv.invoke(K.Kad,
oa)}cqb(oa){return this.Uv.invoke(K.cqb,oa)}XM(oa,Ca){return this.Uv.invoke(K.XM,oa,Ca)}gof(oa){return this.Uv.invoke(K.gof,oa)}updatePersistentState(oa,Ca){return this.Uv.invoke(K.updatePersistentState,oa,Ca)}}Object(E.a)(J,"RealtimeChannelProxy",null,[903,904,905]);class N{constructor(){this.kte=this.ZLg=!1;this.ite=0;this.cve=this.FRe=this.ERe=this.kse=!1;this.qAe=0;this.ydh=!1;this.xdh=this.wdh=0;this.aQe=!1;this.hQe=this.fQe=this.jQe=this.bQe=0;this.gQe=!1}get OHk(){return this.kte}get NHk(){return this.ite}get nAk(){return this.kse}get jqo(){return this.ERe}get kqo(){return this.FRe}get bYk(){return this.cve}get aMd(){return this.qAe}get E7n(){return this.ydh}get Jej(){return this.wdh}get D7n(){return this.xdh}get z7n(){return this.aQe}get A7n(){return this.bQe}get Pej(){return this.jQe}get Kej(){return this.fQe}get Mej(){return this.hQe}get Lej(){return this.gQe}static createInstance(oa){const {RealtimeChannel:Ca}=
c(1523);return oa?Object.assign(new N,{ZLg:oa.$("AwayStatusManagerIsEnabled"),kte:oa.$("AwayStatusOneMinuteTimeoutIsEnabled"),ite:oa.mc("AwayCoauthorThresholdMs",9E5),kse:oa.$("RtcAllowCrossDomainAccessEnabled"),ERe:oa.$("ShouldLogOnContentNotification"),FRe:oa.$("ShouldLogOnHostSubscriptionNotification"),cve:oa.$("RtcClientMetricsEnabled"),qAe:oa.mc("RtcFindSessionRequestTimeoutInMS",6E4),ydh:oa.$("RtcJsClientFrequentlyLogsMetrics"),wdh:oa.mc("RtcJsClientFrequentMetricsLatencyThresholdInMS",1E3),
xdh:oa.mc("RtcJsClientFrequentMetricsLogIntervalInMS",3E5),aQe:oa.$("RtcClientMessageTelemetryEnabled"),bQe:oa.mc("RtcClientMessageTelemetrySampleSize",5),jQe:oa.mc("RtcSendTelemetryMessageIntervalInMS",3E5),fQe:oa.mc("RtcLogClientMessageMetricsTimeOutInMs",2E4),hQe:oa.mc("RtcMaxPayloadSizeInCharactersOverride",Ca.nMf),gQe:oa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RTCLogSignalrHeartBeatMessages",!1)}):Object.assign(new N,{ZLg:!1,kte:!1,ite:9E5,kse:!1,ERe:!1,FRe:!0,cve:!1,qAe:9E4,aQe:!1,
bQe:5,jQe:3E5,fQe:2E4,hQe:Ca.nMf,gQe:!1})}}Object(E.a)(N,"RealtimeChannelSettings",null,[902]);var R=c(1740),O=c(73),L=c(150);class U{constructor(oa){this.PBc=null;this.JSa=0;this.FCb=!1;this.Im=oa;this.Im.Ata(Object(e.a)(this,this.Qha,"onConnectionStateChanged"))}Qha(oa,Ca){this.JSa=Ca.newState}ftn(){m.ULS.sendTraceTag(18637070,500,15,"Too many undelivered messages. Restarting RTC connection.");this.Im.Xbe()}hwm(oa){this.PBc.init(oa)}}Object(E.a)(U,"ARtcMessageHandler",null,[]);var W=c(353);class X{constructor(){this.Presence=
null;this.TimeStamp=0}}Object(E.a)(X,"PresenceDataEntryForClients",null,[]);var V=c(82);class Z{constructor(oa,Ca=""){this.thk=oa;this.vsa=Ca}send(){return this.thk()}get messageId(){return this.vsa}}Object(E.a)(Z,"MessageHandler",null,[914]);var da=c(1642);class aa extends Sys.EventArgs{constructor(oa,Ca,Aa,db){super();this.F6f=oa;this.reconnectDelay=Ca;this.reason=Aa;this.S9f=db}}Object(E.a)(aa,"RefreshConnectionReconnectArgs",Sys.EventArgs,[]);var ea=c(1696);class na{constructor(){this.ZSe=this.ji=
null}get si(){return this.ji?this.ZSe?this.ZSe.getTime()-this.ji.getTime():(new Date).getTime()-this.ji.getTime():0}start(){this.ji=new Date}stop(){this.ZSe=new Date}}Object(E.a)(na,"SimpleStopwatch",null,[]);var pa=c(1697),ja;(function(oa){oa[oa.contentUpdate=0]="contentUpdate";oa[oa.editorsTableUpdate=1]="editorsTableUpdate";oa[oa.fileNameUpdate=2]="fileNameUpdate";oa[oa.wetContentUpdate=3]="wetContentUpdate";oa[oa.persistedContentUpdate=4]="persistedContentUpdate";oa[oa.clientRtcReconnectRequest=
5]="clientRtcReconnectRequest";oa[oa.replicationTelemetry=6]="replicationTelemetry";oa[oa.lockUpdate=7]="lockUpdate";oa[oa.collabServiceContentUpdate=8]="collabServiceContentUpdate";oa[oa.trackChangeSettingUpdate=9]="trackChangeSettingUpdate";oa[oa.saveTargetUpdate=10]="saveTargetUpdate";oa[oa.uploadToOcsUpdate=11]="uploadToOcsUpdate";oa[oa.labelUpdate=12]="labelUpdate";oa[oa.hostNotificationSubscriptionStatus=13]="hostNotificationSubscriptionStatus";oa[oa.subscribeOrExtend=14]="subscribeOrExtend";
oa[oa.elapsedBootTelemetry=15]="elapsedBootTelemetry";oa[oa.clientToClientTelemetryMessage=16]="clientToClientTelemetryMessage";oa[oa.clientToClientResponseMessage=17]="clientToClientResponseMessage";oa[oa.verifyNotificationPipeline=18]="verifyNotificationPipeline";oa[oa.hostNotificationHeartbeat=19]="hostNotificationHeartbeat";oa[oa.secondaryMetadataUpdate=20]="secondaryMetadataUpdate";oa[oa.last=21]="last"})(ja||(ja={}));Object(E.b)("UpdateNotificationType",ja);var ma=c(751),Ia=c(595),Ja=c(596);
class Ka extends U{constructor(oa,Ca,Aa,db,eb,ib,lb,Ya,Fa,$a){super(lb);this.Uv=null;this.f5g=!1;this.vsa=0;this.hNe=new L.a;this.e9j=Ka.jQl();this.pMe=z.AFrameworkApplication.K.jb("OwningFeatureCrewForRtcNotificationKpis");this.Sd=oa;this.N7g=this.M7g=0;this.PBc=Ca;this.PBc.Gzd(Object(e.a)(this,this.ftn,"onTooManyUndeliveredMessages"));this._clientId=Aa;this.Zek=eb;this.Im.Kxk(Object(e.a)(this,this.Eqn,"onRefreshProxyRequired"));this.Im.Ixk(Object(e.a)(this,this.Cqn,"onRefreshAllPersistentStateRequest"));
this.Im.Sxk(Object(e.a)(this,this.XM,"sendUpdateNotification"));this.Im.Lvk(Object(e.a)(this,this.Knn,"onInternalPresenceUpdated"));this.Im.Mvk(Object(e.a)(this,this.Lnn,"onInternalUpdateNotificationReceived"));this.Im.Kvk(Object(e.a)(this,this.Jnn,"onInternalPersistentStateUpdated"));this.Im.Jvk(Object(e.a)(this,this.Inn,"onInternalPersistentStateCleared"));this.Im.Qxk(Object(e.a)(this,this.gic,"sendPersistentState"));this.Im.fyk(Object(e.a)(this,this.cqb,"updateClientInfo"));this.he=ib;this.Bw=
db;this.Kt=Ya;this.PV=Fa;this.Pwc=$a;this.ora=Object(O.a)(String,z.AFrameworkApplication.sessionStartInfoSettings.Application)||""}Eqn(oa,Ca){this.Uv=this.Zek(Ca.hubConnection);this.PBc.reset();this.Uv.hVn(Object(e.a)(this,this.E4,"onPresenceUpdated"));this.Uv.gVn(Object(e.a)(this,this.ARa,"onPersistentStateUpdated"));this.Uv.fVn(Object(e.a)(this,this.Dec,"onPersistentStateCleared"));this.Uv.bWn(Object(e.a)(this,this.w0,"onUpdateNotificationReceived"))}Qha(oa,Ca){this.JSa=Ca.newState;2===Ca.newState&&
this.Rbo()}Rbo(){for(let oa of this.hNe)this.XM(null,new ea.a(oa.key,oa.value,!1,new a.a));this.hNe=new L.a}Cqn(oa,Ca){Ca.X6e();for(oa=0;3>oa;++oa)this.ubo(oa,Ca)}ubo(oa,Ca){try{this.Uv.gof(oa).done(Aa=>{Ca.Mmc(Ca.V8e,"GetCompletePresenceSuccess")&&(Ca.G2k.zsn(),m.ULS.sendTraceTag(3249540,500,50,"Successfully retrieved complete session state for [{0}]",this.Bw),this.Im.vMn(),this.Kpn(oa,Aa),this.Im.LLn(Aa),Ca.wXh.nb(oa)&&this.Im.u5i(oa,Ca.wXh.J(oa),new a.a))}).fail(Aa=>{const {RtcUtils:db}=c(1493);
Ca.Mmc(Ca.V8e,"GetCompletePresenceFail")&&(m.ULS.sendTraceTag(3249541,500,15,"Failed to retrieve complete session state : {0} for [{1}]",db.fec(Aa),this.Bw),this.Im.Xbe())}).always(()=>{Ca.NA&&Ca.NA.stop()})}catch(Aa){m.ULS.sendTraceTag(595132428,500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",Ca.V8e,Aa.message)}}gic(oa,Ca){var {RtcUtils:Aa}=c(1493);oa=Ca.presence;let db;const eb=
Ca.i7a;this.PV.UO(1,0);try{db=Aa.s6e(oa,this.Pwc)}catch(lb){this.PV.UO(1,3);m.ULS.sendTraceTag(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",lb.message);eb.setException(lb);return}Aa=new y.a;Aa.Z(this._clientId,Object.assign(new X,{Presence:oa,TimeStamp:(new Date).getTime()}));this.Im.B5i(Ca.type,Aa);if(2!==this.JSa)this.Kt.mMb(),this.PV.UO(1,2),eb.Ag(null);else{var ib=this.vsa.toString();++this.vsa;oa=new Z(()=>this.Tbo(Ca.type,db,ib),ib);oa=this.Wxj(0,
Ca.type).add(oa);oa.d7d(lb=>{2===lb&&this.PV.UO(1,6);eb.Ag(null)});oa.c7d(()=>{})}}Tbo(oa,Ca,Aa){let db=null;const eb=new na,ib=new da.a;m.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}]",this.Bw);if(2!==this.JSa)return this.Kt.mMb(),this.PV.UO(1,2),m.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}]",this.Bw),ib.aMf(),ib;this.he&&20>this.M7g&&(db=this.he.Zf("WebServiceCall","Send Presence Message"),this.M7g++);eb.start();ib.nYc(1);try{this.Uv.updatePersistentState(oa,
Ca).done(()=>{this.Kt.m3c();this.PV.UO(1,1);m.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}]",Aa,this.Bw);ib.alb(1);eb&&(eb.stop(),eb.si>this.Sd.Jej?this.PV.UO(1,4):this.PV.UO(1,5))}).fail(lb=>{const {RtcUtils:Ya}=c(1493);this.FCb||(this.Kt.mMb(),this.PV.UO(1,3),m.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",Aa,Ya.fec(lb),this.Bw));ib.alb(2)}).always(()=>{db&&db.stop()})}catch(lb){m.ULS.sendTraceTag(593072906,
500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",lb.message),this.PV.UO(1,3),ib.alb(2)}return ib}cqb(oa,Ca){({RtcUtils:oa}=c(1493));const Aa=Ca.aYk,db=Ca.i7a;let eb;try{eb=oa.s6e(Aa,this.Pwc)}catch(ib){m.ULS.sendTraceTag(544318999,500,10,"Exception thrown while trying to serialize clientInfo. Exception message: {0}",ib.message);db.setException(ib);return}try{this.Uv.cqb(eb).done(()=>{m.ULS.sendTraceTag(544319E3,500,50,"Successfully delivered clientInfo.")}).fail(ib=>{const {RtcUtils:lb}=
c(1493);this.FCb||m.ULS.sendTraceTag(544319001,500,15,"Server failed to process udpate clientInfo: {0}.",lb.fec(ib));db.Ag(null)})}catch(ib){m.ULS.sendTraceTag(544319002,500,15,"Exception when invoking hub method UpdateClientInfo: error: {0}",ib.message),db.Ag(null)}}XM(oa,Ca){({RtcUtils:oa}=c(1493));const Aa=Ca.type,db=Ca.tL,eb=Ca.gjl,ib=Ca.i7a;let lb;this.PV.UO(0,0);try{lb=oa.s6e(db,this.Pwc)}catch(Fa){this.PV.UO(0,3);m.ULS.sendTraceTag(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",
Fa.message);ib.setException(Fa);return}if(2!==this.JSa)eb?this.hNe.Z(Aa,db):(this.Kt.mMb(),this.PV.UO(0,2)),ib.Ag(null);else{var Ya=this.vsa.toString();++this.vsa;Ca=new Z(()=>this.Hco(Aa,lb,Ya),Ya);Ca=this.Wxj(1,Aa).add(Ca);Ca.d7d(Fa=>{2===Fa&&this.PV.UO(0,6);ib.Ag(null)});Ca.c7d(()=>{})}}Hco(oa,Ca,Aa){let db=null;const eb=new na,ib=new da.a;m.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}]",this.Bw);if(2!==this.JSa)return this.Kt.mMb(),this.PV.UO(0,2),m.ULS.sendTraceTag(7934172,
500,15,"Connection is lost - unable to send the message for [{0}]",this.Bw),ib.aMf(),ib;this.he&&3===oa&&20>this.N7g&&(db=this.he.Zf("WebServiceCall","Send WetContent Update"),this.N7g++);eb.start();ib.nYc(1);this.Uv.XM(oa,Ca).done(()=>{this.Kt.m3c();this.PV.UO(0,1);m.ULS.sendTraceTag(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}]",Aa,this.Bw);ib.alb(1);eb&&(eb.stop(),eb.si>this.Sd.Jej?this.PV.UO(0,4):this.PV.UO(0,5))}).fail(lb=>{const {RtcUtils:Ya}=c(1493);this.FCb||
(this.Kt.mMb(),this.PV.UO(0,3),m.ULS.sendTraceTag(3249507,500,15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",Aa,Ya.fec(lb),this.Bw));ib.alb(2)}).always(()=>{db&&db.stop()});return ib}sja(){this.Uv.KPo(Object(e.a)(this,this.E4,"onPresenceUpdated"));this.Uv.JPo(Object(e.a)(this,this.ARa,"onPersistentStateUpdated"));this.Uv.IPo(Object(e.a)(this,this.Dec,"onPersistentStateCleared"));this.Uv.UPo(Object(e.a)(this,this.w0,"onUpdateNotificationReceived"))}Knn(oa,Ca){this.E4(Ca.Sqa,
Ca.HId)}E4(oa){this.Kt.nMb();this.ARa(0,oa)}Jnn(oa,Ca){this.ARa(Ca.type,Ca.Sqa)}Kpn(oa,Ca){const Aa={};for(let db in Ca)Aa[db]=Ca[db].Presence;this.lVi(oa,Aa,Ca)}ARa(oa,Ca){this.Kt.nMb();this.lVi(oa,Ca)}lVi(oa,Ca,Aa=null){var {RtcUtils:db}=c(1493);if(m.ULS.M9(500,100))for(var eb in Ca);delete Ca[this._clientId];if(!V.a.isEmpty(Ca)){for(var ib in Ca)eb=ib,Ca[eb]=db.deserialize(Ca[ib],"Presence",eb,!1,this.Pwc);db=new y.a;ib=(new Date).getTime();for(let lb in Ca){eb=Ca[lb];let Ya=lb,Fa;Aa?(Fa=Aa[Ya],
Fa.Presence=eb):Fa=Object.assign(new X,{Presence:eb,TimeStamp:ib});db.Z(Ya,Fa)}this.Im.B5i(oa,db);switch(oa){case 0:this.f5g||(m.ULS.sendTraceTag(4539734,500,50,"Raising first presence update notification for [{0}]",this.Bw),this.f5g=!0,z.AFrameworkApplication.Kg&&z.AFrameworkApplication.Kg.G8m());this.Im.n5i(Ca,[]);break;default:this.Im.mMn(oa,Ca)}}}Inn(oa,Ca){this.Dec(Ca.QDd)}Dec(oa){this.Kt.nMb();if(m.ULS.M9(500,100))for(let Ca=0;Ca<oa.length;++Ca);oa.length&&(this.Im.LMn(oa),this.Im.lMn(oa),this.Im.n5i({},
oa))}Lnn(oa,Ca){this.w0(Ca.type,Ca.tL)}w0(oa,Ca=null){this.Sd.jqo&&0===oa&&m.ULS.sendTraceTag(40128990,500,50,"Received ContentUpdate notification from the server");if(0===oa&&this.pMe&&0<this.pMe.length){var Aa=Object.assign(new ma.a,{topLevelKpiName:"ContentUpdateNotificationReceived",featureName:"RtcNotification",crewAlias:this.pMe,vetoPillar:"RealTimeCoauth"});(Aa=W.a.getInstance(Aa))&&Aa.logKpiUsage(this.e9j)}this.Sd.kqo&&13===oa&&m.ULS.sendTraceTag(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",
Ca||"<none>"));this.Kt.nMb();5===oa?(Ca=(oa=this.Vyn(Ca))?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",oa.reason,oa.reconnectDelay):"Received client reconnection request from the server without params.",m.ULS.sendTraceTag(18637071,500,50,Ca),this.Im.Xbe(oa)):(Ca=c(1493).RtcUtils.deserialize(Ca,String.format("UpdateNotification-{0}",ja[oa]),null,!1,this.Pwc),this.Im.KMn(oa,Ca))}Vyn(oa){try{if(!oa||""===oa)return null;const Ca=JSON.parse(oa);
return new aa(Ca[pa.a.E8f],Ca[pa.a.y7n],Ca[pa.a.C7n],Ca[pa.a.S9f])}catch(Ca){return m.ULS.sendTraceTag(593844380,500,15,"Error when parsing reconnect hint: {0}",Ca.message),null}}Wxj(oa,Ca){return this.PBc.pem(this.qem(oa,Ca))}qem(oa,Ca){return oa+","+Ca}static jQl(){var oa=new Map;oa.set("SkipAria","True");oa=Object.assign(new Ia.a,{extendedProperties:oa});return Object.assign(new Ja.a,{kpiName:"ContentUpdateNotificationReceived",kpiType:0,optionalProperties:oa,blockFutureEmissionDurationInMs:3E5})}}
Object(E.a)(Ka,"RtcMessageHandler",U,[]);class Ma{vLh(oa,Ca=""){const {MaxOutstandingThrottler:Aa}=c(1693);return Aa.createInstance(oa,Ca)}bal(oa,Ca=""){const {MaxRateThrottler:Aa}=c(1695);return Aa.createInstance(oa,Ca)}}Object(E.a)(Ma,"ThrottlerFactory",null,[900]);var sa=c(80),xa=c(1698);class ia{constructor(oa){this.Sd=null;this.Ah=!1;this.ra=new sa.a;this.yJe=new y.a;this.wJe=new y.a;this.zUe=oa;this.$Ub=this.zUe.vLh(Ca=>Ca.send(),"GlobalMaxOustandingThrottler");this.$Ub.Gzd(()=>{this.ra.raiseEvent("TMUDM")})}init(oa){this.Ah||
(this.Sd=oa,this.$Ub.init(this.Sd.Gpb,this.Sd.Kim),this.Ah=!0)}pem(oa){var {MaxRateThrottler:Ca}=c(1695),{MaxOutstandingThrottler:Aa}=c(1693);this.Ah||this.init(new xa.a(Ca.MOh,Aa.mPh,Aa.XOh,ia.m$m));({value:Ca}=this.yJe.Dc(oa)).returnValue||(({value:Ca}=this.wJe.Dc(oa)).returnValue||(Ca="MaxOutstandingThrottler-"+oa,Ca=this.zUe.vLh(Object(e.a)(this.$Ub,this.$Ub.add,"add"),Ca),Ca.init(this.Sd.Gpb,this.Sd.l$m),Ca.Gzd(()=>{this.ra.raiseEvent("TMUDM")}),this.wJe.add(oa,Ca)),Aa="MaxRateThrottler-"+oa,
Ca=this.zUe.bal(Object(e.a)(Ca,Ca.add,"add"),Aa),Ca.init(this.Sd.obn),this.yJe.add(oa,Ca));return Ca}reset(){for(let oa of this.yJe)oa.value.t3f();for(let oa of this.wJe)oa.value.t3f(),oa.value.reset();this.$Ub.t3f();this.$Ub.reset()}Gzd(oa){this.ra.addHandler("TMUDM",oa)}}ia.m$m=1E3;Object(E.a)(ia,"ThrottlerManager",null,[899]);var ha;(function(oa){oa[oa.unspecified=0]="unspecified";oa[oa.word=1]="word";oa[oa.excel=2]="excel";oa[oa.powerPoint=3]="powerPoint";oa[oa.test=4]="test";oa[oa.wacFrontEnd=
5]="wacFrontEnd";oa[oa.oneNote=6]="oneNote";oa[oa.visio=7]="visio";oa[oa.officeMobile=8]="officeMobile";oa[oa.cosmosDBChangefeed=9]="cosmosDBChangefeed";oa[oa.last=10]="last"})(ha||(ha={}));Object(E.b)("RtcClientAppName",ha);const ua=(oa,Ca,Aa,db,eb,ib,lb,Ya,Fa=null,$a=null,Db=null,gc=null)=>{const Eb=N.createInstance(z.AFrameworkApplication.K),kb=z.AFrameworkApplication.buildVersion?z.AFrameworkApplication.buildVersion:"1.0",bb=ya(oa,Ca,lb,kb),Gb=Eb.bYk?c(1856).RealtimeChannelMetrics.createInstance(bb):
new F;var Sa=c(1513).FrequentLoggingMetrics.create(eb);Eb.E7n&&Sa.Wzo(Eb.D7n);var Pa="";Pa=Fa&&""!==Fa?Fa:"/rtc2/";Sa.TZh=v.a.y_(Pa);const Ab=Pa+"signalr";Fa=Pa+"findsession";const nb=K.vsm;Pa=new Ma;Db=Db||R.a.getInstance();m.ULS.shipAssertTag(556867617,500,Eb.Mej<=c(1523).RealtimeChannel.nMi,"Client attempting to override max payload size beyond absolute limit");const Rb=Math.min(Eb.Mej,c(1523).RealtimeChannel.nMi);Sa.mMi=Rb;Sa=new Ka(Eb,new ia(Pa),oa,bb,Mb=>new J(Mb.createHubProxy(nb)),Ya,Db,Gb,
Sa,Rb);$a||($a=c(1744).FindSessionStrategy.createInstance(Ca,eb,Fa,Ya,kb,lb,oa,bb,Db,ib,db,gc));$a.aMd=Eb.aMd;Ca=new G(bb);Aa=Aa?Aa.split(","):null;oa=new (c(1523).RealtimeChannel)(oa,Aa,bb,Ya,()=>$.hubConnection(Ab),$a,Sa,Ca,Db,Gb,Eb,eb);oa.init();return oa},ya=(oa,Ca,Aa)=>String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",oa,ra(ha[Aa]),ra("browser"),Ca),ra=oa=>oa?oa.charAt(0).toLocaleUpperCase()+oa.substring(1,oa.length):oa;c.d(M,"RealtimeChannel",function(){return La});class La{constructor(oa,
Ca,Aa,db,eb,ib,lb,Ya,Fa,$a,Db,gc){this.XSe=!1;this.W5=null;this.C2=new y.a;this.fqc=1;this.Kda=null;this.$l=!1;this.yHe=(new Date(0)).getTime();this.bgh=0;this._clientId=oa;this.Nwd=Ca;this.o$=0;this.he=db;this.Mve=Ya;this.Ugk=lb;this.ITj=Fa;this.WYj=eb;this.Y8a=ib;this.Bw=Aa;this.Kt=$a;this.Sd=Db;this.Wf=gc;this.Wik=1>100*Math.random()}get VQa(){return this.Y8a.VQa}set VQa(oa){this.Y8a.VQa=oa}get Fnb(){return this.Ugk}get Im(){return this.ITj}init(){this.Im.Jxk(Object(e.a)(this,this.GId,"disconnectAndCreateNewConnection"));
this.Im.iyk(Object(e.a)(this,this.Btn,"onUpdatePersistentStateRequestReceivedInternal"));this.Im.hyk(Object(e.a)(this,this.Atn,"onUpdatePersistentStateClearedRequestReceived"));this.Wf.Z_b(this.Kt);z.AFrameworkApplication.$H(()=>{const {FrequentLoggingMetrics:oa}=c(1513);this.Kt.u3f();oa.instance&&oa.instance.BKf()});this.MLh();this.mml();this.Im.Uxk(Object(e.a)(this,this.URo,"updateConnectionQueryString"))}mml(){try{const Aa=$.signalR;if(!Aa)throw Error.invalidOperation("Failed to retrieve Signalr object");
const db=Aa.version;if(!db)throw Error.invalidOperation("Signalr object is missing version information");if("2.1.1"===db){var oa=Aa.transports;if(!oa)throw Error.invalidOperation("Failed to retrieve transports object");var Ca=oa.longPolling;if(!Ca)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!Ca.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");Ca.supportsKeepAlive=this.ycl()}}catch(Aa){m.ULS.sendTraceTag(6432339,
500,15,"Failed to disable longPolling KeepAlives: {0}",Aa.message)}}ycl(){return()=>!1}MLh(){const oa=++this.fqc;this.yHe=(new Date(0)).getTime();this.Kda=this.WYj();this.Im.sMn(this.Kda);this.Kda.stateChanged(Ca=>{this.Kkn(Ca,oa)});this.Kda.connectionSlow(Object(e.a)(this,this.rsn,"onSlowConnection"));this.Kda.error(Object(e.a)(this,this.jsn,"onSignalRError"));this.Kda.log=Object(e.a)(this,this.ksn,"onSignalRLog")}Mmc(oa,Ca){return oa!==this.fqc?(m.ULS.sendTraceTag(4309017,500,50,"ConnectionToken verification failed for {0}",
Ca),!1):!0}connect(){2!==this.o$&&1!==this.o$&&(m.ULS.sendTraceTag(4539721,500,50,"Starting a new RTC connection for client [{0}]",this.Bw),this.Mve.Gkn(),A.a.instance.Xzo(),this.Qha(1,this.o$),this.Stj())}Stj(){const oa=this.fqc;this.XSe=!1;this.Kt.v6i();this.Y8a.a$l(Object(e.a)(this,this.E2k,"connectSignalrConnection"),Object(e.a)(this,this.qTi,"onFailureToConnect"),Object(e.a)(this.Fnb,this.Fnb.hwm,"initThrottlerManager"),Object(e.a)(this,this.Mmc,"verifyConnectionToken"),oa)}qTi(oa=null){this.Kt.x6i();
let Ca=null;!oa||"documentsessiondeleted"!==(Ca=oa.toLowerCase())&&"documentsessionexpired"!==Ca?this.GId():(m.ULS.sendTraceTag(41788292,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",this.Bw,oa),this.disconnect())}GId(oa,Ca=null){m.ULS.sendTraceTag(4309018,500,50,"Disconnecting the connection [{0}]",this.W5);oa=(oa=2===this.o$||1===this.o$)&&!this.Fnb.FCb;let Aa=!0,db=0;Ca&&Object.getType(Ca)!==Object.getType(Sys.EventArgs.Empty)&&
Ca.F6f&&""!==Ca.F6f&&(oa=!0,this.Y8a.xko(Ca.F6f),Aa=Ca.S9f,db=Ca.reconnectDelay);oa&&this.Qha(1,this.o$);++this.fqc;this.Fnb.sja();this.iBo(Aa);this.Y8a.Nnl();this.MLh();oa&&window.setTimeout(Object(e.a)(this,this.Stj,"startConnecting"),Math.min(db,3E4))}URo(){let oa=null;const Ca=({correlationId:oa}=this.Y8a.i8h()).returnValue;this.Kda.qs=Ca;m.ULS.sendTraceTag(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",this.Bw,oa)}E2k(oa){const {FrequentLoggingMetrics:Ca}=
c(1513);this.yHe=(new Date).getTime();let Aa=null;this.Kda.qs=({correlationId:Aa}=this.Y8a.i8h()).returnValue;this.Sd.nAk&&(this.Kda.url=oa,Ca.instance&&(Ca.instance.XGh=v.a.y_(oa)));let db=null;this.he&&(db=this.he.Zf("WebServiceCall","ConnectToServer"));m.ULS.sendTraceTag(3290048,500,50,"Connecting to server for client [{0}]",this.Bw);oa={};this.Nwd&&(oa.transport=1===this.Nwd.length?this.Nwd[0]:this.Nwd);oa.pingInterval=null;A.a.instance.l3c(1,0);oa.waitForPageLoad=!1;this.Kda.start(oa,null).done(eb=>
{this.Kt.y6i();A.a.instance.l3c(1,1,!0);m.ULS.sendTraceTag(3457857,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",eb.id,Aa)}).fail(eb=>{m.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1},  ClientDetails: [{2}]",this.Y8a.$W,Aa,this.Bw);this.qTi();this.Kt.w6i(eb);A.a.instance.l3c(1,1,!1);this.Im.r5i(0,{["CorrelationId"]:Aa,["ErrorDetails"]:eb,["ConnectionState"]:l.a[this.o$]})}).always(()=>{const {FrequentLoggingMetrics:eb}=
c(1513);db&&db.stop();eb.instance&&(eb.instance.Qze=!1)})}disconnect(){const {FrequentLoggingMetrics:oa}=c(1513);0===this.o$?m.ULS.sendTraceTag(36545632,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.Bw):(this.Kt.B6i(),oa.instance&&(oa.instance.Qze=!0),m.ULS.sendTraceTag(36545633,500,50,"Starting explicit disconnect for [{0}]",this.Bw),this.Fnb.FCb=!0,this.Mve.zln(),this.Qha(0,this.o$),this.GId(),this.Fnb.FCb=!1)}iBo(oa){const Ca=this.vQk(),Aa=this.Kda,db=this.W5,
eb=()=>{if(this.XSe)m.ULS.sendTraceTag(591692192,500,15,"Stop connection was called twice, possibly on the same connection.");else try{this.XSe=!0,Aa.stop(!0,oa)}catch(ib){m.ULS.sendTraceTag(591692191,500,15,"Stopping connection failed: {0}",ib.message)}};0<Ca?(m.ULS.sendTraceTag(4309020,500,50,"Waiting to stop connection [{0}]: [{1}] ms.",db,Ca),window.setTimeout(eb,Ca)):(m.ULS.sendTraceTag(36804372,500,50,"Stopping connection [{0}].",db),eb())}vQk(){let oa=0;0===this.Kda.state&&(oa=this.yHe+La.G0o-
(new Date).getTime(),0>oa&&(oa=0));return oa}get connectionState(){return this.o$}Ata(oa){this.Im.Ata(oa)}Ygc(oa){this.Im.Ygc(oa)}aij(oa){this.gic(0,oa)}gic(oa,Ca){const Aa=new a.a;this.Im.u5i(oa,Ca,Aa);return Aa.task}XYa(oa){this.Im.XYa(oa)}LMb(oa){this.Im.LMb(oa)}DDc(oa){this.Im.DDc(oa)}j4c(oa){this.Im.j4c(oa)}Dzd(oa){this.Im.Dzd(oa)}ede(oa){this.Im.ede(oa)}HPc(oa){return this.pgm(oa)}qDb(){return this.M6b(0)}M6b(oa){const Ca={};for(let Aa of this.C2)Aa.value.nb(oa)&&(Ca[Aa.key]=Aa.value.J(oa).data);
return Ca}pgm(oa){return this.C2.nb(oa)&&this.C2.J(oa).nb(0)?this.C2.J(oa).J(0).data:null}Btn(oa,Ca){for(let Aa of Ca.FXo)this.C2.nb(Aa.key)||this.C2.Z(Aa.key,new L.a),oa=Aa.value,this.C2.J(Aa.key).Z(Ca.type,new w(oa.Presence,new Date(oa.TimeStamp))),Aa.key===this._clientId&&0===Ca.type&&this.Im.YLn(oa.Presence)}Atn(oa,Ca){for(const Aa of Ca.QDd)this.C2.remove(Aa)}rKl(){const oa=new L.a;if(!this.C2.nb(this._clientId))return oa;for(let Ca of this.C2.J(this._clientId))oa.Z(Ca.key,Ca.value.data);return oa}XM(oa,
Ca=null,Aa=!1){const db=new a.a;this.Im.D2f(oa,Ca,Aa,db);return db.task}b3(oa){this.Im.b3(oa)}MMb(oa){this.Im.MMb(oa)}Uhb(oa){let Ca,Aa;return({value:Ca}=this.C2.Dc(oa)).returnValue&&({value:Aa}=Ca.Dc(0)).returnValue?new n(this.ugm(Aa),Aa.timeStamp):null}UMc(){const oa={};for(let Ca of this.C2)Ca.value.Dc(0).returnValue&&(oa[Ca.key]=this.Uhb(Ca.key));return oa}cqb(oa){const Ca=new a.a;this.Im.A5i(oa,Ca);return Ca.task}get clientId(){return this._clientId}get lwo(){return this.Wik}dispose(){const {FrequentLoggingMetrics:oa}=
c(1513);this.$l||(this.Fnb.sja(),this.Wf.Vce(this.Kt),this.Kt.u3f(),oa.instance&&oa.instance.BKf(),this.$l=!0)}Kkn(oa,Ca){this.Mmc(Ca,"StateChangedSignalR")&&this.Qha(this.HIh(oa.newState),this.HIh(oa.oldState))}Qha(oa,Ca){var {FrequentLoggingMetrics:Aa}=c(1513),{ClientToClientMessageTelemetry:db}=c(1755);if((1!==this.o$||0!==Ca||1!==oa)&&this.o$!==Ca){const eb=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.o$,
Ca,oa]));m.ULS.sendTraceTag(3290053,500,10,eb)}if(this.o$!==oa){switch(oa){case 2:Aa.instance&&Aa.instance.N8m();this.W5=this.Kda.id;m.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this.W5,this.Bw);this.J5m(this.Kda);m.ULS.sendTraceTag(4298369,500,50,"Retrieving complete session state");Aa=null;this.he&&(Aa=this.he.Zf("WebServiceCall","Receive First Presence"));db=this.fqc;this.Im.rMn(Object(e.a)(this,this.Mmc,"verifyConnectionToken"),db,this.Mve,Object(e.a)(this,
this.X6e,"clearExistingPersistentState"),this.rKl(),Aa);this.Sd.z7n&&(Aa=100*Math.random()<=this.Sd.A7n,c(1755).ClientToClientMessageTelemetry.S7b(this.Im,this.Sd,Aa).start());break;case 1:2===Ca&&m.ULS.sendTraceTag(4298644,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this.W5);break;case 0:if(db.instance&&db.instance.stop(),this.Fnb.FCb)m.ULS.sendTraceTag(3249543,500,50,"Connection [{0}] has been explicitly closed",this.W5);else{1===Ca&&(m.ULS.sendTraceTag(7672737,500,
50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",this.W5),this.Kt.C6i());2===Ca&&m.ULS.sendTraceTag(36574532,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",this.W5);this.GId();return}}this.o$=oa;this.Im.xLn(oa,Ca)}}J5m(oa){if(oa&&oa.transport&&oa.transport.name){oa=oa.transport.name;var Ca=oa.toLowerCase();
"websockets"===Ca?m.ULS.sendTraceTag(4290723,500,50,"Transport name - {0} for [{1}]",oa,this.Bw):"serversentevents"===Ca?m.ULS.sendTraceTag(4290752,500,50,"Transport name - {0} for [{1}]",oa,this.Bw):"foreverframe"===Ca?m.ULS.sendTraceTag(4290753,500,50,"Transport name - {0} for [{1}]",oa,this.Bw):"longpolling"===Ca?m.ULS.sendTraceTag(4290754,500,50,"Transport name - {0} for [{1}]",oa,this.Bw):"mocktransport"!==Ca&&m.ULS.sendTraceTag(4290755,500,15,"Unknown transport protocol encountered - '{0}'",
oa)}else m.ULS.sendTraceTag(4290722,500,10,"Transport protocol name is missing")}rsn(){if(this.Sd.Lej){const oa=v.a.bU(this.VQa,"mid");m.ULS.sendTraceTag(3249544,500,15,"Detected that the connection [{0}] is slow for target machine [{1}]",this.W5,oa)}else m.ULS.sendTraceTag(522716053,500,50,"Detected that the connection [{0}] is slow",this.W5)}jsn(){m.ULS.sendTraceTag(3249545,600,15,"SignalR ERROR for connection [{0}];",this.W5)}ksn(oa){oa=c(1493).RtcUtils.fec(oa);if(this.Sd.Lej&&oa.startsWith("Keep alive timed out.")){const Ca=
v.a.bU(this.VQa,"mid");m.ULS.sendTraceTag(522716054,500,15,"SignalR lib: {0}. Target Machine: {1}",oa,Ca)}else this.lwo&&2E3>this.bgh&&!oa.startsWith("Invok")&&!oa.startsWith("Trigger")&&(m.ULS.sendTraceTag(578950464,500,50,"SignalR lib: {0}",oa),this.bgh++)}X6e(){let oa;const Ca=[];({value:oa}=this.C2.Dc(this._clientId)).returnValue&&this.C2.remove(this._clientId);for(let Aa of this.C2.keys)Array.add(Ca,Aa);for(const Aa of Ca)this.C2.remove(Aa);oa&&this.C2.Z(this._clientId,oa);this.Im.SLn(Ca)}HIh(oa){switch(oa){case 0:return 1;
case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",oa,"Unknown SignalR state");}}ugm(oa){return oa&&oa.timeStamp?(new Date).getTime()-oa.timeStamp.getTime()>(this.Sd.OHk?6E4:this.Sd.NHk)?2:1:1}static createInstance(oa,Ca,Aa,db,eb,ib,lb,Ya=null,Fa=null,$a=null,Db=null,gc=null,Eb=null){return ua(oa,Ca,Aa,Eb,db,eb,ib,lb,Ya,Fa,$a,gc,Db)}}La.nMi=31E3;La.nMf=8E3;La.G0o=15E3;Object(E.a)(La,"RealtimeChannel",null,[874,875])},1612:function(E,M,c){c.d(M,"a",function(){return m});
E=c(0);class m{constructor(){this.dhh=!1;this.twb=null;this.lQg=0;this.oAe=this.cNh();this.Gfd=this.cNh();this.Mrb=this.VUb=0;this.eq=()=>new Date}get qCo(){return this.dhh}cNh(){const e=Array(6);for(let a=0;a<e.length;a++)e[a]=0;return e}aVl(){return this.oAe.toString()}IPl(){return this.Gfd.toString()}Xzo(){this.twb=this.eq()}l3c(e,a,l=!1){this.qCo||(l&&(this.dhh=!0),l=this.eq(),0===e&&5<this.VUb||1===e&&5<this.Mrb||(this.lQg<e?(1===this.VUb%2&&(this.oAe[this.VUb]=-1,this.VUb++),this.lQg=e,1===
a&&(this.Gfd[this.Mrb]=-1,this.Mrb++),this.Gfd[this.Mrb]=this.mgg(l),this.Mrb++):0===e?(this.oAe[this.VUb]=this.mgg(l),this.VUb++):(this.Gfd[this.Mrb]=this.mgg(l),this.Mrb++)))}mgg(e){const a=e.getTime()-this.twb.getTime();this.twb=e;return a}static get instance(){m._instance||(m._instance=new m);return m._instance}static set instance(e){m._instance=e}}m._instance=null;Object(E.a)(m,"LatencyMetrics",null,[])},1642:function(E,M,c){E=c(0);class m{constructor(){this.iNg=this.Gve=!1;this.callback=null}j_c(a){this.callback=
a;this.hAj()}FLi(a){this.Gve||(this.Gve=!0,this.OYj=a,this.hAj())}hAj(){this.Gve&&this.callback&&!this.iNg&&(this.iNg=!0,this.callback(this.OYj))}}Object(E.a)(m,"CompletionTask",null,[]);c.d(M,"a",function(){return e});class e{constructor(){this.p6g=new m;this.n6g=new m}d7d(a){this.p6g.j_c(a)}c7d(a){this.n6g.j_c(a)}nYc(a){this.p6g.FLi(a)}alb(a){this.n6g.FLi(a)}aMf(){this.nYc(2);this.alb(2)}}Object(E.a)(e,"MessageStatus",null,[913])},1693:function(E,M,c){c.r(M);c.d(M,"MaxOutstandingThrottler",function(){return l});
E=c(0);var m=c(55),e=c(80);M=c(1694);var a=c(1642);class l extends M.a{constructor(y,z=""){super(y,z);this.odc=this.Gpb=0;this.ra=new e.a;this.bWb=!1;this.tpd=this.jgd=this.Hfd=this.yUe=0;this.T2=[];this.clearTimeout=l.Lcf}add(y){this.cWb||this.init(l.mPh,l.XOh);this.Zxb++;const z=new a.a;this.Lac?this.dhe(y,z):this.tpd<this.odc?this.i6c(y,z):(this.dhe(y,z),this.bWb=!1);return z}i6c(y,z){y=this.veh(y);const n=this.setTimeout(Object(m.a)(this,this.Eon,"onMessageWaitTimeExpired"),this.Gpb);++this.tpd;
Array.add(this.T2,n);const v=this.Hfd;y.d7d(A=>{z.nYc(A)});y.c7d(A=>{this.Hfd===v&&(this.Don(v,n),z.alb(A))})}Don(y,z){this.Hfd===y&&(--this.tpd,this.clearTimeout(z),Array.remove(this.T2,z),this.Lac&&this.uco())}uco(){this.Lac&&!this.bWb&&(this.yUe=this.setTimeout(Object(m.a)(this,this.vco,"sendThrottledMessageFromTimer"),0),this.bWb=!0)}vco(){this.bWb=!1;if(this.Lac){const y=this.jwd,z=this.KZb;this.gGc(!1);this.i6c(y,z)}}Eon(){++this.jgd;this.jgd>Math.floor(this.odc/2)&&(this.jgd=-1E9,this.ra.raiseEvent("TMUDM"))}Gzd(y){this.ra.addHandler("TMUDM",
y)}reset(){this.Zxb=this.NBc=this.Trc=this.jgd=0;++this.Hfd;for(const y of this.T2)this.clearTimeout(y);this.tpd=0;this.T2=[];this.gGc(!0);this.bWb&&(this.clearTimeout(this.yUe),this.yUe=0,this.bWb=!1)}init(y,z){this.cWb||(this.Gpb=y,this.odc=z,this.cWb=!0)}static createInstance(y,z=""){return new l(y,z)}static Lcf(y){window.clearTimeout(y)}}l.mPh=15E3;l.XOh=5;Object(E.a)(l,"MaxOutstandingThrottler",M.a,[912,911])},1694:function(E,M,c){c.d(M,"a",function(){return e});E=c(0);var m=c(7);class e{constructor(a,
l=""){this.Trc=this.NBc=0;this.yFe=!1;this.KZb=this.jwd=null;this.cWb=!1;this.veh=a;this.Xxj=l;this.setTimeout=e.Scf;this.Zxb=this.NBc=this.Trc=0}t3f(){0<this.Zxb&&0<this.Trc&&m.ULS.sendTraceTag(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",this.Xxj,this.Trc,this.Zxb);0<this.Zxb&&0<this.NBc&&m.ULS.sendTraceTag(36545634,500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",this.Xxj,this.NBc,this.Zxb)}get Lac(){return this.yFe}dhe(a,l){this.NBc++;this.gGc(!0);this.yFe=
!0;this.jwd=a;this.KZb=l}gGc(a){this.yFe=!1;this.KZb&&a&&(this.Trc++,this.KZb.aMf());this.KZb=this.jwd=null}static Scf(a,l){return window.setTimeout(a,l)}}Object(E.a)(e,"ThrottlerBase",null,[])},1695:function(E,M,c){c.r(M);c.d(M,"MaxRateThrottler",function(){return a});E=c(0);var m=c(55);M=c(1694);var e=c(1642);class a extends M.a{constructor(l,y=""){super(l,y);this.xdc=0;this.Uvc=(new Date(0)).getTime();this.currentTime=()=>(new Date).getTime()}init(l){this.cWb||(this.xdc=l,this.cWb=!0)}add(l){this.cWb||
this.init(a.MOh);this.Zxb++;const y=this.currentTime(),z=new e.a;this.Uvc>y&&(this.Uvc=y);this.Lac?(this.gGc(!0),this.dhe(l,z)):this.Uvc+this.xdc<=y?this.i6c(l,z):(this.dhe(l,z),this.setTimeout(Object(m.a)(this,this.tco,"sendThrottledMessage"),this.Uvc+this.xdc-y));return z}tco(){if(this.Lac){const l=this.jwd,y=this.KZb;this.gGc(!1);this.i6c(l,y)}}i6c(l,y){this.Uvc=this.currentTime();l=this.veh(l);l.d7d(z=>{y.nYc(z)});l.c7d(z=>{y.alb(z)})}static createInstance(l,y=""){return new a(l,y)}}a.MOh=200;
Object(E.a)(a,"MaxRateThrottler",M.a,[910,911])},1696:function(E,M,c){c.d(M,"a",function(){return m});E=c(0);class m extends Sys.EventArgs{constructor(e,a,l,y){super();this.type=e;this.tL=a;this.gjl=l;this.i7a=y}}Object(E.a)(m,"SendUpdateNotificationEventArgs",Sys.EventArgs,[])},1697:function(E,M,c){c.d(M,"a",function(){return m});E=c(0);class m{}m.E8f="rr";m.C7n="rd";m.y7n="rbp";m.S9f="sa";Object(E.a)(m,"RtcReconnectParams",null,[])},1698:function(E,M,c){c.d(M,"a",function(){return m});E=c(0);class m{constructor(e,
a,l,y){this.obn=e;this.Gpb=a;this.l$m=l;this.Kim=y}}Object(E.a)(m,"ThrottlerManagerSettings",null,[])},1740:function(E,M,c){E=c(0);class m extends Sys.EventArgs{constructor(L,U){super();this.newState=L;this.oldState=U}}Object(E.a)(m,"ChangedConnectionStateEventArgs",Sys.EventArgs,[]);class e extends Sys.EventArgs{constructor(L,U){super();this.aYk=L;this.i7a=U}}Object(E.a)(e,"ClientInfoEventArgs",Sys.EventArgs,[]);class a extends Sys.EventArgs{constructor(L){super();this.presence=L}}Object(E.a)(a,
"MyPresenceUpdatedEventArgs",Sys.EventArgs,[]);var l=c(1858),y=c(1857),z=c(1855);class n extends Sys.EventArgs{constructor(L,U=null){super();this.Ak=L;this.Amk=U}get type(){return this.Ak}get tL(){return this.Amk}}Object(E.a)(n,"UpdateNotificationEventArgs",Sys.EventArgs,[]);class v extends Sys.EventArgs{constructor(){super()}}Object(E.a)(v,"GotCompletePersistentStateWithMetadataEventArgs",Sys.EventArgs,[]);class A extends Sys.EventArgs{constructor(L,U,W,X,V,Z){super();this.Mmc=L;this.V8e=U;this.G2k=
W;this.wXh=V;this.X6e=X;this.NA=Z}}Object(E.a)(A,"RefreshAllPersistentStateEventArgs",Sys.EventArgs,[]);class w extends Sys.EventArgs{constructor(L){super();this.hubConnection=L}}Object(E.a)(w,"RefreshProxyEventArgs",Sys.EventArgs,[]);class G extends Sys.EventArgs{constructor(L,U){super();this.gga=L;this.errorMessage=U}}Object(E.a)(G,"RtcConnectFailedEventArgs",Sys.EventArgs,[]);class F extends Sys.EventArgs{constructor(L,U,W){super();this.type=L;this.presence=U;this.i7a=W}}Object(E.a)(F,"SendPersistentStateEventArgs",
Sys.EventArgs,[]);var I=c(1696);class K extends Sys.EventArgs{constructor(){super()}}Object(E.a)(K,"SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);class J extends Sys.EventArgs{constructor(L){super();this.QDd=L}}Object(E.a)(J,"UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);class N extends Sys.EventArgs{constructor(L,U){super();this.type=L;this.FXo=U}}Object(E.a)(N,"UpdatePersistentStateRequestEventArgs",Sys.EventArgs,[]);var R=c(80);c.d(M,"a",function(){return O});class O{constructor(){this.ra=
new R.a}xLn(L,U){this.ra.raiseEvent("CSC",new m(L,U))}sMn(L){this.ra.raiseEvent("RP",new w(L))}Xbe(L){this.ra.raiseEvent("RC",L)}vMn(){this.ra.raiseEvent("RMID")}rMn(L,U,W,X,V,Z){this.ra.raiseEvent("RPS",new A(L,U,W,X,V,Z))}B5i(L,U){this.ra.raiseEvent("UPSR",new N(L,U))}n5i(L,U){this.ra.raiseEvent("PU",new z.a(L,U))}YLn(L){this.ra.raiseEvent("MPU",new a(L))}D2f(L,U,W,X){this.ra.raiseEvent("SUN",new I.a(L,U,W,X))}KMn(L,U){this.ra.raiseEvent("UNR",new n(L,U))}u5i(L,U,W){this.ra.raiseEvent("SP",new F(L,
U,W))}mMn(L,U){this.ra.raiseEvent("PSU",new y.a(L,U))}lMn(L){this.ra.raiseEvent("PSC",new l.a(L))}SLn(L){this.ra.raiseEvent("IPSC",new l.a(L))}LMn(L){this.ra.raiseEvent("UPSC",new J(L))}xMn(L,U){this.ra.raiseEvent("SPC",new K(L,U))}r5i(L,U){this.ra.raiseEvent("RCF",new G(L,U))}LLn(L){this.ra.raiseEvent("CPSWM",new v(L))}A5i(L,U){this.ra.raiseEvent("UCI",new e(L,U))}Ata(L){this.ra.addHandler("CSC",L)}Ygc(L){this.ra.removeHandler("CSC",L)}Kxk(L){this.ra.addHandler("RP",L)}Jxk(L){this.ra.addHandler("RC",
L)}Nxk(L){this.ra.addHandler("RMID",L)}Ixk(L){this.ra.addHandler("RPS",L)}iyk(L){this.ra.addHandler("UPSR",L)}XYa(L){this.ra.addHandler("PU",L)}LMb(L){this.ra.removeHandler("PU",L)}Lvk(L){this.ra.addHandler("IPU",L)}fyk(L){this.ra.addHandler("UCI",L)}Sxk(L){this.ra.addHandler("SUN",L)}Mvk(L){this.ra.addHandler("IUNR",L)}b3(L){this.ra.addHandler("UNR",L)}MMb(L){this.ra.removeHandler("UNR",L)}DDc(L){this.ra.addHandler("PSU",L)}j4c(L){this.ra.removeHandler("PSU",L)}Kvk(L){this.ra.addHandler("IPSU",L)}Dzd(L){this.ra.addHandler("PSC",
L)}ede(L){this.ra.removeHandler("PSC",L)}Jvk(L){this.ra.addHandler("IPSC",L)}hyk(L){this.ra.addHandler("UPSC",L)}Qxk(L){this.ra.addHandler("SP",L)}Uxk(L){this.ra.addHandler("SPC",L)}static getInstance(){return O._instance||(O._instance=new O)}}O._instance=null;Object(E.a)(O,"RtcEventHub",null,[901])},1744:function(E,M,c){c.r(M);E=c(0);var m=c(7),e=c(55),a=c(74),l=c(872);class y{}y.xdc="throttling_messageDelay";y.dVc="enabled";y.Gpb="throttling_timeToWaitForResponse";y.odc="throttling_maxNumberOfOutstandingMessages";
y.Cji="throttling_globalMaxNumberOfOutstandingMessages";y.errorMessage="errorMessage";y.dsj="url";y.PGa="queryString";y.$W="connectionString";Object(E.a)(y,"RtcFindSessionOutputFieldNameConstants",null,[]);var z=c(2),n=c(57),v=c(39),A=c(311),w=c(1364),G=c(82),F=c(19),I=c(136);class K{constructor(){this.Dji=this.kMi=this.lMi=this.qMi=0;this.VZd=!1;this.correlationId=this.$W=this.PGa=this.W8e=this.errorMessage=null}get z1k(){return this.W8e+"?"+this.PGa}}Object(E.a)(K,"FindSessionResponse",null,[]);
var J=c(584);class N{constructor(aa,ea,na,pa,ja,ma){this.xXa=null;const {FindSessionStrategy:Ia}=c(1744);this.hfk=aa;aa=String.format("{0}={1}",J.a.clientId,F.a.Nj(pa));aa=String.format("{0}&{1}={2}",aa,J.a.userSessionId,F.a.Nj(ja));aa=String.format("{0}&{1}={2}",aa,J.a.HHj,F.a.Nj(na.toString()));aa=String.format("{0}&{1}={2}",aa,J.a.userType,F.a.Nj("1"));aa=String.format("{0}&{1}={2}",aa,J.a.THj,F.a.Nj(ea));aa=String.format("{0}&{1}={2}",aa,J.a.jEh,F.a.Nj(Ia.cYk));(ea=N.jnf(na,ma))&&(aa=String.format("{0}&{1}",
aa,ea));this.YYj=aa}D7i(){this.xXa=this.hfk()}generate(){this.xXa&&""!==this.xXa||(this.D7i(),m.ULS.sendTraceTag(575784194,500,this.xXa&&""!==this.xXa?50:15,"Query signature delegate called for refresh returned: {0} ",this.xXa));const aa=String.format("{0}={1}",J.a.aMb,F.a.Nj(this.xXa));return String.format("{0}&{1}",aa,this.YYj)}static jnf(aa,ea){return 4===aa?String.format("{0}={1}",J.a.QPi,"1"):ea?ea.zii():null}}Object(E.a)(N,"FindSessionQueryStringGenerator",null,[]);var R=c(1513),O=c(1612),L=
c(1493),U=c(1698);class W{}W.fCl="FSType";Object(E.a)(W,"RtcFindSessionRequestHeaders",null,[]);class X{}X.INn="polling";Object(E.a)(X,"RtcFindSessionTypes",null,[]);var V=c(1697);class Z{}Z.u_o="RTC-TokenProofkey";Z.rTm="RTC-IsWacJsBootFsRequest";Object(E.a)(Z,"RtcRequestHeaders",null,[]);c.d(M,"FindSessionStrategy",function(){return da});class da{constructor(aa,ea,na,pa,ja,ma,Ia,Ja,Ka,Ma,sa,xa,ia=null){this.k3g=(new Date(0)).getTime();this.w5g=0;this.hod=!1;this.Ieh=null;this.J3f=36E5;this.oTb=
da.Ypi;this.xsc=0;this.YMb=null;this.JSa=0;this.Ihc=this.ZGh=null;this.jgk=[y.dVc,y.errorMessage,y.dsj,y.$W,y.PGa,y.Cji,y.odc,y.Gpb,y.xdc];this.igk=[y.dVc,y.errorMessage];this.$W=this.VQa=null;this.RUg=new N(sa?sa:()=>z.AFrameworkApplication.hm,ja,ma,Ia,aa,ea);this.ypc=xa;this.he=pa;this.Wf=ea;this.sAe=na;this.Bw=Ja;this.Im=Ka;this.Ssc=ia;this.SUg=!1;this.aMd=9E4;Ma&&Ma.execute(ha=>{ha.VYa(()=>{m.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",this.Bw);
this.RUg.D7i()})});2>=100*Math.random()&&(this.J3f=3E5);R.FrequentLoggingMetrics.instance&&(R.FrequentLoggingMetrics.instance.M1h=this.J3f)}xko(aa){this.Ihc=aa}init(){this.Im.Nxk(Object(e.a)(this,this.F3n,"resetGetMachineIdDelay"));this.Im.Ata(Object(e.a)(this,this.Qha,"onConnectionStateChanged"))}Qha(aa,ea){this.JSa=ea.newState;2===ea.newState&&(this.xsc=0)}i8h(){let aa;aa=this.YMb.correlationId;return{returnValue:String.format("{0}&{1}={2}",this.YMb.PGa,da.rJh,F.a.Nj(aa)),correlationId:aa}}a$l(aa,
ea,na,pa,ja){this.sbo(()=>{pa(ja,"GetMachineIdSuccess")&&(m.ULS.sendTraceTag(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",this.$W,this.Bw),aa(this.Ieh),na(this.rem()))},ma=>{pa(ja,"GetMachineIdFailure")&&(m.ULS.sendTraceTag(4060129,500,15,"Failed to retrieve Rtc MachineId for [{0}]",this.Bw),ea(ma))},pa,ja)}Nnl(){this.QDh();this.Cum()}sbo(aa,ea,na,pa){m.ULS.sendTraceTag(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",
this.$W);if(this.$W)aa();else{var ja=this.DPk();window.setTimeout(()=>{this.sendFindSessionRequestToServerInternal(aa,ea,na,pa)},ja)}}sendFindSessionRequestToServerInternal(aa,ea,na,pa){na(pa,"RequestMachineId")&&(this.k3g=(new Date).getTime(),na=v.a.$e(),this.ePd(ja=>{const ma=v.a.$e();this.h_i(ja);this.Sag();aa();ja=v.a.$e()-ma;m.ULS.sendTraceTag(577356039,345,50,"SFSRTS Success - TimeElapsed: {0}",ja)},ja=>{const ma=v.a.$e();this.QDh();R.FrequentLoggingMetrics.instance&&R.FrequentLoggingMetrics.instance.UO(2,
3);ea(ja);ja=v.a.$e()-ma;m.ULS.sendTraceTag(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",ja)},!1),na=v.a.$e()-na,m.ULS.sendTraceTag(577599296,345,50,"SFSRTS - TimeElapsed: {0}",na))}Cum(){this.oTb+=da.T0l;this.oTb=Math.min(this.oTb,da.W9m)}DPk(){var aa=(new Date).getTime();aa=this.k3g+this.oTb-aa;0>aa&&(aa=0);return aa}h_i(aa){try{this.YMb=aa,this.VQa=aa.z1k,this.$W=aa.$W,this.ZGh=aa.PGa,this.Ieh=aa.W8e}catch(ea){m.ULS.sendTraceTag(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",
ea.toString())}}QDh(){this.$W=null;this.RDh()}Sag(){this.RDh();this.hod=!0;this.w5g=window.setTimeout(Object(e.a)(this,this.SRn,"refreshMachineId"),this.J3f)}RDh(){this.hod&&(window.clearTimeout(this.w5g),this.hod=!1)}SRn(){this.hod=!1;this.ePd(aa=>{const ea=this.ZGh!==aa.PGa,na=this.$W!==aa.$W,pa=this.$W;this.h_i(aa);0!==this.JSa&&(na?(m.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",pa||"null",aa.$W),this.Im.Xbe()):(this.Im.xMn(ea,na),
this.Sag()))},()=>{R.FrequentLoggingMetrics.instance&&R.FrequentLoggingMetrics.instance.UO(2,3);this.Sag()},!0)}F3n(){this.oTb=da.Ypi}rem(){return new U.a(this.YMb.qMi,this.YMb.lMi,this.YMb.kMi,this.YMb.Dji)}BKo(aa){if(Object.getType(aa)!==Object)return null;for(let ea in aa);return this.p9k(aa)}p9k(aa){if(!(y.dVc in aa))return null;const ea=aa[y.dVc];var na=ea?this.jgk:this.igk;for(const pa of na)if(!(pa in aa))return null;na=Object.assign(new K,{VZd:aa[y.dVc],errorMessage:aa[y.errorMessage],correlationId:I.a.create().toString()});
ea&&(na.W8e=aa[y.dsj],na.PGa=aa[y.PGa],na.$W=aa[y.$W],na.Dji=aa[y.Cji],na.kMi=aa[y.odc],na.lMi=aa[y.Gpb],na.qMi=aa[y.xdc]);return na}bVl(aa,ea){m.ULS.sendTraceTag(50448152,500,50,"Using FindSessionUtils find session response");this.Ssc.UZh.continueWith(()=>{this.Ssc.UZh.result?(m.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),aa(this.Ssc.VZh)):(m.ULS.sendTraceTag(50448154,500,15,"FindSessionUtils find Session resulted in error"),ea(this.Ssc.VZh))})}pcj(aa,ea,
na,pa,ja=!1){return ma=>{O.a.instance.l3c(0,1);aa&&aa.stop();this.ypc=this.Ihc=null;this.BJi(ma.data,!0,ea);var Ia=L.RtcUtils.deserialize(ma.data.xe,"FindSession",null);if(Ia)if(Ia=this.BKo(Ia)){if(Ia.VZd&&Ia.PGa&&Ia.$W){m.ULS.sendTraceTag(4317446,500,50,"Successfully retrieved MachineId from server for [{0}]",this.Bw);this.y0m(ma.data);na(Ia);return}ea.FindSessionFailureReason="FindSessionInvalidResponse";ea.IsRtcEnabled=Ia.VZd;ea.IsQueryStringEmpty=!Ia.PGa;ea.IsConnectionStringEmpty=!Ia.$W;m.ULS.sendTraceTag(4290720,
500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",this.Bw,Ia.VZd,!Ia.PGa,!Ia.$W)}else ea.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",m.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",this.Bw);else ea.FindSessionFailureReason="FindSessionDeserializeServerResponseFailed",m.ULS.sendTraceTag(7372827,500,10,"Could not deserialize response data for [{0}]",
this.Bw);this.s5i(ea,ja);pa(null)}}jcj(aa,ea,na,pa=!1){return ja=>{O.a.instance.l3c(0,1);aa&&aa.stop();this.ypc=this.Ihc=null;this.BJi(ja.data,!1,ea);let ma=null;var Ia="unknown";let Ja="unknown";ja.data&&((Ia=ja.data.vj)&&da.z5c in Ia&&(ma=Ia[da.z5c].toString()),Ia=w.a[ja.data.status],Ja=ja.data.Qe.toString());ea.FindSessionFailureReason="FindSessionRequestFailed";ea.HttpErrorCode=Ja;ea.HttpErrorStatus=Ia;ea[da.z5c]=ma;m.ULS.sendTraceTag(4290721,500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",
Ia,Ja,this.Bw,ma,pa);this.s5i(ea,pa);na(Ja)}}ePd(aa,ea,na=!1){let pa=null;m.ULS.sendTraceTag(4317445,500,50,"Getting MachineId from server for [{0}]",this.Bw);const ja={};var ma=this.RUg.generate();ja[A.a.F7]=I.a.create().toString();this.Ihc&&""!==this.Ihc?ma=String.format("{0}&{1}={2}",ma,V.a.E8f,this.Ihc):this.ypc&&""!==this.ypc&&(ma=String.format("{0}&{1}={2}",ma,V.a.E8f,this.ypc),ja[Z.u_o]="True",ja[Z.rTm]="True");ma=this.sAe+"?"+ma;na&&(ja[W.fCl]=X.INn);const Ia={};Ia.IsNetworkOfflineBeforeSendRequest=
this.Wf.gQa;Ia.HasAvailableConnectionsBeforeSendRequest=this.Wf.AUd;Ia.MaxConnectionsAllowed=this.Wf.ldc;Ia.IsRefreshMachineId=na;this.Ssc&&!this.SUg?(this.bVl(this.pcj(null,Ia,aa,ea,na),this.jcj(null,Ia,ea,na)),this.SUg=!0):(this.he&&(pa=this.he.Zf("WebServiceCall","GetMachineIdFromTheServer")),R.FrequentLoggingMetrics.instance&&R.FrequentLoggingMetrics.instance.UO(2,0),0>this.Wf.Tyb(ma,1,null,ja,[da.bGd,da.z5c,da.PZc,da.D8f,da.MOi,da.nRi,da.mRi],1,this.pcj(pa,Ia,aa,ea,na),this.jcj(pa,Ia,ea,na),
null,!1,null,this.aMd,"3",null,!0)&&(5<this.xsc&&200>this.xsc&&m.ULS.sendTraceTag(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",this.xsc),window.setTimeout(()=>{this.xsc++;ea("-1")},1E3)))}BJi(aa,ea,na){na||(na={});na.IsNetworkOfflineAfterRequestComplete=this.Wf.gQa;na.IsRequestSucceeded=ea;aa&&(na.EnqueueTime=aa.dOa,na.InvokedTime=aa.IH,na.CompletedTime=aa.oT,aa.vj&&(da.bGd in aa.vj&&(na.CorrelationId=aa.vj[da.bGd]),da.PZc in
aa.vj&&(na[da.PZc]=aa.vj[da.PZc])));m.ULS.sendTraceTag(38633565,500,ea?50:15,L.RtcUtils.fec(na))}s5i(aa,ea){aa||(aa={});aa.ConnectionState=l.a[this.JSa];ea||this.Im.r5i(1,aa)}y0m(aa){try{var ea=!1,na=!1,pa=aa.vj,ja=n.a.y_(aa.request.get_url());if(pa&&da.D8f in pa){const Ma=pa[da.D8f].toString().toLocaleLowerCase();na="true"===Ma;ea="false"===Ma}pa=!1;const Ka=0<=ja.toLocaleLowerCase().indexOf("collab");na&&!Ka?pa=!0:ea&&Ka&&(pa=!0);if(pa){ea={};ea.HostName=ja;ea.Status=w.a[aa.status];ea.HttpStatus=
aa.Qe.toString();var ma=aa.request.get_headers();for(let Ma in ma){var Ia=ma[Ma];(ja=Ma)&&0<ja.length&&(na=0,Ia&&(na=Ia.toString().length),ea["r_"+ja]=na)}if(aa.vj){const Ma=new a.a;Ma.add(da.bGd);Ma.add(da.PZc);Ma.add(da.z5c);Ma.add(da.nRi);Ma.add(da.mRi);Ma.add(da.MOi);da.utk(ea,aa.vj,Ma)}da.ftk(aa.request.get_url(),ea);var Ja=G.a.toJSON(ea);m.ULS.sendTraceTag(559437006,500,15,Ja)}}catch(Ka){m.ULS.sendTraceTag(559437007,500,10,"DomainLandingIncorretDC exception[{0}]",Ka.toString())}}static createInstance(aa,
ea,na,pa,ja,ma,Ia,Ja,Ka,Ma,sa,xa=null){return da.p$k(aa,ea,na,pa,ja,ma,Ia,Ja,Ka,Ma,sa,xa)}static p$k(aa,ea,na,pa,ja,ma,Ia,Ja,Ka,Ma,sa,xa=null){aa=aa||I.a.create().toString();aa=new da(aa,ea,na,pa,ja,ma,Ia,Ja,Ka,Ma,null,sa,xa);aa.init();return aa}static utk(aa,ea,na){for(let pa of na)pa in ea&&(aa[pa]=ea[pa])}static ftk(aa,ea){if(aa){var na=aa.indexOf("?");if(-1!==na)for(aa=aa.substr(na+1).split("&"),na=0;na<aa.length;++na){var pa=aa[na].split("=");if(2===pa.length){const ja=pa[0];if(ja&&0<ja.length){let ma=
0;if(pa=pa[1])ma=pa.length;ea["q_"+ja]=ma}}}}}}da.T0l=3E3;da.W9m=3E5;da.cYk="1.0";da.Ypi=1E3;da.bGd="X-CorrelationId";da.rJh="corrid";da.z5c="RtcErrorCode";da.PZc="X-OfficeCluster";da.D8f="X-NewEnv";da.MOi="X-MSEdge-Ref";da.mRi="X-OFFICEFD";da.nRi="X-OfficeFE";Object(E.a)(da,"FindSessionStrategy",null,[897])},1755:function(E,M,c){c.r(M);E=c(0);var m=c(7),e=c(55),a=c(457),l=c(58),y=c(74);class z{constructor(v){this.messageId=v;this.xco=(new Date).getTime();this.rIf=new y.a}}Object(E.a)(z,"MessageLatencyDetails",
null,[]);c.d(M,"ClientToClientMessageTelemetry",function(){return n});class n{constructor(v,A,w){this.hLa=null;this.eJe=this.bRe=0;this.Sd=A;this.q6g=w;this.DAc=!1;this.Im=v;this.Im.b3(Object(e.a)(this,this.gOn,"receiveMessage"))}start(){if(this.q6g&&!this.DAc){const v=this.Sd.Pej;this.eJe=this.Sd.Kej;v<=this.eJe?(m.ULS.sendTraceTag(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",
this.Sd.Pej,this.Sd.Kej),this.q6g=!1):(this.DAc=!0,this.bRe=window.setInterval(Object(e.a)(this,this.sendMessage,"sendMessage"),v))}}sendMessage(){if(this.DAc){const v=l.a.create().toString();this.hLa=new z(v);this.Im.D2f(16,v,!1,new a.a);window.setTimeout(()=>{this.V2m(v)},this.eJe)}}V2m(v){this.hLa&&this.hLa.messageId===v&&(0<this.hLa.rIf.count?(v=this.hLa.rIf.toArray().join(","),m.ULS.sendTraceTag(571339719,500,15,"ClientMessageLatencies:[{0}]",v)):m.ULS.sendTraceTag(562312150,500,50,"No client message latencies recorded"),
this.hLa=null)}stop(){this.bRe&&(window.clearInterval(this.bRe),this.DAc=!1)}gOn(v,A){16===A.type?this.Im.D2f(17,A.tL,!1,new a.a):17===A.type&&this.DAc&&A.tL&&this.processMessage(A.tL)}processMessage(v){v&&this.hLa&&v.toString()===this.hLa.messageId&&(v=(new Date).getTime()-this.hLa.xco,this.hLa.rIf.add(v))}static get instance(){return n._instance}static S7b(v,A,w){return n.instance||(n._instance=new n(v,A,w))}}n._instance=null;Object(E.a)(n,"ClientToClientMessageTelemetry",null,[])},1855:function(E,
M,c){c.d(M,"a",function(){return m});E=c(0);class m extends Sys.EventArgs{constructor(e,a){super();this.Sqa=e;this.HId=a}}Object(E.a)(m,"PresenceUpdatedEventArgs",Sys.EventArgs,[])},1856:function(E,M,c){c.r(M);c.d(M,"RealtimeChannelMetrics",function(){return y});E=c(0);var m=c(7),e=c(197),a=c(82),l=c(1493);class y{constructor(){this.X7g=this.Y7g=this.Z7g=this.T7g=this.S7g=this.U7g=this.yxc=this.TKe=0;this.nKa=this.YHe=this.Wvc=this.KHe=this.BWa=this.xHe=this.Kab=this.Hvc=this.lWb=this.wHe=this.Oid=
this.IUb=null;this.qJe=this.Owc=this.Geh=this.nOg=0;this.r6g=!1;this.v6i=this.e3f;this.y6i=this.h3f;this.x6i=this.g3f;this.C6i=this.j3f;this.B6i=this.i3f;this.u3f=this.v3f;this.m3c=this.s3f;this.mMb=this.q3f;this.nMb=this.r3f;this.w6i=this.f3f;this.kRa=this.qQf;this.slb=this.rQf}e3f(){this.TKe++;this.wHe=new Date;this.IUb||(this.IUb=new Date)}h3f(){this.yxc++;this.Kab=new Date;this.Oid||(this.Oid=this.Kab);this.Wvc=this.Kab;this.T1k()}g3f(){this.U7g++;this.xHe=new Date}j3f(){this.S7g++;this.lWb=new Date}i3f(){this.T7g++;
this.Hvc=new Date}s3f(){this.BWa=new Date;this.Z7g++}r3f(){this.nKa||(this.nKa=new Date);this.Y7g++}q3f(){this.KHe=new Date;this.X7g++}v3f(){!this.r6g&&this.TKe&&(m.ULS.sendTraceTag(39321871,500,15,a.a.toJSON(this.NZk())),this.r6g=!0)}f3f(z){let n,v;({Wni:z,Yni:n,exception:v}=l.RtcUtils.Hxl(z));z&&z!==e.a.Hy&&(m.ULS.sendTraceTag(40157596,500,15,a.a.toJSON({["HttpErrorCode"]:z,["HttpErrorStatus"]:n,["Exception"]:v})),e.a.PBf(z)&&this.nOg++,e.a.RFf(z)&&this.Geh++)}qQf(){this.YHe=new Date}rQf(){this.lWb=
this.Wvc=new Date}NZk(){return{["numberOfConnectionAttempts"]:this.TKe,["numberOfSuccessfulConnections"]:this.yxc,["numberOfFailedConnections"]:this.U7g,["numberOfDisconnectedConnections"]:this.S7g,["numberOfExplicitDisconnectedConnections"]:this.T7g,["numberOfSentMessages"]:this.Z7g,["numberOfReceivedMessages"]:this.Y7g,["numberOfLostMessages"]:this.X7g,["firstConnectionAttempt"]:this.IUb?this.IUb:null,["firstMessageReceived"]:this.nKa?this.nKa:null,["firstConnectionSuccess"]:this.Oid?this.Oid:null,
["lastConnectionAttempt"]:this.wHe?this.wHe:null,["lastConnectionSuccess"]:this.Kab?this.Kab:null,["lastConnectionFailure"]:this.xHe?this.xHe:null,["lastMessageSent"]:this.BWa?this.BWa:null,["lastMessageLost"]:this.KHe?this.KHe:null,["lastDisconnect"]:this.lWb?this.lWb:null,["lastExplicitDisconnect"]:this.Hvc?this.Hvc:null,["lastTimeOnline"]:this.Wvc?this.Wvc:null,["lastTimeOffline"]:this.YHe?this.YHe:null,["maxDisconnectedTimeMs"]:this.Owc,["maxExplicitDisconnectedTimeMs"]:this.qJe,["clientConnectionErrors"]:this.nOg,
["serverConnectionErrors"]:this.Geh}}T1k(){this.IUb&&1===this.yxc&&(this.Owc=Math.max(this.Owc,this.Kab.getTime()-this.IUb.getTime()));this.lWb&&1<this.yxc&&(this.Owc=Math.max(this.Owc,this.Kab.getTime()-this.lWb.getTime()));this.Hvc&&1<this.yxc&&(this.qJe=Math.max(this.qJe,this.Kab.getTime()-this.Hvc.getTime()))}static createInstance(z){y._instance||(y._instance=new y,m.ULS.sendTraceTag(39321870,500,50,"RealtimeChannelMetrics initialized for client {0}",z));return y._instance}}y._instance=null;Object(E.a)(y,
"RealtimeChannelMetrics",null,[898,232])},1857:function(E,M,c){c.d(M,"a",function(){return m});E=c(0);class m extends Sys.EventArgs{constructor(e,a){super();this.type=e;this.Sqa=a}}Object(E.a)(m,"PersistentStateUpdateEventArgs",Sys.EventArgs,[])},1858:function(E,M,c){c.d(M,"a",function(){return m});E=c(0);class m extends Sys.EventArgs{constructor(e){super();this.QDd=e}}Object(E.a)(m,"PersistentStateClearedEventArgs",Sys.EventArgs,[])},2029:function(E,M,c){c.r(M);var m=c(0),e=c(55);class a{constructor(Da,
jb){this.wea=null;this.Hyc=Da;this.gek=jb}init(){this.Hyc.continueWith(()=>{this.wea=this.Hyc.result;this.wea.r0b(Object(e.a)(this,this.uca,"onUsersUpdated"))})}uca(){a.H1e(this.wea.D0a())&&(this.wea.U5f(Object(e.a)(this,this.uca,"onUsersUpdated")),this.gek.IsRealCoauthSession=!0)}get UOm(){return this.wea?a.H1e(this.wea.D0a()):!1}static H1e(Da){let jb=null;for(const ic of Da)if(ic)if(Da=ic.isAnonymous||!ic.email?ic.clientId:ic.email.toUpperCase(),!jb)jb=Da;else if(jb!==Da)return!0;return!1}}Object(m.a)(a,
"CoauthTelemetry",null,[729]);var l=c(7),y=c(457),z=c(73),n=c(2),v;(function(Da){Da[Da.badStatePreventedTelemetry=0]="badStatePreventedTelemetry";Da[Da.notImplemented=1]="notImplemented";Da[Da.renderHandled=2]="renderHandled";Da[Da.renderHandledWithVeto=3]="renderHandledWithVeto"})(v||(v={}));Object(m.b)("CoauthorGalleryTelemetryEndResult",v);var A=c(83),w=c(82),G=c(128);class F{constructor(Da,jb,ic,Lc,ad,ce,fc,kf,Tc){this.W$g=this.HOg=this.uD=null;this.I5=Da;this.Wud=new y.a;this.Ma=ic;this.qve=
jb;this.WY=Lc;this.Tf=ad;this.lNe=ce;this.Ebb=fc;this.sVj=kf;this.HXg=this.AXg=!1;this.qwd=0;this.FOg=1;this.trb=Tc;this.BCc=this.Ma.$("PeoplesWellExtraButtonInfoIsEnabled");this.ora=Object(z.a)(String,n.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get vuj(){return this.Wud.task}init(){G.Task.WAA.call(null,this.Ebb,this.qve,this.lNe).continueWith(()=>{this.uD=this.Ebb.result;this.HOg=this.qve.result;this.W$g=this.lNe.result;G.Task.WAA.call(null,this.qve.result.D2b,this.lNe.result.fyj).continueWith(()=>
{this.FOg=this.HOg.D2b.result;this.qwd=this.W$g.fyj.result;this.uD.r0b(Object(e.a)(this,this.k8d,"onUsersUpdatedEventListener"));this.uD.D0a().length&&this.uca()})})}k8d(){this.uca()}uca(){this.sVj(this.uD.D0a())?(this.uD.U5f(Object(e.a)(this,this.k8d,"onUsersUpdatedEventListener")),this.jmn(this.AXg)):this.Wud.VR(1);this.AXg=!0}jmn(Da){this.HXg?this.vuj.continueWith(()=>{l.ULS.sendTraceTag(42062996,325,15,"We already attempted to log a render of coauthor gallery: {0}",v[this.vuj.result])}):(this.HXg=
!0,this.vHn(0===this.FOg&&!Da))}vHn(Da){Da?this.WY.Dk(4,Object(e.a)(this,this.kUf,"onInteractiveReady")):this.Wud.VR(1)}kUf(){const Da=this.Tf.gF("AppInitStatus_interactivityReady");l.ULS.shipAssertTag(42259235,325,!!this.qwd);const jb=this.qwd-Da,ic={};ic.InteractiveTime=Da;ic.ReactRenderComplete=this.qwd;ic.HadTabSwitch=this.trb();ic.IsModernGallery=this.BCc;l.ULS.sendTraceTag(594883104,325,50,w.a.toJSON(ic));this.BCc?(l.ULS.sendTraceTag(42062997,325,15,jb.toString()),this.Wud.VR(this.P_o(jb)?3:
2)):l.ULS.sendTraceTag(594883103,325,15,jb.toString())}P_o(Da){const jb=Da>this.Ma.mc("CoauthorGalleryTimeToRenderDurationMs",1E4),ic="Word"===this.ora;if(this.trb())return l.ULS.sendTraceTag(50455714,325,50,jb.toString()),!1;ic&&A.Health.instance.recordKpiUsage("CoauthGalleryExperienceDegraded",0,"wordcollabrel",null);jb&&(ic&&A.Health.instance.recordKpiFailure("CoauthGalleryExperienceDegraded","CoauthorGalleryTimeToRenderDurationIsTooLong",!1,!0,null),l.ULS.sendTraceTag(42062998,325,15,Da.toString()));
return jb}}Object(m.a)(F,"CoauthorGalleryTelemetry",null,[728]);class I{constructor(Da){this.uD=null;this.ofd={};this.ard={};this.ruc=null;this.Ebb=Da}oRd(Da){const jb=new y.a;this.init().continueWith(()=>{Da in this.ofd?jb.VR(this.ofd[Da]):this.ard[Da]=jb});return jb.task}init(){if(this.ruc)return this.ruc.task;this.ruc=new y.a;this.Ebb.continueWith(()=>{this.uD=this.Ebb.result;this.uD.r0b(Object(e.a)(this,this.uca,"onUsersUpdated"));this.cGj();this.ruc.Ag(null)});return this.ruc.task}cGj(){const Da=
this.uD.D0a();Da.sort(Object(e.a)(this,this.r1k,"comparePresenceUsers"));this.ofd={};for(let jb=0;jb<Da.length&&Da[jb]&&Da[jb].AQa;jb++)this.Ysk(this.ofd,Da[jb].clientId,jb)}Ysk(Da,jb,ic){Da[jb]=ic;jb in this.ard&&(this.ard[jb].VR(ic),delete this.ard[jb])}uca(){this.cGj()}r1k(Da,jb){return Da.AQa>jb.AQa?1:Da.AQa<jb.AQa?-1:0}}Object(m.a)(I,"CoauthorPositionFinder",null,[727]);var K=c(585),J=c(355),N=c(497),R=c(74),O=c(136);class L{constructor(){this.NBa=null;this.hpc=Array(32)}xor(Da){if(!Da)throw Error.argumentNull("Guid argument cannot be null");
const jb=new L,ic=new Sys.StringBuilder;for(let Lc=0;Lc<Da.hpc.length;Lc++){const ad=this.hpc[Lc]^Da.hpc[Lc];jb.hpc[Lc]=ad;ic.append(ad.toString(16));7!==Lc&&11!==Lc&&15!==Lc&&19!==Lc||ic.append("-")}jb.NBa=O.a.If(ic.toString());return jb}toString(){return this.NBa.toString()}equals(Da){if(!Da)throw Error.argumentNull("Guid argument cannot be null");return this.NBa.equals(Da.NBa)}static D6b(Da){if(!Da)throw Error.argumentNull("String input cannot be null");const jb=new L;jb.NBa=O.a.If(Da);const ic=
jb.NBa.toString();let Lc=0;for(let ce=0;ce<ic.length;ce++){var ad=Da.charAt(ce);if(L.TJm(ad))ad=L.xqm(ad,Da.charCodeAt(ce)),jb.hpc[Lc++]=ad;else if(!L.qJm(ad))throw Error.argument("String contains characters not valid in Guids");}return jb}static TJm(Da){return"0"<=Da&&"9">=Da||"A"<=Da&&"F">=Da||"a"<=Da&&"f">=Da}static qJm(Da){return"{"===Da||"}"===Da||"-"===Da}static xqm(Da,jb){if("0"<=Da&&"9">=Da)return jb-48;if("A"<=Da&&"F">=Da)return jb-65+10;if("a"<=Da&&"f">=Da)return jb-97+10;throw Error.argument("Char is not valid hex digit");
}}Object(m.a)(L,"Guid",null,[]);class U{constructor(Da,jb,ic,Lc){this.wea=null;this.WQg=this.Y6g=!1;this.$3g=0;this.Hyc=Da;this.HTe=jb;this.Ma=ic;this.WWb=Lc;this.NUj=n.AFrameworkApplication.zmc||n.AFrameworkApplication.Noa;this.h5g=new K.a(J.a.ei())}get ccf(){return this.Ma.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1)}init(){this.Hyc.continueWith(()=>{this.wea=this.Hyc.result;this.wea.r0b(Object(e.a)(this,this.uca,"onUsersUpdated"))})}uca(){this.KZk(this.wea.D0a())}KZk(Da){var jb=
0;const ic=new N.a(J.a.ei());for(const Lc of Da)if(Lc&&Lc.isAnonymous){n.AFrameworkApplication.ue("70eb6120;2gfeb930");if(ic.nb(Lc.userName))ic.J(Lc.userName).add(Lc.clientId);else{let ad;ic.add(Lc.userName,(ad=new R.a,ad.add(Lc.clientId),ad))}Lc.clientId!==this.WWb?(jb++,2<=jb&&!this.Y6g&&this.d3m()):!this.WQg&&this.ccf&&"Guest"===Lc.userName&&(l.ULS.sendTraceTag(509726851,302,50,"User was assigned 'Guest' name"),this.WQg=!0)}if(this.ccf&&this.$3g!==jb){l.ULS.sendTraceTag(512553562,302,50,"Total guests updated to: {0}",
jb+(this.NUj?1:0));this.$3g=jb;for(let Lc of ic.keys)2<=ic.J(Lc).count&&(Da=this.tTl(ic.J(Lc)),this.h5g.contains(Da)||(jb={},jb.guestsWithSameName=ic.J(Lc).count,jb.identifier=Da,l.ULS.sendTraceTag(526394833,302,50,"Duplicate guest friendly name detected: {0}",jb),this.h5g.add(Da)))}}d3m(){l.ULS.sendTraceTag(525112603,302,50,"Multiple guests simultaneously coauthoring");this.Y6g=!0;this.ccf&&this.HTe&&this.HTe.continueWith(()=>{window.setTimeout(()=>{this.HTe.result.logActivity("MultipleGuestsCoauthoring",
null)},15E3)})}tTl(Da){if(!Da||1>=Da.count)return"";let jb=L.D6b(Da.J(0));for(let ic=1;ic<Da.count;ic++)jb=jb.xor(L.D6b(Da.J(ic)));return jb.toString()}}Object(m.a)(U,"GuestCoauthTelemetry",null,[]);var W=c(243);class X{constructor(){this.id=null;this.d=this.tp=this.mp=this.st=this.et=0;this.ct=null;this.vc=!1}}Object(m.a)(X,"PL",null,[]);var V=c(35);class Z{constructor(){this.ct=this.vt=this.d=0}static qij(Da,jb,ic){const Lc=new Z;Lc.d=Da;Lc.vt=jb;Lc.ct=ic;return V.c(Lc)}}Object(m.a)(Z,"VD",null,
[]);var da=c(119);class aa{constructor(Da,jb,ic,Lc,ad,ce,fc,kf,Tc,Mg,yf){this.Peh=!1;this._id=Da;this.ji=jb;this.Dgh=ic;this.Xr=Lc;this.kKe=ad;this.vUe=ce;this.ryb=fc;this.ksb=kf;this.$Xj=Tc;this.trb=Mg;this.Yjh=yf;this.ora=Object(z.a)(String,n.AFrameworkApplication.sessionStartInfoSettings.Application)||""}uoe(Da){const jb=[this.kKe,this.vUe];this.Yjh&&jb.push(this.Dgh);G.Task.WAA.apply(null,jb).continueWith(()=>{if(this.kKe.result<=this.vUe.result)Da.VR(!1);else{this.Yjh&&(this.ji=this.Dgh.result);
var ic=this.Xr-this.ji,Lc=new X;Lc.id=this._id;Lc.et=this.Xr;Lc.st=this.ji;Lc.d=this.Xr-this.ji;Lc.mp=this.kKe.result;Lc.tp=this.vUe.result;Lc.ct=this.AOl(this.$Xj);Lc.vc=this.trb();var ad=V.c(Lc),ce="Word"===this.ora;l.ULS.sendTraceTag(42078597,302,15,ad);if(ce){const fc=new Map;fc.set("data",ad);A.Health.instance.recordKpiUsage("PresenceExperienceDegraded",0,"wordcollabrel",fc)}ic>this.ryb.value&&!this.Peh&&!Lc.vc&&(this.Peh=!0,Da.VR(!0),Lc=Object.assign(new da.a,{inStaging:!0,extendedProperties:new Map}),
Lc.extendedProperties.set("data",ad),ce&&A.Health.instance.recordKpiFailure("PresenceExperienceDegraded","PresenceRenderDurationIsTooLong",!1,!0,Lc),ic<this.ksb.value&&l.ULS.sendTraceTag(42078598,302,15,Z.qij(ic,this.ryb.value,this.ksb.value)));Da.task.isCompleted||Da.VR(!1)}})}AOl(Da){switch(Da){case 2:return"NonWac";case 0:return"Unknown";case 1:return"Wac";default:return"Unknown"}}}Object(m.a)(aa,"PresenceLatencyActivityLogger",null,[]);class ea{constructor(Da,jb,ic){this.yNg=this.DOg=this.Wed=
this.nfd=this.ZRb=0;this._id=Da;this.ryb=jb;this.ksb=ic;this.ora=Object(z.a)(String,n.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get arh(){return this.ZRb}set arh(Da){this.ZRb=Da;this.r6e()}get NEh(){return this.nfd}set NEh(Da){this.nfd=Da;this.r6e()}get VAh(){return this.Wed}set VAh(Da){this.Wed=Da;this.r6e()}get OEh(){return 0!==this.DOg}get WAh(){return 0!==this.yNg}r6e(){!this.OEh&&this.ZRb&&this.nfd&&(this.DOg=this.uoe(this.nfd,"CoauthGalleryLightupDurationTooLong"));!this.WAh&&
this.ZRb&&this.Wed&&(this.yNg=this.uoe(this.Wed,"CanvasPresenceLightupDurationTooLong"))}uoe(Da,jb){const ic=Da-this.ZRb;var Lc=new X;Lc.id=this._id;Lc.et=Da;Lc.st=this.ZRb;Lc.d=ic;var ad=V.c(Lc);Da="Word"===this.ora;Lc="CanvasPresenceLightupDurationTooLong"===jb?"PresenceExperienceDegraded":"CoauthGalleryExperienceDegraded";"CanvasPresenceLightupDurationTooLong"===jb?l.ULS.sendTraceTag(572289499,302,15,ad):l.ULS.sendTraceTag(571524118,302,15,ad);if(Da){var ce=new Map;ce.set("data",ad);A.Health.instance.recordKpiUsage(Lc,
0,"wordcollabrel",ce)}return ic>this.ryb.value?(ce=Object.assign(new da.a,{inStaging:!0,extendedProperties:new Map}),ce.extendedProperties.set("data",ad),ad=ic<this.ksb.value,ce.extendedProperties.set("cash",ad?"true":"false"),Da&&A.Health.instance.recordKpiFailure(Lc,jb,!1,!0,ce),l.ULS.sendTraceTag(572289500,302,15,Z.qij(ic,this.ryb.value,this.ksb.value)),ad?2:1):3}}Object(m.a)(ea,"PresenceLightupLatencyLogger",null,[]);var na=c(47),pa=c(167);class ja{constructor(Da,jb,ic,Lc,ad,ce,fc,kf=null,Tc=
null,Mg=null){this.bbh={};this.pve={};this.C2g=new R.a;this.Eed=this.suc=this.uD=this.fj=null;this.NSe=this.KSe=0;this.ryb=new W.a(()=>kf.GO("PresenceBootLatencyThreshold",1E4));this.ksb=new W.a(()=>kf.GO("PresenceBootLatencyCutoffThreshold",6E4));this.snk=new W.a(()=>kf.GO("PresenceLightupLatencyThreshold",2E3));this.b_j=new W.a(()=>kf.GO("PresenceLightupLatencyCutoffThreshold",1E4));this.WY=Lc;this.Ma=kf;this.nek=ad;this.GOg=Da;this.Bdh=jb;this.Ebb=ic;this.Tf=ce;this.WWb=Tc;this.trb=fc;this.NXg=
Mg;this.Dte=!1;this.init()}AKc(Da,jb,ic=null,Lc=0){ic&&(l.ULS.shipAssertTag(42274970,302,!this.WWb||this.WWb===ic,"_myClientId is already set and you are trying to update it to something different"),this.WWb=ic);const ad=new y.a;this.init().continueWith(()=>{this.bqn(Da);this.atl(ad,Da,jb,Lc)})}get aQf(){return this.WWb||"{"+n.AFrameworkApplication.userSessionId+"}"}init(){if(this.suc)return this.suc.task;this.suc=new y.a;this.trb()&&l.ULS.sendTraceTag(50951700,302,15,"TabSwitched Session");this.GOg.continueWith(()=>
{const Da=this.GOg.result,jb=Da.D2b,ic=Da.Ecn;ic.continueWith(()=>{jb.continueWith(()=>{this.NXg&&this.NXg.addQosPillar("RealTimeCoauth");this.Zfg(jb.result,ic.result);this.suc.Ag(null)})})});this.Bdh.continueWith(()=>{this.fj=this.Bdh.result;this.fj.Ata(Object(e.a)(this,this.prn,"onRtcConnection"));this.fj.b3(Object(e.a)(this,this.jkn,"onCoauthorBootReceived"))});this.Ebb.continueWith(()=>{this.uD=this.Ebb.result;this.uD.r0b(Object(e.a)(this,this.k8d,"onUsersUpdatedEventListener"));0<this.uD.D0a().length&&
this.uca()});return this.suc.task}k5h(){return this.Tf.yfa(na.a.X7a)?this.Tf.gF(na.a.X7a):pa.a.aeb?window.performance.timing.fetchStart:-1}v$h(){this.Eed||(this.Eed=new y.a,this.WY.Dk(4,()=>{this.Eed.VR(this.Tf.gF("AppInitStatus_interactivityReady"))}));return this.Eed.task}prn(Da,jb){if(!this.Dte&&2===jb.newState)if(this.Sne){const ic=this.v$h();ic.continueWith(()=>{var Lc=ic.result;Lc=Date.now()-Lc;const ad={};ad.clientId=this.aQf;ad.bootTime=Lc;this.Dte=!0;this.fj.XM(15,ad)})}else Da=this.k5h(),
Da=Date.now()-Da,jb={},jb.clientId=this.aQf,jb.bootTime=Da,this.Dte=!0,this.fj.XM(15,jb)}jkn(Da,jb){if(15===jb.type){Da=Date.now();jb=jb.tL;var ic=jb.bootTime;this.erf(jb.clientId).arh=Da-ic}}k8d(){this.uca()}uca(){const Da=Date.now();var jb=this.uD.D0a();const ic=new R.a;for(const Lc of jb)this.C2g.contains(Lc.clientId)||(this.C2g.add(Lc.clientId),ic.add(Lc.clientId));if(0<ic.count)for(let Lc of ic)jb=this.erf(Lc),jb.OEh||(jb.NEh=Da)}bqn(Da){Da=this.erf(Da);Da.WAh||(Da.VAh=Date.now())}erf(Da){return Da in
this.pve?this.pve[Da]:this.pve[Da]=new ea(Da,this.snk,this.b_j)}Zfg(Da,jb=0){this.KSe=Da;this.NSe=jb?jb:(new Date).getTime()}atl(Da,jb,ic,Lc){ic=ic?ic.getTime():(new Date).getTime();if(jb in this.bbh)Da.pja();else{const ad=this.Sne?0:this.Gbm(),ce=this.Sne?this.Hbm():null;Lc=new aa(jb,ad,ce,ic,this.oRd(this.aQf),this.oRd(jb),this.ryb,this.ksb,Lc,this.trb,this.Sne);this.bbh[jb]=Lc;Lc.uoe(Da)}}Gbm(){return 1===this.KSe?this.NSe:this.k5h()}Hbm(){return 1===this.KSe?G.Task.J3(this.NSe):this.v$h()}oRd(Da){return this.nek.oRd(Da)}get Sne(){return this.Ma.$("UseAppInteractiveBootTimeForPresenceTelemetry")}}
Object(m.a)(ja,"PresenceBootTelemetry",null,[726]);var ma=c(130),Ia=c(179),Ja=c(232),Ka=c(22),Ma=c(627);class sa{get name(){return"Common.App.CoauthTelemetry"}xc(Da){Da.register(a,"Common.App.CoauthTelemetry.CoauthTelemetry").as("Common.App.CoauthTelemetry.ICoauthTelemetry").singleInstance().Rd(()=>new a(Ma.a.Ap(Da.Sa("Common.IPeopleInfoProvider")),n.AFrameworkApplication.Kg));Da.register(F,"Common.App.CoauthTelemetry.CoauthorGalleryTelemetry").as("Common.ICoauthorGalleryTelemetry").singleInstance().Rd(()=>
new F(n.AFrameworkApplication.va,Ma.a.Ap(Da.Sa("Common.ICoauthoringTelemeryInfoProvider")),n.AFrameworkApplication.K,ma.a.get_instance(),Ja.a.instance,Ma.a.Ap(Da.Sa("Common.IPeoplesWell")),Ma.a.Ap(Da.Sa("Common.IPeopleInfoProvider")),a.H1e,()=>this.Kxh()));Da.register(ja,"Common.App.CoauthTelemetry.PresenceBootTelemetry").as("Common.App.CoauthTelemetry.IPresenceBootTelemetry").singleInstance().Rd(()=>new ja(Ma.a.Ap(Da.Sa("Common.ICoauthoringTelemeryInfoProvider")),Ma.a.Ap(Da.Sa("Common.IRealtimeChannelBasic")),
Ma.a.Ap(Da.Sa("Common.IPeopleInfoProvider")),ma.a.get_instance(),Da.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"),Ja.a.instance,()=>this.Kxh(),n.AFrameworkApplication.K,null,A.Health.instance));Da.register(I,"Common.App.CoauthTelemetry.CoauthorPositionFinder").as("Common.App.CoauthTelemetry.ICoauthorPositionFinder").singleInstance().Rd(()=>new I(Ma.a.Ap(Da.Sa("Common.IPeopleInfoProvider"))));Da.register(U,"Common.App.CoauthTelemetry.GuestCoauthTelemetry").singleInstance().Rd(()=>new U(Ma.a.Ap(Da.Sa("Common.IPeopleInfoProvider")),
Ma.a.Ap(Da.Sa("Common.ISystemInitiatedFeedback")),n.AFrameworkApplication.K,"{"+n.AFrameworkApplication.userSessionId+"}"))}init(){n.AFrameworkApplication.K.No(()=>{Ka.a.instance.resolve("Common.App.CoauthTelemetry.CoauthTelemetry").init();Ka.a.instance.resolve("Common.App.CoauthTelemetry.GuestCoauthTelemetry").init();n.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&Ka.a.instance.resolve("Common.ICoauthorGalleryTelemetry").init();n.AFrameworkApplication.K.$("CashTelemetryIsEnabled")&&
(Ka.a.instance.resolve("Common.App.CoauthTelemetry.IPresenceBootTelemetry"),Ka.a.instance.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"))})}dispose(){}Kxh(){return pa.a.aeb&&Ja.a.instance.yfa(na.a.qbd)?0<Ja.a.instance.gF(na.a.qbd)[na.a.aJj]:!1}static main(){Ia.a.instance.Fc(new sa)}}Object(m.a)(sa,"CoauthTelemetryPackage",null,[1,2]);class xa extends Sys.EventArgs{constructor(){super()}}Object(m.a)(xa,"RtcHostNotificationEventArgs",Sys.EventArgs,[]);var ia;(function(Da){Da[Da.notYetStarted=
0]="notYetStarted";Da[Da.polling=1]="polling";Da[Da.subscribed=2]="subscribed";Da[Da.blocked=3]="blocked";Da[Da.permanentlyStopped=4]="permanentlyStopped"})(ia||(ia={}));Object(m.b)("RtcHostNotificationSubscriptionState",ia);var ha=c(92),ua=c(1399),ya=c(80);class ra{constructor(Da,jb,ic,Lc,ad,ce,fc,kf,Tc){this.Kh=!1;this.haa=this.YXb=this.Lea=this.JXa=null;this.rBc=ra.jre;this.ra=new ya.a;this.Ccb=new ua.a(0);this.Ccb.q_e(Object(e.a)(this,this.wsn,"onStateMachineChanged"));this.Tgk=Da;this.otd=jb;
this.Sgk=ic;this.dQe=Lc;this.Hb=ad;this.af=ce;fc.execute(Mg=>{this.Kh||(this.YXb=Mg,this.YXb.b3(Object(e.a)(this,this.w0,"onUpdateNotificationReceived")),this.start())});kf.execute(Mg=>{this.Kh||(this.haa=Mg,Mg.VYa(Object(e.a)(this,this.Wha,"onTokenRefreshed")))});this.nwd=Tc}get pkc(){return this.Ccb.currentState}get KAi(){return!this.af||this.af.Swa}get cBi(){return 2===this.pkc&&this.nwd()<this.rBc}start(){0!==this.pkc?l.ULS.sendTraceTag(573100178,502,15,"HostNotifications: Tried starting poll when in state {0}",
ia[this.pkc]):(this.Ccb.event(1),this.i$f(null))}i$f(){this.JXa=null;if(this.KAi){l.ULS.sendTraceTag(573100181,502,50,"HostNotifications: Send event when connected.  Current state: {0}",ia[this.pkc]);let Da=null;this.dQe&&this.dQe.length&&(Da={},Da.etts=this.dQe);this.YXb.XM(14,Da,!0);this.ggj(this.Tgk)}else this.Ccb.event(3)}ggj(Da){this.JXa=ha.a.K7(1E3*Da,Object(e.a)(this,this.i$f,"sendSubscribeEvent"),this.otd,192,"RtcHostNotificationSubscribe");this.Hb.Vb(this.JXa)}X9n(Da){Da=1E3*(Da+this.Sgk);
const jb=this.nwd().getTime()+Da;this.rBc=new Date(jb);Da-=this.otd;this.Lea?this.Hb.K0(this.Lea,Da):(this.Lea=ha.a.K7(Da,Object(e.a)(this,this.uKo,"transitionToPollingEvent"),this.otd/2,194,"RtcHostNotificationTransitionToPolling"),this.Hb.Vb(this.Lea))}uKo(){this.Lea=null;2===this.pkc&&(this.Ccb.event(1),l.ULS.shipAssertTag(573100185,502,!!this.JXa,"Missing task to ensure that we re-subscribe."))}Wha(){this.okm()}okm(){3===this.pkc&&this.KAi&&(this.Ccb.event(this.cBi?2:1),this.i$f(null))}w0(Da,
jb){if(13===jb.type&&(Da=jb.tL,l.ULS.sendTraceTag(573100183,502,50,"HostNotifications: Subscription status: {0}",{["SerializableHostNotificationSubscription"]:Da,["DurationBeforeExpirationToResubscribeInSec"]:this.otd}),jb=Da.cts,!this.aNo(jb))){if(Da.sb){var ic=2;this.X9n(Da.cts)}else ic=1,this.rBc=ra.jre,this.Lea&&(this.Hb.Ve(this.Lea),this.Lea=null);this.Ccb.event(ic);this.JXa?this.Hb.K0(this.JXa,1E3*jb):this.ggj(jb)}}aNo(Da){if(!isNaN(Da)&&isFinite(Da)&&0<Da)return!1;this.Kuj(!1);return!0}Kuj(Da){this.JXa&&
(this.Hb.Ve(this.JXa),this.JXa=null);this.Lea&&(this.Hb.Ve(this.Lea),this.Lea=null);this.YXb&&(this.YXb.MMb(Object(e.a)(this,this.w0,"onUpdateNotificationReceived")),this.YXb=null);this.haa&&(this.haa.KMb(Object(e.a)(this,this.Wha,"onTokenRefreshed")),this.haa=null);Da||this.Ccb.event(4)}wsn(Da,jb){Da=jb.newState;const ic=jb.A_f,Lc={};Lc.NewState=ia[Da];Lc.PreviousState=ia[ic];Lc.PreviousStateHits=jb.B_f;Lc.PreviousStateTransitionTime=jb.C_f.toISOString();Lc.IsSubscribed=this.cBi;this.rBc!==ra.jre&&
(Lc.SubscriptionExpiringTime=this.rBc.toISOString());l.ULS.sendTraceTag(572346515,502,4===Da?15:50,"HostNotificationChanged: {0}",Lc);this.ra.raiseEvent("HN",new xa(ic,Da))}dispose(){this.Kh||(this.Kh=!0,this.Kuj(!0),this.Lea&&(this.Hb.Ve(this.Lea),this.Lea=null))}}ra.jre=new Date(0);Object(m.a)(ra,"RtcHostNotificationSubscriptionManager",null,[704,9]);var La=c(396);class oa{constructor(){this.Ah=this.Kh=!1}get name(){return"RtcHostNotificationSubscription"}xc(Da){Da.register(ra,"Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").as("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager").singleInstance().Rd(()=>
{const jb=n.AFrameworkApplication.K;return new ra(jb.mc("RtcHostNotificationRetryIntervalIdeallyInSeconds",1800),jb.mc("RtcHostNotificationRetryIntervalBufferInSeconds",120),jb.mc("RtcHostNotificationSubscriptionLostBufferInSeconds",60),this.r$l(jb),n.AFrameworkApplication.nc,La.SessionStatusManager.instance,Da.Sa("Common.IRealtimeChannelBasic"),Da.Sa("Common.ISessionExpirationManager"),()=>new Date)})}init(){n.AFrameworkApplication.K.No(()=>{!this.Kh&&n.AFrameworkApplication.K.$("RtcHostNotificationEnabled")&&
(this.Ah=!0,Ka.a.instance.resolve("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager"))})}dispose(){this.Kh||(this.Kh=!0,this.Ah&&Ka.a.instance.resolve("Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").dispose())}r$l(Da){return Da.Nw("RtcEventTypesToSubscribe")?Da.GC("RtcEventTypesToSubscribe"):null}static main(){Ia.a.instance.Fc(new oa)}}Object(m.a)(oa,"RtcHostNotificationSubscriptionPackage",null,[1,2]);var Ca=c(464),Aa=c(639);
class db{constructor(Da,jb,ic,Lc,ad,ce,fc,kf,Tc,Mg,yf){this.clientId=Da;this.SkypeChatThreadId=ic;this.chatThreadDiscoveryUri=Lc;this.inChat=ad;this.localColbaltSessionId=jb;this.capabilities=ce;this.email=fc;this.isReadOnly=kf;this.userName=Tc;this.isAnonymous=Mg;this.presenceStatus=yf}}Object(m.a)(db,"SerializablePresenceUserData",null,[]);class eb extends Ca.a{constructor(Da,jb,ic,Lc,ad=null,ce=null,fc=null,kf=null,Tc=null,Mg=!1,yf=!1,ng=!1,ji=null){super(Da,jb,ic,Lc,ce,fc,kf,Tc,Mg,yf,ng);this.bP=
ad;this.presenceStatus=ji}getData(){return new db(this.clientId,this.bP,this.LFc,this.chatThreadDiscoveryUri,this.inChat,this.capabilities.capabilities,this.email,this.isReadOnly,this.userName,this.isAnonymous,this.presenceStatus)}pRd(Da){return(Da=Da.value)?Da.user:null}clone(){return new eb(this.clientId,this.userName,this.color,this.capabilities.clone(),this.bP,this.LFc,this.email,this.client,this.chatThreadDiscoveryUri,this.isAnonymous,this.inChat,this.isReadOnly,this.presenceStatus)}static aBb(Da){return Da.clientId?
new eb(Da.clientId,Da.userName,null,new Aa.a(void 0===Da.capabilities?0:Da.capabilities),Da.localColbaltSessionId,Da.SkypeChatThreadId,Da.email,null,Da.chatThreadDiscoveryUri,Da.isAnonymous,Da.inChat,Da.isReadOnly,Da.presenceStatus):null}static TKh(Da,jb,ic,Lc=null,ad=null,ce=null,fc=null,kf=null,Tc=!1,Mg=!1,yf=!1,ng=null){return Da?new eb(Da,jb,null,new Aa.a(void 0===ic?0:ic),Lc,ad,ce,fc,kf,yf,Tc,Mg,ng):null}}Object(m.a)(eb,"PresenceUser",Ca.a,[1211,1212,20]);class ib extends eb{constructor(){super();
this.Zfc=this.PJf=null}j2l(){const Da=n.AFrameworkApplication.userName,jb=n.AFrameworkApplication.K.jb("UserPrincipalName"),ic=this.PJf?this.PJf.bP:null,Lc=n.AFrameworkApplication.zmc||n.AFrameworkApplication.Noa,ad=this.Zfc?this.Zfc.getStatus():null;return new eb(this.clientId,Da,this.color,this.capabilities,ic,this.LFc,jb,this.client,this.chatThreadDiscoveryUri,Lc,this.inChat,this.isReadOnly,ad)}}Object(m.a)(ib,"MyPresenceUser",eb,[1276,20]);var lb=c(215);class Ya{constructor(Da,jb,ic,Lc,ad){this.Sd=
Da;this._clientId=jb;this.f0j=ad;this.V3j=ic||(()=>null);this.W3j=Lc||(()=>null)}get id(){return this.Sd.id}get nyd(){return this.Sd.nyd}get ryd(){return this.Sd.ryd}get qyd(){return this.Sd.qyd}get pyd(){return this.Sd.pyd}get oyd(){return this.Sd.oyd}get tyd(){return this.Sd.tyd}get NXe(){return this.Sd.NXe}get Pjc(){return this.Sd.Pjc}get Vie(){return this.Sd.Vie}get K4d(){return this.Sd.K4d}get clientId(){return this._clientId}get HPc(){return this.V3j}get Uhb(){return this.W3j}get wnl(){return this.f0j}static createInstance(Da,
jb,ic,Lc,ad=!1){return new Ya(Da,jb,ic,Lc,ad)}}Object(m.a)(Ya,"PeoplesWellSettings",null,[]);var Fa=c(9),$a=c(65),Db=c(166),gc=c(106),Eb=c(205),kb=c(160),bb=c(398),Gb=c(336);class Sa extends Eb.a{constructor(){super();this.JoinTimeInMS=0;this.IsAnonymous=!1;this.ImageUrl=null;this.CanJump=this.ActiveStatus=!1;this.Upn=null}get ControlType(){return 5}}Object(m.a)(Sa,"PeopleButtonProps",Eb.a,[]);var Pa=c(413),Ab=c(414),nb=c(19),Rb=c(77);class Mb{constructor(Da){this.rbd=new Rb.a;this.bcf=null;this.clientId=
Da}ymo(Da){this.YWn();this.$eo(Da);for(const jb of Da)jb.clientId!==this.clientId&&this.fph(jb)}get Gng(){const Da=[];for(let jb of this.rbd.values){const ic=this.dhj(jb);Array.add(Da,ic)}return Da}get Flb(){return this.rbd.count}DZe(Da,jb){Da=Da.toUpperCase();let ic;({value:ic}=this.rbd.Dc(Da)).returnValue||(ic=[],this.rbd.Z(Da,ic));Array.add(ic,jb)}YWn(){this.rbd=new Rb.a}$eo(Da){for(const jb of Da)if(jb.clientId===this.clientId){this.bcf=jb;break}}}Object(m.a)(Mb,"UserTracker",null,[1007]);class oc extends Mb{constructor(Da,
jb){super(Da);this.X3j=jb}fph(Da){Da.isAnonymous||!Da.email?this.DZe(Da.clientId,Da):this.bcf&&J.a.ei().equals(this.bcf.email,Da.email)||this.DZe(Da.email,Da)}dhj(Da){let jb=new Date(0),ic=0<Da.length?Da[0]:null;for(const Lc of Da)(Da=this.X3j(Lc.clientId))&&jb.getTime()<Da.qcc.getTime()&&(jb=Da.qcc,ic=Lc);return ic}}Object(m.a)(oc,"UniqueUserTracker",Mb,[]);class xb extends Mb{constructor(Da){super(Da)}fph(Da){this.DZe(Da.clientId,Da)}dhj(Da){return Da[0]}}Object(m.a)(xb,"UserInstanceTracker",Mb,
[]);const cc=(Da,jb,ic)=>ic?new oc(Da,jb):new xb(Da);var Ob=c(67),Ub=c(600),pb=c(13);class Zb{constructor(Da,jb=null,ic=null){this.uD=null;this.EUe=new y.a;this.Sd=Da;this.K9d=jb;ic&&ic.continueWith(()=>{this.uD=ic.result;this.uD.r0b(Object(e.a)(this,this.uca,"onUsersUpdated"));this.sce()});new Ca.a(this.settings.clientId,"Anonymous user","#cccccc",new Aa.a(7));this.vYd=this.zGe=!0;this.oCe=this.kNe=!1;this.kza=cc(this.settings.clientId,this.settings.Uhb,Da.wnl)}get settings(){return this.Sd}get DFm(){return n.AFrameworkApplication.K?
n.AFrameworkApplication.K.$("ColorPresenceHashIsEnabled"):!1}get qui(){return n.AFrameworkApplication.K?n.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"):!1}yQl(){let Da;let jb,ic,Lc,ad;var ce=this.zQl();this.kza.Flb?1===this.kza.Flb?(jb=!0,ic=this.settings.Pjc.cluster,Lc=this.settings.Pjc.cHd,ad=this.kza.Gng[0].color):(jb=!0,ic=this.settings.K4d.cluster,Lc=this.settings.K4d.cHd,ad=""):(jb=!1,ad=Lc=ic="");Da=ce[0];ce=ce.slice(1);return{Kvn:Da,Lvn:ce,Gvn:jb,jip:ic,Ivn:Lc,Hvn:ad}}zQl(){if(2<=
this.kza.Flb)return[String.format(CommonUIStrings.l_PeoplesWellStateNumberOfOtherPeopleEditingHere,this.kza.Flb)];if(1===this.kza.Flb){const Da=this.kza.Gng[0],jb=this.settings.Uhb(Da.clientId);return jb&&2===jb.status?[CommonUIStrings.l_PeoplesWellStateUserIsInactive,Da.userName]:[Da.isReadOnly?CommonUIStrings.l_PeoplesWellStateUserIsAlsoViewing:CommonUIStrings.l_PeoplesWellStateUserIsAlsoEditing,Da.userName]}return[CommonUIStrings.l_PeoplesWellStateYouAreAllByYourself]}vgm(Da){return this.wgm(Da)}vAh(Da,
jb,ic){return jb?this.wRk(jb)?(Da=this.settings.Uhb(Da))&&2===Da.status?!1:!0:(ic&&l.ULS.sendTraceTag(4482394,325,50,"User has presence data but app can't use it"),!1):(ic&&l.ULS.sendTraceTag(4482393,325,50,"User does not have any presence data"),!1)}Nbm(Da){return Da.isReadOnly?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOffline:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}wgm(Da){if(!Da.capabilities.DEa(1))return this.Nbm(Da);const jb=Da.isReadOnly,ic=this.settings.Uhb(Da.clientId);
Da=this.settings.HPc(Da.clientId);if(!ic)return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;switch(ic.status){case 1:return Da?jb?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOnline:this.W5k(Da)||CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;case 2:return CommonUIStrings.l_PeoplesWellUserStatusIsInactive;default:return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}}CYl(Da){if(this.K9d.kWc)return this.K9d.lBb(Da.email,
"O365",n.AFrameworkApplication.hm,0)}hgm(Da){Da=this.settings.Uhb(Da.clientId);return!Da||Da&&1===Da.status?!0:!1}jgm(Da){var jb=String.format("buttonPeoplesWellUser-{0}",Da.clientId),ic=Da.clientId,Lc=this.vgm(Da);const ad=Da.userName,ce=Da.color;var fc=Object,kf=fc.assign,Tc=new Sa,Mg=this.settings.tyd.toString(),yf=this.settings.Vie.cluster,ng=this.settings.Vie.cHd,ji=this.l7h(),kj=Da.isAnonymous,fl;if(fl=[ad],fl.length){var dj=new Sys.StringBuilder("STRARRY@");for(const yk of fl)dj.append(yk?
yk.length:0),dj.append(","),dj.append(yk),dj.append(",");fl=dj.toString().slice(0,-1)}else fl=null;jb=kf.call(fc,Tc,{Id:jb,Command:Mg,LabelText:"{0}",Image32by32:yf,Image32by32Class:ng,MenuItemId:ic,CommandValueId:ic,Alt:ad,DisplayMode:ji,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word",Description:Lc,ImageBackColor:ce,IsAnonymous:kj,LabelTextUserGeneratedPlaceholderReplacements:fl,Upn:Da.email});n.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&
this.K9d&&(ic=this.CYl(Da),Lc=this.hgm(Da),jb.ImageUrl=ic,jb.ActiveStatus=Lc,jb.JoinTimeInMS=Da.AQa,Da=this.vAh(Da.clientId,this.settings.HPc(Da.clientId),!1),jb.CanJump=Da,""===ic&&l.ULS.sendTraceTag(40969413,302,50,"ImageURL collection failed"));return jb}OWl(){return Object.assign(new Eb.a,{Id:"BasicChat",Command:"2288458806",LabelText:CommonUIStrings.l_StartGroupChat,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word"})}l7h(){return this.DFm?"Initials":
"Menu32"}kgm(Da){const jb=[];for(const ic of Da)Da=this.jgm(ic),Array.add(jb,Da);return jb}VXd(){return 0<this.kza.Flb}LKn(Da){if(!this.zGe)return!0;this.vYd||(Da[Ub.a.Visible]=!0);let jb,ic,Lc,ad,ce;({Kvn:jb,Lvn:ic,Gvn:Lc,Ivn:ad,Hvn:ce}=this.yQl());Da[Ub.a.LabelText]=jb;ic&&ic.length&&(Da[Ub.a.LabelTextUserGeneratedPlaceholderReplacements]=ic);Da[Ub.a.ImageIsVisible]=Lc;Da[Ub.a.Image16by16Class]=ad;Da[Ub.a.ImageBackColor]=ce;this.zGe=!1;return!0}eCn(Da){if(0>=this.kza.Flb)return!1;var jb=this.Gxo(this.kza.Gng),
ic=this.kgm(jb);jb=Object.assign(new bb.a,{Id:"menuCoauthors",MaxWidth:"220px",MenuSectionList:[]});ic=Object.assign(new Gb.a,{Id:"msCoauthors",ControlsId:"msCoauthorsControls",DisplayMode:this.l7h(),ControlList:ic});n.AFrameworkApplication.K.$("WordEditorDisplayPeoplesWellLabelIsEnabled")&&this.K9d&&(ic.Title=CommonUIStrings.l_PeoplesWellFlyoutLabel,ic.TitleId="menuCoauthorsTitle",ic.Theme="Light");Array.add(jb.MenuSectionList,ic);n.AFrameworkApplication.K.$("DocChatIsEnabled")&&n.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&
n.AFrameworkApplication.ta&&n.AFrameworkApplication.ta.Nb.Yq&&(ic=[],Array.add(ic,this.OWl()),ic=Object.assign(new Gb.a,{Id:"msGroupChat",ControlsId:"msGroupChatControl",ControlList:ic}),Array.add(jb.MenuSectionList,ic));n.AFrameworkApplication.ta&&n.AFrameworkApplication.ta.Nb.Yq?Da.MenuItems=jb:Da.PopulationXML=kb.o(jb);return!0}Dng(Da){l.ULS.sendTraceTag(4482395,325,50,"PeoplesWell: Received user button click");Da=Da.MenuItemId;if(!Da)return!1;const jb=this.settings.HPc(Da);if(!this.vAh(Da,jb,
!0))return!1;this.zUm(jb);return!0}JRn(){const Da=this.MKl();this.kza.ymo(Da);this.vYd&&1<=this.kza.Flb&&(l.ULS.sendTraceTag(6092429,325,50,"PeoplesWell: User is no longer forever alone."),this.vYd=!1);this.zGe=!0}uca(){this.oCe||(window.setTimeout(()=>{this.sce();this.oCe=!1},3E3),this.oCe=!0)}MKl(){let Da;Da=this.LKl()||[];for(const jb of Da)this.A8n(jb);return Da}A8n(Da){Da.clientId||(Da.clientId=O.a.create().toString());Da.userName||(Da.userName="Anonymous user");Da.capabilities||(Da.capabilities=
new Aa.a);Da.color||(Da.color="#cccccc");Da.AQa||(Da.AQa=0)}Gxo(Da){const jb=[];Array.addRange(jb,Da);jb.sort(Zb.uvn);return jb}cVn(){n.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&!this.kNe&&(n.AFrameworkApplication.va.v_(pb.a.ZEh)&&Pa.a.isSharedUxGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DoNotRegisterCoauthorsRenderedMultiplTimes")||n.AFrameworkApplication.va.fb(pb.a.ZEh,Ob.a.frame,Object(e.a)(this,this.kkn,"onCoauthorGalleryFirstRender"),96));this.dVn();this.kNe=
!0;this.sce()}kkn(Da,jb,ic,Lc,ad){this.EUe.VR(ad.RenderTime);return 32}get fyj(){return this.EUe.task}sce(){if(!this.kNe&&(this.EUe.VR((new Date).getTime()),l.ULS.sendTraceTag(42567504,325,50,"We are trying to render the coauthor gallery before we are ready to record the render time"),this.qui))return;this.JRn();this.qui&&this.vYd?n.AFrameworkApplication.K&&n.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||Ab.a.Ydc("ribbon","coauthorGallery"):
(n.AFrameworkApplication.K&&n.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||(Ab.a.bpa("ribbon","coauthorGallery"),Ab.a.pRa("ribbon","coauthorGallery")),this.KRn())}dispose(){this.uD&&(this.uD.U5f(Object(e.a)(this,this.uca,"onUsersUpdated")),this.uD=null)}static uvn(Da,jb){return Da.capabilities.DEa(1)&&jb.capabilities.DEa(1)||!Da.capabilities.DEa(1)&&!jb.capabilities.DEa(1)?nb.a.localeCompare(Da.userName,jb.userName):Da.capabilities.DEa(1)?
-1:1}}Object(m.a)(Zb,"APeoplesWell",null,[933,9]);var Wa=c(12);const Lb=()=>!0;class qc extends Zb{constructor(Da,jb,ic=null,Lc=null){super(Da,ic,Lc);this.sGm=(ad,ce,fc,kf,Tc)=>this.F1a(fc,Tc,()=>this.VXd(),Lb);this.MKn=(ad,ce,fc,kf,Tc)=>this.F1a(fc,Tc,Mg=>this.LKn(Mg),Lb);this.fCn=(ad,ce,fc,kf,Tc)=>this.F1a(fc,Tc,Lb,Mg=>this.eCn(Mg));this.A_k=(ad,ce,fc,kf,Tc)=>this.F1a(fc,Tc,Lb,Lb);this.z_k=(ad,ce,fc,kf,Tc)=>this.F1a(fc,Tc,Lb,Lb);this.TYo=(ad,ce,fc,kf,Tc)=>this.F1a(fc,Tc,Lb,Mg=>this.Dng(Mg));this.Yzn=
(ad,ce,fc,kf,Tc)=>this.F1a(fc,Tc,Lb,()=>{this.sce();return!0});this.ga=jb}F1a(Da,jb,ic,Lc){let ad=!1;switch(Da){case 1:ad=ic(jb);break;case 2:ad=Lc(jb)}return ad?32:8}dVn(){this.ga.qa(this.settings.nyd,Wa.a.application,this.sGm);this.ga.fb(this.settings.ryd,Wa.a.application,this.MKn,96);this.ga.fb(this.settings.pyd,Wa.a.application,this.A_k,96);this.ga.fb(this.settings.oyd,Wa.a.application,this.z_k,96);this.ga.fb(this.settings.qyd,Wa.a.application,this.fCn,96);this.ga.qa(this.settings.tyd,Wa.a.application,
this.TYo);this.ga.fb(this.settings.NXe,Wa.a.application,this.Yzn,96)}}Object(m.a)(qc,"ABox4PeoplesWell",Zb,[]);var Ra=c(3),yb=c(46),Bb=c(8),cb=c(28),Xa=c(165);class hb{static isSupported(Da){for(let jb=0;jb<hb.Pvj.length;jb++)if(Da===hb.Pvj[jb])return!0;return!1}}hb.Pvj=[1];Object(m.a)(hb,"RTTDataVersion",null,[]);var Cb=c(1613);const ob=Da=>{if("number"!==typeof Da.RK||"number"!==typeof Da.DK)return!1;let jb,ic=!1,Lc=!1,ad=!1;switch(Da.RK){case 0:Lc=jb=!0;break;case 1:ad=ic=Lc=jb=!0;break;case 2:if(null!=
Da.PE&&"number"!==typeof Da.PE)return!1;jb=!0;break;case 4:jb=!0;break;case 3:Lc=jb=!0;break;case 5:ic=jb=!0;break;default:return!1}return jb&&("number"!==typeof Da.PS||"number"!==typeof Da.TS)||Lc&&("object"!==typeof Da.OS||!Da.OS||!Cb.validateVersionedCpData(Da.OS))||ic&&("number"!==typeof Da.PE||"number"!==typeof Da.TE)||ad&&("object"!==typeof Da.OE||!Da.OE||!Cb.validateVersionedCpData(Da.OE))?!1:!0},ab=Da=>{let jb="";if("number"!==typeof Da.I)return{returnValue:!1,Xga:"Invalid PacketId Type"};
if("number"!==typeof Da.O)return{returnValue:!1,Xga:"Invalid Operation Type"};if("string"!==typeof Da.A)return{returnValue:!1,Xga:"Invalid ClientId Type"};if("object"!==typeof Da.AN)return{returnValue:!1,Xga:"Invalid Anchor Object Type"};if(!Da.AN)return{returnValue:!1,Xga:"Null AnchorObject"};if(!ob(Da.AN)){let ic;try{ic=V.c(Da.AN)}catch(Lc){ic=String.format("Failed to JSON-serialize payload : {0}",Lc)}8E3<ic.length&&(ic=String.format("Payload exceeds maximum length: {0} > {1}, not logging",ic.length,
8E3));jb="Invalid AnchorObject: "+ic+", Client: "+Da.C;return{returnValue:!1,Xga:jb}}return!Da.O&&Da.AN.RK?(jb="Invalid RangeKind:"+Da.AN.RK+" for Caret",{returnValue:!1,Xga:jb}):2===Da.O&&("number"!==typeof Da.TF||"undefined"!==typeof Da.TX&&"string"!==typeof Da.TX||1!==Da.AN.RK&&Da.AN.RK)?{returnValue:!1,Xga:"Invalid TypingData"}:3!==Da.O||"object"===typeof Da.AP&&Da.AP&&"number"===typeof Da.AP.TFA&&"number"===typeof Da.AP.PN&&"number"===typeof Da.AP.TN&&2===Da.AN.RK?6!==Da.O||"object"===typeof Da.MP&&
Da.MP&&"number"===typeof Da.MP.PM&&"number"===typeof Da.MP.TM&&5===Da.AN.RK?4!==Da.O||"object"===typeof Da.SP&&Da.SP&&"number"===typeof Da.SP.PA&&"number"===typeof Da.SP.TA&&"number"===typeof Da.SP.PB&&"number"===typeof Da.SP.TBS&&3===Da.AN.RK&&(Da.AN.PS===Da.SP.PA||Da.AN.PS===Da.SP.PB)?7!==Da.O||"object"===typeof Da.SPS&&Da.SPS&&"string"===typeof Da.SPS.SF&&"boolean"===typeof Da.SPS.SL?null!=Da.ISS&&"number"!==typeof Da.ISS?{returnValue:!1,Xga:"invalid StrictlySequentialId"}:{returnValue:!0,Xga:jb}:
{returnValue:!1,Xga:"Invalid SymbolData"}:{returnValue:!1,Xga:"Invalid SplitParaData"}:{returnValue:!1,Xga:"Invalid RemoveParaData"}:{returnValue:!1,Xga:"Invalid AddParaData"}};var Ib=c(1581);class Yb{constructor(Da,jb=null,ic=null){this.d1=this.FXf=this.Kig=null;null!=Da&&(this.Kig=Da);null!=jb&&(this.FXf=jb);null!=ic&&(this.d1=ic)}}Object(m.a)(Yb,"AddParaData",null,[]);class ub{constructor(Da=null,jb=null){this.Zkc=this.EXf=null;null!=Da&&(this.EXf=Da);null!=jb&&(this.Zkc=jb)}}Object(m.a)(ub,"MergeRemoveParaData",
null,[]);class Ac{constructor(Da,jb,ic,Lc,ad,ce,fc=null,kf=null,Tc=null,Mg=null,yf=null,ng=null,ji=0,kj=null){this.y9c=this.text=this.IPb=this.aPb=this.MYc=this.$_b=this.Bja=null;this.packetId=Da;this.client=ic;this.zt=Lc;this.clientId=jb.toLowerCase();this.fT=ad;this.version=ji;ce&&(this.Bja=ce);null!=fc&&(this.IPb=fc);void 0!==kf&&null!==kf&&(this.text=kf);Tc&&(this.$_b=Tc);Mg&&(this.MYc=Mg);yf&&(this.aPb=yf);ng&&(this.y9c=ng);this.strictlySequentialId=kj}}Object(m.a)(Ac,"RTTData",null,[]);class Pc{constructor(Da=
null,jb=null,ic=null,Lc=null){this.Jig=this.DXf=this.Gig=this.CXf=null;null!=Da&&(this.CXf=Da);null!=jb&&(this.Gig=jb);null!=ic&&(this.DXf=ic);null!=Lc&&(this.Jig=Lc)}}Object(m.a)(Pc,"SplitParaData",null,[]);class Mc{constructor(Da=null,jb=null){this.khg=this.jhg=null;Da&&(this.jhg=Da);null!=jb&&(this.khg=jb)}}Object(m.a)(Mc,"SymbolData",null,[]);class Ed{constructor(Da,jb=null,ic=null){null!=Da&&(this.TFA=Da);null!=jb&&(this.PN=jb);null!=ic&&(this.TN=ic)}}Object(m.a)(Ed,"SerializableAddParaDataV1",
null,[]);class ne{constructor(Da=null,jb=null){null!=Da&&(this.PM=Da);null!=jb&&(this.TM=jb)}}Object(m.a)(ne,"SerializableMergeRemoveParaDataV1",null,[]);class Ie{}Object(m.a)(Ie,"SerializableRTTDataV1",null,[]);class cd{constructor(Da=null,jb=null,ic=null,Lc=null){null!=Da&&(this.PA=Da);null!=jb&&(this.TA=jb);null!=ic&&(this.PB=ic);null!=Lc&&(this.TBS=Lc)}}Object(m.a)(cd,"SerializableSplitParaDataV1",null,[]);class Ic{constructor(Da=null,jb=null){Da&&(this.SF=Da);null!=jb&&(this.SL=jb)}}Object(m.a)(Ic,
"SerializableSymbolDataV1",null,[]);const Rc=Da=>{var jb;if(!({Xga:jb}=ab(Da)).returnValue)return l.ULS.sendTraceTag(9188759,302,15,"Failed to parse RTT packet, InvalidFieldInfo {0}",jb),null;let ic=jb=null,Lc=null,ad=null,ce=null,fc=null,kf=null,Tc=null;Da.WD&&(jb=Da.WD);null!=Da.TF&&(ic=Da.TF);void 0!==Da.TX&&null!==Da.TX&&(Lc=Da.TX);Da.AP&&(ad=new Yb(Da.AP.TFA,Da.AP.PN,Da.AP.TN));Da.MP&&(ce=new ub(Da.MP.PM,Da.MP.TM));Da.SP&&(fc=new Pc(Da.SP.PA,Da.SP.TA,Da.SP.PB,Da.SP.TBS));Da.SPS&&(kf=new Mc(Da.SPS.SF,
Da.SPS.SL));null!=Da.ISS&&(Tc=Da.ISS);return new Ac(Da.I,Da.A,Da.C,Da.O,Ib.a(Da.AN),jb,ic,Lc,ad,ce,fc,kf,1,Tc)},xc=Da=>{let jb=Da;if("number"===typeof jb.V){if(1===jb.V)return Rc(Da);l.ULS.sendTraceTag(9188758,302,15,"Unsupported Version");return null}let ic=0,Lc=null;for(let ad=0;ad<Da.length;ad++)jb=Da[ad],hb.isSupported(jb.V)&&jb.V>ic&&(ic=jb.V,Lc=Da[ad]);return 1===ic?Rc(Lc):null},Ae=Da=>{if(Da){const jb=new Ie;jb.I=Da.packetId;jb.V=1;jb.A=Da.clientId;jb.C=Da.client;jb.O=Da.zt;jb.AN=Ib.c(Da.fT);
Da.Bja&&(jb.WD=Da.Bja);null!=Da.IPb&&(jb.TF=Da.IPb);void 0!==Da.text&&null!==Da.text&&0<Da.text.length&&(jb.TX=Da.text);Da.$_b&&(jb.AP=new Ed(Da.$_b.Kig,Da.$_b.FXf,Da.$_b.d1));Da.MYc&&(jb.MP=new ne(Da.MYc.EXf,Da.MYc.Zkc));Da.aPb&&(jb.SP=new cd(Da.aPb.CXf,Da.aPb.Gig,Da.aPb.DXf,Da.aPb.Jig));Da.y9c&&(jb.SPS=new Ic(Da.y9c.jhg,Da.y9c.khg));jb.ISS=Da.strictlySequentialId;Da=jb}else Da=null;return Da};var Ue=c(58);class Xe{constructor(Da,jb,ic,Lc,ad,ce,fc,kf,Tc){this.LocalCobaltSessionId=Da;this.SkypeChatThreadId=
jb;this.ChatThreadDiscoveryUri=ic;this.InChat=Lc;this.Capabilities=ad;this.Email=ce;this.UserName=fc;this.IsAnonymous=kf;this.PresenceStatus=Tc}}Object(m.a)(Xe,"SerializableWacData",null,[]);class ef{constructor(){this.Pud=this.Oud=0}Z2l(){this.Pud===Number.MAX_VALUE&&(this.Pud=0);this.Pud++;return this.Pud}Y2l(){this.Oud===Number.MAX_VALUE&&(this.Oud=0);this.Oud++;return this.Oud}static get instance(){return ef.Ajk}}ef.Ajk=new ef;Object(m.a)(ef,"StrictlySequentialIdGenerator",null,[747]);var Se=
c(1510);class pc{constructor(Da,jb,ic,Lc,ad,ce,fc,kf=0){this.Gsa=null;this.dryDeletion=0;this.zI=Da;this.xLa=ce;this.ud=ad;this.Eyb=fc;this.Lc=jb;this.shapeId=kf;this.EGa=ic;this.o9=fc.create(this,Lc,ad,ce)}clone(){return new pc(this.zI,this.Lc,this.EGa,this.o9.Aqb,this.ud,this.xLa,this.Eyb,this.shapeId)}get paragraphId(){return this.Gsa?this.Gsa:this.zI.Ihb(this.Lc)}jVf(){this.Gsa||(this.Gsa=this.paragraphId,this.o9.jVf())}isValid(){return 0<=this.o9.cp}getData(){const Da=this.o9.Aqb;return Da?new Se.a(0,
this.Lc,this.EGa,Da,null,null,null,0,this.shapeId):null}static aBb(Da,jb,ic,Lc,ad){return jb?new pc(jb,parseInt(Da.JRa),Da.j7a,Da.sR,ic,Lc,ad,Da.shapeId):null}}Object(m.a)(pc,"WordPresenceIp",null,[718,98,719]);class id{constructor(Da,jb,ic){this.kTa=this.Vba=this.Jwc=!1;this.wbb=Da;this.lWa=ic;this.user=jb}get ip(){return this.lWa}get kdc(){return this.Jwc}set kdc(Da){(this.Jwc=Da)&&this.ip.jVf()}Htf(){const Da=ef.instance.Y2l();return new Ac(this.wbb,this.user.clientId,1,0,this.ip?this.ip.getData():
null,new Xe(this.user.bP,this.user.LFc,this.user.chatThreadDiscoveryUri,this.user.inChat,this.user.capabilities.capabilities,this.user.email,this.user.userName,this.user.isAnonymous,this.user.presenceStatus),void 0,void 0,void 0,void 0,void 0,void 0,void 0,Da)}m9h(){return this.user.clientId+(this.ip?this.ip.paragraphId.toString():Ue.a.nil.toString())}isValid(){const Da=!!this.user&&this.user.isValid(),jb=!this.ip||this.ip.isValid();return Da&&jb}clone(){const Da=new id;Da.wbb=this.wbb;Da.Jwc=this.Jwc;
Da.user=this.user?this.user.clone():null;Da.lWa=this.ip?this.ip.clone():null;Da.Vba=this.Vba;Da.kTa=this.kTa;return Da}static faf(Da,jb,ic,Lc,ad){if(!Da||!jb)return null;if(Da.zt)return l.ULS.sendTraceTag(7685324,302,15,"Presence packet is of unexpected operationType {0}",Da.zt),null;let ce;ce=void 0!==Da.Bja&&null!==Da.Bja?eb.TKh(Da.clientId,Da.Bja.UserName,Da.Bja.Capabilities,Da.Bja.LocalCobaltSessionId,Da.Bja.SkypeChatThreadId,Da.Bja.Email,Da.client,Da.Bja.ChatThreadDiscoveryUri,Da.Bja.InChat,
!1,Da.Bja.IsAnonymous,Da.Bja.PresenceStatus):eb.TKh(Da.clientId,null,0,void 0,void 0,void 0,Da.client);return new id(Da.packetId,ce,pc.aBb(Da.fT,jb,ic,Lc,ad))}}Object(m.a)(id,"WordPresenceInfo",null,[732,98]);class Xc extends qc{constructor(Da,jb,ic,Lc,ad,ce,fc,kf,Tc,Mg,yf,ng,ji,kj){super(Da,ce,kj,jb);this.CXj=ic;this.dhk=Lc;this.Bfk=ad;this.ib=fc;Xc.Mt=kf;this.zI=Tc;this.ud=Mg;this.xLa=yf;this.oXe=ng;this.zJa=ji}Dng(Da){this.zJa.nDi(Da.CommandValueId);return super.Dng(Da)}zUm(Da){let jb;({o_f:jb}=
this.gFf(Da)).returnValue&&(this.dhk(jb.ip.paragraphId,jb.ip.o9.cp),n.AFrameworkApplication.K.$("WordEditorMoveIpToUserLocationIsEnabled")&&(Da=Xc.uam(jb),void 0!==Da&&null!==Da?(l.ULS.sendTraceTag(20764574,325,50,"Attempting to move IP to the editing location of the selected user"),this.ib.setSelection(Da),$a.FocusManager.SJ()&&$a.FocusManager.instance().mg(Db.AFrame.Pn)):l.ULS.sendTraceTag(20764575,325,50,"IP will not be moved since the selection is either null or undefined")),Da=new ha.a(2,1,0,
()=>{this.ga.Qb(Ra.a.wie,2,jb)}),gc.a.instance.Vb(Da))}Ddi(Da){return Da?(Da=id.faf(xc(Da),this.zI,this.ud,this.xLa,this.oXe.instance))&&Da.isValid()&&Da.ip?Da:null:null}wRk(Da){return this.rOm(Da)?this.PRk(Da)?!0:(l.ULS.sendTraceTag(41236613,325,50,"Cannot jump to user location because paragraph has not been loaded yet"),!1):(l.ULS.sendTraceTag(41236612,325,50,"Cannot jump to user location because presence is not valid"),!1)}rOm(Da){return!!this.Ddi(Da)}gFf(Da){Da=this.Ddi(Da);return{returnValue:!!Da,
o_f:Da}}PRk(Da){let jb;return({o_f:jb}=this.gFf(Da)).returnValue?this.CXj(jb.ip.paragraphId,jb.ip.o9.cp):!1}LKl(){if(!this.uD)return[];const Da=[];for(const jb of this.uD.D0a())jb.userName?Da.push(jb):l.ULS.sendTraceTag(592229832,304,15,"The looked up RTC User has no name");return Da}W5k(Da){let jb;return({o_f:jb}=this.gFf(Da)).returnValue&&jb.user&&jb.user.presenceStatus&&"0"!==jb.user.presenceStatus?String.format(WordEditorIntl.WordEditorStrings.l_PresenceStatusOnPage,jb.user.presenceStatus):CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}KRn(){this.Bfk(this.settings.id)}static createInstance(Da,
jb,ic,Lc,ad,ce,fc){const kf=Fa.App.ya.gb,Tc=n.AFrameworkApplication.va,Mg=yb.a.instance,yf=Ka.a.instance.resolve("Box4.ICoauthCashTelemetry");return new Xc(Da,jb,ng=>kf.wc.Vi?kf.wc.w5e(ng,!0):!1,(ng,ji)=>{kf.wc.Vi&&kf.wc.mHa(ng,ji,!0,!0,!1)},()=>{Fa.App.Zv.KI.Jad()},Tc,Mg,kf,ic,Lc,ad,ce,yf,fc)}static uam(Da){const jb=Xc.Mt.Uc.od.Db(Da.ip.paragraphId);if(void 0===jb||null===jb)return l.ULS.sendTraceTag(20764576,325,15,"The node could not be obtained"),null;if(!Bb.ParagraphReader.Wb(jb))return l.ULS.sendTraceTag(20764577,
325,15,"The obtained node is not a paragraph node"),null;Da=cb.a.Rc(jb,Da.ip.o9.cp);return new Xa.Selection([Da],!0)}}Xc.Mt=null;Object(m.a)(Xc,"WordEditorPeoplesWell",qc,[]);class he{constructor(){this.Lx=()=>{n.AFrameworkApplication.R_i?he.Wpa.OD().continueWith(this.N_c):l.ULS.sendTraceTag(23196872,325,50,"PeoplesWell control is explicitly disabled. Skipping initialization attempt")};this.N_c=()=>{he.fj=he.Wpa.OD().result;if(he.fj){var Da=()=>{const jb=Fa.App.ya.gb;return jb?jb.Uc?jb.Uc.od:(l.ULS.sendTraceTag(23196876,
325,15,"ActivePage is null"),null):(l.ULS.sendTraceTag(23196875,325,15,"Workspace is null"),null)};Fa.App.Gna().continueWith(()=>{const jb=Fa.App.Gna().result.kj,ic=lb.CuiHelper.z6l(n.AFrameworkApplication.Rs,n.AFrameworkApplication.Rs,n.AFrameworkApplication.Rs,n.AFrameworkApplication.Rs),Lc=Ya.createInstance(ic,jb,Object(e.a)(he.fj.wee,he.fj.wee.HPc,"getUserPresence"),Object(e.a)(he.fj.wee,he.fj.wee.Uhb,"getUserStatusInfo"),n.AFrameworkApplication.K.$("WordEditorPresenceDedupeMultipleCoauthorInstances"));
Ka.a.instance.ha("RealtimePresenceUI.WordEditorPeoplesWell",()=>Xc.createInstance(Lc,Ma.a.Ap(he.W.Sa("Common.IPeopleInfoProvider")),he.W.Na("WordEditor.ParagraphWordIdMapping"),he.W.Na("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Da,he.W.Sa("WordEditor.Presence.IWordPresenceCpFactory"),he.W.resolve("Common.App.People.IPeopleManager"))).as("Common.IPeoplesWell").singleInstance();he._instance=Ka.a.instance.resolve("Common.IPeoplesWell");he._instance.cVn();l.ULS.sendTraceTag(23196877,
325,50,"PeoplesWellControl is fully initialized")})}else l.ULS.sendTraceTag(23196873,325,15,"Can't initialize the PeoplesWell control because can't get a handle to RtcProxy")}}get name(){return"WordEditor.PeoplesWellControl"}xc(Da){he.W=Da}init(){n.AFrameworkApplication.K.No(this.Lx)}dispose(){he._instance&&(he._instance.dispose(),he._instance=null)}static get Wpa(){return null!=he.KFg?he.KFg:he.KFg=Ka.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}}he._instance=null;he.W=null;he.fj=null;Object(m.a)(he,
"WordEditorPeoplesWellControlPackage",null,[1,2]);var $d=c(98),Ud=c(161);class Jf{constructor(Da,jb,ic,Lc,ad,ce,fc,kf,Tc=!1){this.L8a=null;this.xAe=!0;this.LNe=this.Fl=this.jte=null;this.ra=new ya.a;this.qLa=Da;this.GZ=jb;this.Eah=ic;this.Vyc=Lc;this.$Lg=ce;Jf.Hb=ad;this.Eek=fc;this.I6=kf;this.Jfk=Tc;G.Task.WAA(jb,ic).continueWith(Object(e.a)(this,this.Rvm,"initOnTaskReady"))}lyk(Da){this.ra.addHandler("u",Da)}C5i(){this.ra.raiseEvent("u",null,this)}Rvm(){this.GZ.result&&this.Eah.result&&(this.Fl=
this.GZ.result,this.LNe=this.Eah.result,this.Fl.XYa(Object(e.a)(this,this.E4,"onPresenceUpdated")),this.jte=new ha.a(2,2,this.$Lg,Object(e.a)(this,this.XQo,"updateAwayClientsTask"),88),Jf.Hb.Vb(this.jte))}E4(Da,jb){(this.xAe||this.kOn(jb.Sqa))&&Jf.Hb.K0(this.jte,0)}kOn(Da){for(let ic in Da){var jb=this.Vyc.pRd({key:ic,value:Da[ic]});if(jb&&jb.clientId&&(jb=jb.clientId.toLowerCase(),(jb=this.L8a[jb]||this.L8a[jb.toUpperCase()])&&2===jb.status))return!0}return!1}XQo(Da){var jb=this.Fl.UMc();if(jb){var ic=
new Date,Lc=!1;if(this.xAe){this.L8a=jb;this.xAe=!1;var ad=this.L8a;for(var ce in ad){jb=ce;var fc=ad[ce];fc.qcc<ic&&(ic=fc.qcc);2===fc.status&&(Lc=!0,this.LNe.b4c(jb))}Lc&&this.C5i();Jf.Hb.K0(Da,this.obi(ic))}else{fc=new R.a;ce=!1;var kf=this.L8a;for(ad in kf){kf=ad;if(!(kf in this.L8a)||this.qLa.clientId===kf)continue;var Tc=this.L8a[kf];const Mg=jb[kf];if(Tc&&Mg){Tc=Tc.status;const yf=Mg.status;2===Tc&&1===yf?(fc.add(kf),l.ULS.sendTraceTag(38052609,392,50,kf+" returned from away")):1===Tc&&2===
yf&&(ce=Lc=!0,this.LNe.b4c(kf),l.ULS.sendTraceTag(38052610,392,50,kf+" went away"));1===yf&&Mg.qcc<ic&&(ic=Mg.qcc)}}this.L8a=jb;Jf.Hb.K0(Da,this.obi(ic));(0<fc.count||Lc)&&this.C5i();0<fc.count&&!this.Jfk?(Da=this.JOl(fc),this.hIo(Da)):Da=new R.a;(ce||0<Da.count)&&this.Eek(pb.a.cEd,2)}}}hIo(Da){if(Da.count)for(let jb of Da)Da=this.I6.rma(String.format(CommonUIStrings.l_EditorsToastArriving,jb),!1),Da.image=5,Da.Sna="CoAuth_AuthorStatus_16x16x32",this.I6.aA(Da)}JOl(Da){const jb=this.Fl.qDb(),ic=new R.a;
for(let Lc in jb){const ad={key:Lc,value:jb[Lc]};if(Da.contains(ad.key)){const ce=this.Vyc.pRd(ad);ce&&(ic.add(ce.userName),Da.remove(ad.key))}}ic.count||l.ULS.sendTraceTag(38052611,392,10,"There were no coauthor names found");return ic}obi(Da){const jb=new Date;return Math.max(Da.getTime()+this.$Lg-jb.getTime(),0)}}Jf.Hb=null;Object(m.a)(Jf,"AwayManager",null,[]);var hh=c(762);class Qi{constructor(Da=0){this.updates=Da}get qxf(){return 0!==this.updates}DEa(Da){return!!(this.updates&Da)}l6a(Da){this.updates|=
Da}toString(){if(this.DEa(0))return"none";const Da=new R.a;this.DEa(1)&&Da.add("user(s) joined");this.DEa(2)&&Da.add("user(s) disconnected");this.DEa(4)&&Da.add("user(s) updated");return Da.toArray().join(", ")}}Object(m.a)(Qi,"UserUpdateEvent",null,[]);var Lg=c(34);class bc{constructor(Da,jb,ic,Lc,ad=null){this.ra=new ya.a;this.cK=this.fj=null;this.b7g=this.x7g=this.$l=!1;this.rq=new Rb.a;Da.continueWith(()=>{this.fj=Da.result;this.fj.XYa(Object(e.a)(this,this.mWi,"onRtcPresenceUpdate"));this.fj.Ata(Object(e.a)(this,
this.lWi,"onRtcConnectionChange"));this.cng(null,null)});jb.continueWith(()=>{this.cK=jb.result;this.cK.qdb(Object(e.a)(this,this.r_c,"onEditorsTableUpdated"))});ad&&ad.continueWith(()=>{ad.result.lyk(Object(e.a)(this,this.cng,"updateUserStatus"));this.cng(null,null)});this.KLa=ic;this.Vyc=Lc}get users(){return this.rq}r0b(Da){this.ra.addHandler("UU",Da)}U5f(Da){this.ra.removeHandler("UU",Da)}cng(){if(this.fj){var Da=!1,jb=this.fj.UMc();for(let Lc in jb){var ic=jb[Lc];const ad=Lc;this.users.nb(ad)&&
(ic=this.Zzj(ic),Da=this.users.J(ad).wAb!==ic||Da,this.users.J(ad).wAb=ic)}Da&&(Da=new Qi(4),this.yfe(Da))}}Zzj(Da){return 1===Da.status?0:1}D0a(){this.users.count||(this.x7g||(Lg.b(42316242,302,50,"No users available at PeopleInfoProvider.GetAllUsers call"),this.x7g=!0),this.ECn());const Da=[];for(let jb of this.users)Array.add(Da,jb.value);return Da}ECn(){if(this.fj){var Da=this.fj.qDb();this.QMf(Da)}if(this.cK){Da=this.cK.OMc();for(const jb of Da)jb.Id&&(Da=this.ZMh(jb.Id),this.bng(new Qi,Da))}}eLf(Da){({value:Da}=
this.users.Dc(Da));return Da}dispose(){this.$l||(this.fj&&(this.fj.LMb(Object(e.a)(this,this.mWi,"onRtcPresenceUpdate")),this.fj.Ygc(Object(e.a)(this,this.lWi,"onRtcConnectionChange"))),this.cK&&this.cK.Q$i(Object(e.a)(this,this.r_c,"onEditorsTableUpdated")),this.$l=!0)}lWi(Da,jb){2===jb.newState&&(Da=this.QMf(this.fj.qDb()),Da.qxf&&this.yfe(Da))}r_c(Da,jb){Da=new Qi;var ic=this.cK.OMc();l.ULS.sendTraceTag(561894485,302,50,"editorstablemanager coauthors count is {0}, editorstableupdate old count of coauthors is {1}, editorstableupdate new count of coauthors is {2}",
ic.length,jb.Thn,jb.wPi);const Lc=new Rb.a;for(var ad of ic){ic=ad.Id;const ce=this.ZMh(ic);this.bng(Da,ce);Lc.Z(ic,ce)}if((jb=jb.leaving)&&0<jb.length)for(ad=0;ad<jb.length;ad++)l.ULS.sendTraceTag(562415168,302,50,"{0} users in coauth gallery. User leaving the editor table: {1}",this.users.count,jb.J(ad).Id),({value:ic}=this.users.Dc(jb.J(ad).Id)).returnValue?ic?(this.users.remove(jb.J(ad).Id),Da.l6a(2),Lc.Z(jb.J(ad).Id,ic)):l.ULS.sendTraceTag(561287839,302,50,"Empty entry in PIP users: {0}",jb.J(ad).Id):
l.ULS.sendTraceTag(570426140,302,15,"Disconnected user not found: {0}",jb.J(ad).Id);jb=this.fj.qDb();for(let ce in jb)ad=this.Vyc.pRd({key:ce,value:jb[ce]}),Lc.Z(ad.clientId,ad);for(let ce of this.users)Lc.nb(ce.value.clientId)||(l.ULS.sendTraceTag(561287840,302,15,"Coauth Gallery contains user not in Editors Table or RTC presence: {0}",ce.key),this.users.remove(ce.key),Da.l6a(2));Da.qxf&&this.yfe(Da)}mWi(Da,jb){Da=this.QMf(jb.Sqa);for(const ic of jb.HId)this.users.nb(ic)&&(Da.l6a(2),this.users.J(ic).wAb=
2);Da.qxf&&this.yfe(Da)}QMf(Da){const jb=new Qi;if(!Da)return jb;for(let Lc in Da){var ic=this.Vyc.pRd({key:Lc,value:Da[Lc]});ic&&(ic=ic.clone(),this.bng(jb,ic))}return jb}bng(Da,jb){if(jb){var ic=jb.clientId;var Lc=this.T4n(jb);({value:jb}=this.users.Dc(ic)).returnValue?jb.equals(Lc)||(Da.l6a(4),this.users.Z(ic,Lc)):(l.ULS.sendTraceTag(562415169,302,50,"{0} users in coauth gallery. User joining: {1}",this.users.count,ic),Da.l6a(1),this.users.Z(ic,Lc))}}ZMh(Da){return this.users.nb(Da)?this.users.J(Da):
Ca.a.B9k(Da)}T4n(Da){if(!Da||!Da.clientId||!this.cK)return Da;const jb=Da.clone();jb.wAb=this.IOl(Da);if(Da=this.cK.b7b(jb.clientId))jb.isReadOnly=jb.isReadOnly||Da.IsReadOnly?!0:!1,jb.userName=this.S4n(jb,Da),jb.capabilities=this.bbn(jb.capabilities,Da.Capabilities),jb.email=jb.email||Da.SIPAddress||Da.EmailAddress,Da.JoinCoauthTime&&(jb.AQa=Da.JoinCoauthTime);jb.color=this.KLa.M8b(new hh.a(jb.email,void 0,jb.userName,void 0,jb.isAnonymous,jb.clientId),3);return jb}IOl(Da){if(!this.fj)return 2;if(Da&&
Da.clientId){const jb=this.fj.UMc();if(Da.clientId in jb)return this.Zzj(jb[Da.clientId])}return 2}j1k(Da,jb){jb.Name&&Da.userName&&jb.Name!==Da.userName&&!this.b7g&&(this.b7g=!0,Lg.b(42316243,302,15,"User names in EditorsTable and RTC don't match"))}bbn(Da,jb){Da=Da||new Aa.a;jb&&(jb.SupportsRealtimeChannel&&Da.l6a(1),jb.SupportsRename&&Da.l6a(2),jb.SupportsChat&&Da.l6a(4));return Da}S4n(Da,jb){this.j1k(Da,jb);return jb.Name||Da.userName||(Da.isAnonymous||jb.IsAnonymous?CommonUIStrings.l_GuestUserName:
null)}yfe(Da){l.ULS.sendTraceTag(42316245,302,100,"PeopleInfoProvider update detected: {0}",Da.toString());this.ra.raiseEvent("UU")}}Object(m.a)(bc,"PeopleInfoProvider",null,[959,9]);var vc;(function(Da){Da[Da.multipleBrowsersImageClassName=0]="multipleBrowsersImageClassName";Da[Da.peopleImageClassName=1]="peopleImageClassName";Da[Da.peopleImageClusterPath=4]="peopleImageClusterPath";Da[Da.multipleBrowserImageClusterPath=5]="multipleBrowserImageClusterPath";Da[Da.imageDimension=6]="imageDimension";
Da[Da.rtl=8]="rtl";Da[Da.pointerInputManager=9]="pointerInputManager";Da[Da.clickInputManager=10]="clickInputManager";Da[Da.vertical=11]="vertical";Da[Da.zIndex=12]="zIndex";Da[Da.contextMenuInputManager=13]="contextMenuInputManager";Da[Da.imageDomElement=14]="imageDomElement";Da[Da.useIdleTooltip=15]="useIdleTooltip";Da[Da.viewportBoundsCallback=16]="viewportBoundsCallback";Da[Da.flipHorizontalDirection=17]="flipHorizontalDirection";Da[Da.fixRemoveFadeOutElementCrash=18]="fixRemoveFadeOutElementCrash";
Da[Da.ignoreEventOnExpandedTooltip=19]="ignoreEventOnExpandedTooltip";Da[Da.ipWidthAdjustForFlyout=20]="ipWidthAdjustForFlyout"})(vc||(vc={}));Object(m.b)("PresenceTooltipSettingKeys",vc);class Vc{constructor(){this.mu={}}get(Da,jb=null){Da=vc[Da];return"number"===typeof jb?(jb=this.mu[Da])?Number.parseInvariant(jb.toString()):0:this.mu[Da]}add(Da,jb){this.mu[vc[Da]]=jb}NMa(Da,jb){vc[Da]in this.mu||(this.mu[vc[Da]]=jb)}remove(Da){delete this.mu[vc[Da]]}}Object(m.a)(Vc,"PresenceTooltipSettings",null,
[]);class yd extends ya.a{constructor(Da){super();this._element=null;this.element=Da}get element(){return this._element}set element(Da){this._element=Da}get visible(){return"visible"===this.element.style.visibility}set visible(Da){this.element.style.visibility=Da?"visible":"hidden"}get rtl(){return"rtl"===this.element.dir.toLowerCase()}set rtl(Da){this.element.dir=Da?"rtl":"ltr"}get zIndex(){return this.element.style.zIndex}set zIndex(Da){this.element.style.zIndex=String(Da)}dispose(){this.element&&
this.element.parentNode&&this.element.parentNode.removeChild(this.element);this.element=null;super.dispose()}createElement(Da){return this.element.ownerDocument.createElement(Da)}cja(){return!0}static mMh(Da){return"prControl"+(Da?"Rtl":"")}}Object(m.a)(yd,"BasePresenceControl",ya.a,[9,964]);class ee extends Sys.EventArgs{constructor(Da,jb){super();this.type=Da;this.Jo=jb}}ee.lU="InteractivityChanged";Object(m.a)(ee,"InteractivityChangedEventArgs",Sys.EventArgs,[]);class Qe{static SRl(Da){return Qe.TRl(Da)}static TRl(Da){const jb=
document.createElementNS(Qe.Hpg,"svg");jb.setAttribute("viewBox",String.format(Qe.Bfl,Qe.RIj,Qe.QIj));jb.appendChild(Qe.Ccm(Da));return jb}static Ccm(Da){const jb=Qe.RIj/Da,ic=2*jb,Lc=Qe.QIj/2;Da=(Da-12-8)*jb/2;const ad=document.createElementNS(Qe.Hpg,"g");Sys.UI.DomElement.addCssClass(ad,Qe.Afl);for(let ce=1;3>=ce;ce++)ad.appendChild(Qe.uOl(ce,ic,Da+(6*ce-2)*jb,Lc));return ad}static uOl(Da,jb,ic,Lc){const ad=document.createElementNS(Qe.Hpg,"circle");Sys.UI.DomElement.addCssClass(ad,String.format("{0}-{1}",
Qe.UVk,Da));ad.setAttribute("cx",String.format("{0}",ic));ad.setAttribute("cy",String.format("{0}",Lc));ad.setAttribute("r",String.format("{0}",jb));return ad}}Qe.Hpg="http://www.w3.org/2000/svg";Qe.Afl="prDancingDots";Qe.UVk="prAnimateCircle";Qe.Bfl="0 0 {0} {1}";Qe.QIj=40;Qe.RIj=120;Object(m.a)(Qe,"ModernPresenceTooltipDancingDots",null,[]);var ue=c(96),ve=c(89),xf=c(11),bf=c(26),Df=c(141),nf=c(54);class Yf extends yd{constructor(Da,jb){super(Da);this.ikh=this.z$a=this.Xue=this._img=this.pE=this.Yr=
this.hg=null;this.cMa=jb.get(8,!1);this.f$a=jb.get(6,0);this.Pmk=jb.get(15,!1);this.Sd=jb;this.eUg=0;this.element=Da;this.element.className=Yf.Nkf;this._span=document.createElement("span");this.element.appendChild(this._span);this.F0j=Qe.SRl(jb.get(6,0));this.wF(jb);this._state=5}Zyb(Da){this.addHandler(ee.lU,Da)}GMb(Da){this.removeHandler(ee.lU,Da)}get user(){return this.ikh}get state(){return this._state}dispose(){this.element&&(this.hg.rc(xf.a.click,this.element,Object(e.a)(this,this.onClick,"onClick")),
this.hg.rc(xf.a.mB,this.element,Object(e.a)(this,this.cja,"stopPropagationAndPreventDefaultBehavior")),this.Yr.rc(xf.a.pointerDown,this.element,Object(e.a)(this,this.ZC,"onPointerDown")),this.Yr.rc(xf.a.pointerOut,this.element,Object(e.a)(this,this.yJ,"onPointerOut")),this.Yr.rc(xf.a.pointerOver,this.element,Object(e.a)(this,this.fP,"onPointerOver")),this.pE.rc(this.element,Object(e.a)(this,this.cja,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}wF(Da){this.hg=Da.get(10);this.hg.lb(xf.a.click,
this.element,Object(e.a)(this,this.onClick,"onClick"));this.hg.lb(xf.a.mB,this.element,Object(e.a)(this,this.cja,"stopPropagationAndPreventDefaultBehavior"));this.Yr=Da.get(9);this.Yr.lb(xf.a.pointerOver,this.element,Object(e.a)(this,this.fP,"onPointerOver"));this.Yr.lb(xf.a.pointerOut,this.element,Object(e.a)(this,this.yJ,"onPointerOut"));this.Yr.lb(xf.a.pointerDown,this.element,Object(e.a)(this,this.ZC,"onPointerDown"));this.pE=Da.get(13);this.pE.lb(this.element,Object(e.a)(this,this.cja,"stopPropagationAndPreventDefaultBehavior"))}hide(Da=
null,jb=0,ic=0){this.Pmk&&Da?this.quo(Da,jb,ic):(3===this.state&&this.z9i(),this.visible=!1,this._state=5)}quo(Da,jb,ic=0){this.show(Da,jb,15,4,void 0,ic)}vqj(Da,jb,ic=!1,Lc=!1,ad=!1,ce=0){this.show(Da,jb,20,ic?2:Lc?1:0,ad,ce)}Oto(Da,jb,ic,Lc=!1,ad=0){this.show(Da,jb,ic+20,3,Lc,ad)}show(Da,jb,ic,Lc=3,ad=!1,ce=0){!Da||Lc===this.state&&this.spm(jb,ic)||(this.fqk(Lc,ad,ce),this.Wea(Da,Lc,ce),this._state=Lc,4===ce||0===ce&&!this.cMa?this.element.style.left=jb+"px":this.element.style.right=jb+"px",this.element.style.top=
ic+"px",this.visible=!0)}Wea(Da,jb,ic){this.ikh=Da;nf.a.tC(this._span);Df.a.CXk(this._span);this._span.id="fly_"+Da.clientId;this._span.style.backgroundColor=Da.color;4!==jb?(this._span.style.height=this.f$a+"px",this._span.style.lineHeight=this.f$a+"px",Df.a.Tic(this._span,"border-radius",this.f$a+"px")):4===ic||0===ic&&!this.cMa?this._span.style.left="0px":this._span.style.right="0px";2!==jb&&(4===jb?nf.a.Ey(this._span,""):1===jb?this._span.appendChild(this.F0j):(this._span.setAttribute("dir","auto"),
ic=nb.a.aZl(Da.userName),(!Da.isAnonymous||n.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1))&&ic||0!==jb?(Da=Da.userName,0===jb&&(Da=ic,Df.a.Tic(this._span,"text-align","center")),nf.a.Ey(this._span,Da)):(this._img||(this._img=this.y7k()),this._span.appendChild(this._img),Df.a.Tic(this._span,"text-align","start"))))}onClick(Da){if(0===this.state)return this.raiseEvent(ee.lU,new ee(1,Da)),!0;3===this.state&&l.ULS.sendTraceTag(50436114,
302,50,"User clicked on presence pill.");return!1}yJ(Da){3===this.state&&this.raiseEvent(ee.lU,new ee(3,Da));return!1}fP(Da){3!==Da.jg&&this.raiseEvent(ee.lU,new ee(2,Da));return!1}ZC(Da){if(3!==Da.jg)return!0;this.raiseEvent(ee.lU,new ee(4,Da));return!1}y7k(){const Da=document.createElement("img");Da.src=ue.a.Oaa("doughperson_white_glyph.svg");Da.setAttribute("Unselectable","on");bf.a.gr(Da,bf.a.qh,bf.a.Yy);return ve.createClusteredImageFromClusterWithImageClass(this.f$a,this.f$a,null,null,Yf.zEl,
"",!1,"",this.element.ownerDocument,Da)}fqk(Da,jb=!1,ic=0){if(!this.sTc(this.state)||!this.sTc(Da))switch(Sys.UI.DomElement.removeCssClass(this.element,this.Xue),this.state){case 4:3===Da?this.NYa(Yf.Okf,Yf.e0h):this.sTc(Da)&&this.NYa(Yf.Mkf,Yf.e0h);break;case 3:4===Da?this.NYa(Yf.Rkf,Yf.d0h):this.sTc(Da)&&(jb&&this.z9i(),this.NYa(Yf.Mkf,Yf.d0h,jb?Yf.yEl:""));break;case 0:case 1:case 2:4===Da?this.NYa(Yf.Rkf,Yf.Pkf):3===Da&&(jb&&this.mrk(),this.NYa(Yf.Okf,Yf.Pkf,jb?Yf.f0h:"",3===ic?Yf.CEl:Yf.AEl));
break;default:4===Da?this.NYa(Yf.Rkf):3===Da?this.NYa(Yf.Okf):this.sTc(Da)&&this.NYa(Yf.Mkf)}}NYa(...Da){this.Xue=Da.join(" ");Sys.UI.DomElement.addCssClass(this.element,this.Xue)}mrk(){this.eUg=window.setTimeout(()=>{this.element&&(this.z$a=this.element.cloneNode(!0),this.element.parentNode.appendChild(this.z$a),this.element.style.zIndex="2",this.z$a.style.zIndex="1")},300)}z9i(){window.clearTimeout(this.eUg);this.z$a&&(Sys.UI.DomElement.removeCssClass(this.z$a,Yf.Pkf+" "+Yf.f0h),Sys.UI.DomElement.addCssClass(this.z$a,
Yf.xEl),G.Task.delay(300).continueWith(()=>{this.element&&this.element.parentNode===this.z$a.parentNode&&this.element.parentNode.removeChild(this.z$a)}),Df.a.Wgc(this.element,"z-index"))}sTc(Da){return 0===Da||1===Da||2===Da}spm(Da,jb){const ic=Df.a.xY(this.element.style.top);return Df.a.xY(this.element.style.left)===Da&&ic===jb}d7f(Da){3===Da&&Df.a.Haa(this.element,"left")?(Da=Df.a.xY(this.element.style.left),Df.a.Wgc(this.element,"left"),this.element.style.right=-1*Da+"px"):4===Da&&Df.a.Haa(this.element,
"right")&&(Da=Df.a.xY(this.element.style.right),Df.a.Wgc(this.element,"right"),this.element.style.left=-1*Da+"px")}}Yf.Nkf="prModernFlyout UIFont";Yf.Rkf="flyoutIdle";Yf.Okf="flyoutExpanded";Yf.Mkf="flyoutCollapsed";Yf.e0h="flyoutFromIdle";Yf.d0h="flyoutFromExpanded";Yf.Pkf="flyoutFromCollapsed";Yf.f0h="flyoutStacked";Yf.yEl="flyoutFromStacked";Yf.xEl="flyoutFadeOut";Yf.zEl="cui-img-cont-float cui-img-20by20";Yf.AEl="flyoutLtrDir";Yf.CEl="flyoutRtlDir";Object(m.a)(Yf,"ModernPresenceTooltipFlyoutControl",
yd,[]);class Kf{constructor(Da,jb,ic=2,Lc=4){this.offsetTop=Da;this.offsetLeft=jb;this.OIj=ic;this.xni=Lc}}Object(m.a)(Kf,"FlyoutsPositioningInfo",null,[]);var wb=c(39);class Tb{constructor(Da=!1,jb=!1){this.em=Da;this.CAe=jb}m_l(Da,jb,ic,Lc,ad){const ce=ad.y,fc=ad.height;var kf=this.QMl(Lc);const Tc=kf+jb,Mg=Da*ic+2*(Da-1);ic=null;1===Da||this.mRk(kf,Mg,ce,fc)?Da=new Kf(0,0,2):(Da=this.skf(Tc,Mg,ce,fc),Da.offsetTop-=kf);this.CAe?ic=new Kf(0,0,void 0,this.em?4:3):(Lc=this.PMl(Lc,ad),kf=Math.max(0,
ad.x),ad=ad.width,jb=Lc+jb,this.nRk(Lc,kf,ad)?ic=new Kf(0,0,void 0,this.em?3:4):this.oRk(jb,kf)&&(ic=new Kf(0,0,void 0,this.em?4:3)),ic||(ic=this.gDl(Lc,jb,kf,ad)));return new Kf(Da.offsetTop,ic.offsetLeft,Da.OIj,ic.xni)}QMl(Da){return wb.a.aEa(Da)}PMl(Da,jb){return this.em?jb.width-wb.a.n4h(Da):wb.a.Bnf(Da)}mRk(Da,jb,ic,Lc){return Da+jb<=ic+Lc}skf(Da,jb,ic,Lc){let ad=1,ce=Math.max(ic,Da-jb);jb>Da-ic&&(ad=2,ce=jb<Lc?Lc-jb:ic);return new Kf(ce,0,ad)}nRk(Da,jb,ic){return Da+150<=jb+ic}oRk(Da,jb){return 150<=
Da-jb}gDl(Da,jb,ic,Lc){Lc-jb>=Da-ic?Da=4:(jb=Da,Da=3);return new Kf(0,jb,void 0,Da)}}Object(m.a)(Tb,"ModernPresenceTooltipPositioner",null,[]);class Wc{constructor(Da,jb,ic,Lc,ad,ce,fc){this.x$=Da;this._parent=jb;this.IOg=ic;this.tYj=Lc;this.o5j=ad;this.DZb=ce;this.cMa=fc;this._element=document.createElement("div");this.element.className="prTouchTarget"}get element(){return this._element}update(Da,jb){if(3!==Da)if(5!==Da&&this.x$&&this.x$.length){if(4===Da){var ic=this.o5j;var Lc=(this.DZb-ic)/2;
this.element.style.height=this.DZb+"px";this.element.style.width=this.DZb+"px";Da=Df.a.xY(this.x$[0].element.style.top);jb=Df.a.xY(this.cMa?this.x$[0].element.style.right:this.x$[0].element.style.left)}else ic=this.IOg,Lc=(this.DZb-ic)/2,this.element.style.height=this.DZb+"px",this.element.style.width=this.MOl()+2*Lc+"px",Da=Df.a.xY(this.x$[this.x$.length-1].element.style.top),jb=this.pQk(this.x$[this.x$.length-1].element,ic,jb);Df.a.Tic(this.element,"border-radius",this.DZb+"px");this.element.style.top=
Da-Lc-ic+"px";this.cMa?this.element.style.right=jb-Lc+"px":this.element.style.left=jb-Lc+"px";this.element.parentNode||this._parent.insertBefore(this.element,this._parent.firstChild)}else this.element.parentNode&&this.element.parentNode.removeChild(this.element)}pQk(Da,jb,ic){return this.cMa&&!ic?Df.a.xY(Da.style.right):this.cMa||ic?this.cMa&&ic?-Df.a.xY(Da.style.left)-jb:-Df.a.xY(Da.style.right)-jb:Df.a.xY(Da.style.left)}MOl(){return this.x$&&this.x$.length?this.IOg+Math.min(this.x$.length-1,2)*
this.tYj:0}}Object(m.a)(Wc,"ModernPresenceTooltipTarget",null,[]);var Gd=c(127),Ye=c(189);class od extends yd{constructor(Da,jb,ic){super(Da);this.aYb=this.MKa=this.eZg=this.mtb=!1;this.rq=[];this.ukd={};this.Sd=ic;this.em=ic.get(8,!1);this.VXg=ic.get(15,!1);this.x_j=ic.get(12,0);this.beb=ic.get(6,0);this.fla=jb;this.Dkh=ic.get(16);this.CAe=ic.get(17,!1);this.s5j=ic.get(19,!1);this.uek=ic.get(20,!1);this.tnd=0;this.oek=new Tb(this.em,this.CAe);this.foc=this.U6h();this.gwb=!1;this.PRb=[];this.fuc=
[];this.element.id=od.Sgb();this.element.className=yd.mMh(this.em);this.B_a&&(this.zIndex=this.B_a);this.rtl=this.em;this.$$f(jb);this.m6=this.createElement("div");this.m6.className="prFlyoutContainer";this.element.appendChild(this.m6);this.x$=[];this.$$a=new Wc(this.F3,this.element,this.beb,4,6,32,this.em);this.Yr=ic.get(9);this.Yr.lb(xf.a.pointerDown,this.$$a.element,Object(e.a)(this,this.uec,"onHitTarget"));this.Yr.lb(xf.a.pointerOver,this.$$a.element,Object(e.a)(this,this.uec,"onHitTarget"));
this.Yr.lb(xf.a.pointerOut,this.$$a.element,Object(e.a)(this,this.uec,"onHitTarget"))}get L$d(){return Ye.a.clone(this.rq)}get F3(){return this.x$}get B_a(){return this.x_j}get s0a(){return this.F3?this.F3.length:0}get UPb(){return 0<this.s0a?this.F3[0].state:5}get XCf(){return 3===this.UPb&&!this.mtb}Zyb(Da){this.addHandler(ee.lU,Da)}GMb(Da){this.removeHandler(ee.lU,Da)}dispose(){if(this.XCf)this.gwb=!0;else{if(this.F3)for(const Da of this.F3)Da.GMb(Object(e.a)(this,this.xRa,"onInteractivityChanged")),
$d.a.UB(Da);this.x$=null;this.Yr.rc(xf.a.pointerDown,this.$$a.element,Object(e.a)(this,this.uec,"onHitTarget"));this.Yr.rc(xf.a.pointerOver,this.$$a.element,Object(e.a)(this,this.uec,"onHitTarget"));this.Yr.rc(xf.a.pointerOut,this.$$a.element,Object(e.a)(this,this.uec,"onHitTarget"));super.dispose()}}Ejc(){this.F2b();this.visible=!0}f8c(){this.visible=!0;this.zXh();this.mtb=!0}Ndg(){this.f8c()}hide(){this.g$i();this.R1a();this.$$a.update(this.UPb,this.aYb)}Wea(Da){const jb=this.UPb,ic=this.mtb;Da.clientId||
(Da.clientId=(od.zuc++).toString());if(Da.clientId in this.ukd){var Lc=this.TCb(Da.clientId);if(0<=Lc){Lc=this.rq[Lc];if(Lc.color===Da.color&&Lc.userName===Da.userName)return;this.C5a(Da.clientId)}}this.hide();Lc=new Yf(this.createElement("div"),this.Sd);Lc.Zyb(Object(e.a)(this,this.xRa,"onInteractivityChanged"));this.m6.insertBefore(Lc.element,this.m6.firstChild);this.ukd[Da.clientId]=Lc;Array.add(this.rq,Da);Array.add(this.F3,Lc);this.XGj(jb,ic);this.visible=!0}C5a(Da){if(this.XCf)Array.add(this.fuc,
Da);else{var jb=this.UPb,ic=this.mtb;this.hide();this.a4c(Da);this.XGj(jb,ic)}}GOi(Da){const jb=this.TCb(Da);if(!(0>=jb)){var ic=this.rq[jb];Da=this.ukd[Da];Array.removeAt(this.rq,jb);Array.insert(this.rq,0,ic);Array.removeAt(this.F3,jb);Array.insert(this.F3,0,Da);this.m6.removeChild(Da.element);this.m6.appendChild(Da.element);this.F2b()}}XGj(Da,jb){0>=this.rq.length?this.hide():3===Da&&jb?this.f8c():this.Ejc()}kif(Da){if(this.XCf&&this.s5j)return!1;Da=od.htf(Da);if(this.m6!==Da&&nf.a.VPa(this.m6,
Da))return!0;for(const jb of this.F3)if(nf.a.VPa(jb.element,Da))return!0;return!1}position(Da,jb){this.element.style.top=jb+"px";this.element.style.left=Da+"px"}F2b(Da=!1){if(!Da||this.MKa){this.eZg&&this.cmj(!0);var jb=Math.min(3,this.s0a)-1;Da=0;var ic=1,Lc=0;this.aYb&&(Da=this.foc,ic=-1,Lc=-this.beb);for(let ad=this.s0a-1;ad>jb;ad--)this.F3[ad].vqj(this.rq[ad],-4*jb*ic+Lc,!0,!1,!0,Da);for(;0<=jb;jb--)this.F3[jb].vqj(this.rq[jb],-4*jb*ic+Lc,0<jb,Array.contains(this.PRb,this.rq[jb].clientId),jb!==
this.tnd,Da);this.tnd=0;this.$$a.update(0,this.aYb);this.zIndex=this.B_a;this.mtb=!1;this.g$i(0);this.gwb&&this.dispose()}}zXh(){this.eZg&&this.cmj(!1);this.zIndex=this.B_a+1;let Da,jb,ic;({offsetX:jb,offsetY:Da,wni:ic}=this.Kho());for(let Lc=0;Lc<this.s0a;Lc++)this.F3[Lc].Oto(this.rq[Lc],jb,Da+(this.beb+2)*Lc,Lc!==this.tnd,ic)}R1a(){let Da=0,jb=0;this.aYb&&(Da=this.foc,jb=-6);for(let ic=0;ic<this.s0a;ic++)this.F3[ic].hide(this.rq[ic],jb,Da);this.zIndex=this.B_a;this.visible=this.mtb=!1;this.gwb&&
this.dispose()}R7e(Da=0){Da?(this.MKa=!0,G.Task.delay(Da).continueWith(()=>{this.VXg?this.arm():this.F2b(!0);this.MKa=!1})):this.VXg?this.hide():this.F2b()}arm(){this.MKa&&this.hide()}oJk(){if(n.AFrameworkApplication.ta&&n.AFrameworkApplication.ta.Nb.zoa&&Gd.c()){const Da=appChrome.selectors.getShyState();return Da.isActive&&0!==Da.state}return!1}xRa(Da,jb){Da=this.UPb;this.oJk()||2!==jb.type&&(4!==jb.type||3===Da)?4===jb.type&&3===Da?(this.MKa&&(this.MKa=!1),this.R7e()):3!==jb.type||3!==Da||this.mtb||
(1<this.s0a?(this.MKa=!0,G.Task.delay(250).continueWith(()=>{this.F2b(!0);this.MKa=!1})):this.R7e()):(this.MKa&&(this.MKa=!1),3!==Da&&(this.zXh(),3===jb.Jo.jg&&this.R7e(2E3)));this.raiseEvent(ee.lU,jb)}uec(Da){3===Da.jg?this.xRa(this,new ee(4,Da)):Da.eventName===xf.a.pointerOver?this.xRa(this,new ee(2,Da)):Da.eventName===xf.a.pointerOut&&this.xRa(this,new ee(3,Da));return!1}$$f(Da){this.element.style.width=Da+"px";this.element.style.height=this.beb+"px"}a4c(Da){this.PWn(Da);Da=this.TCb(Da);if(!(0>
Da)){var jb=this.rq[Da];Array.removeAt(this.rq,Da);delete this.ukd[jb.clientId];jb=this.F3[Da];this.m6.removeChild(jb.element);this.Sd.get(18,!1)&&jb.GMb(Object(e.a)(this,this.xRa,"onInteractivityChanged"));Array.removeAt(this.F3,Da);jb.dispose()}}g$i(Da=5){if(this.fuc.length){this.visible&&this.R1a();for(let jb=0;jb<this.fuc.length;jb++)this.a4c(this.fuc[jb]);Array.clear(this.fuc);0>=this.rq.length||5===Da?this.hide():0===Da&&this.Ejc()}}TCb(Da){for(let jb=0;jb<this.rq.length;jb++)if(this.rq[jb].clientId===
Da)return jb;return-1}PWn(Da){-1===this.TCb(Da)?l.ULS.sendTraceTag(41706452,302,50,"Cannot remove active editor because client id is invalid"):Array.contains(this.PRb,Da)&&(Array.remove(this.PRb,Da),this.rq[0].clientId===Da&&0<this.PRb.length&&this.GOi(this.PRb[this.PRb.length-1]),this.rq[0].clientId===Da&&1===this.UPb&&this.F2b())}cmj(Da){Da?Sys.UI.DomElement.addCssClass(this.m6,"prBackgroundSelection"):Sys.UI.DomElement.removeCssClass(this.m6,"prBackgroundSelection")}Kho(){let Da,jb;jb=Da=0;var ic=
this.foc;if(this.Dkh){const Lc=this.Dkh(this);if(!Lc)return{offsetX:Da,offsetY:jb,wni:ic};const ad=4===this.UPb;ic=this.oek.m_l(this.s0a,ad?6:this.beb,this.beb,this.element,Lc);jb=ic.offsetTop;this.tnd=this.QYl(ic.OIj,ic.offsetTop);ic=ic.xni;ic!==this.foc&&(this.d7f(ic),this.element.dir=3===ic?"rtl":"ltr",this.foc=ic);ic!==this.U6h()?(Da=this.uek?-2:ad?-6:-this.beb,this.aYb=!0):this.aYb=!1}return{offsetX:Da,offsetY:jb,wni:ic}}QYl(Da,jb){if(1===Da)return this.s0a-1;Da=Math.abs(jb);return 0<Da?Da/(this.beb+
2):0}d7f(Da){for(let jb=0;jb<this.s0a;jb++)this.F3[jb].d7f(Da)}U6h(){return this.em?3:4}static Sgb(){return String.format("{0}-{1}","presencetooltip",od.zuc++)}static htf(Da){return Da.Gb.rawEvent.relatedTarget}}od.zuc=0;Object(m.a)(od,"ModernPresenceTooltipControl",yd,[1087,9]);var vf=c(230),df=c(273);class dh{constructor(Da){this.Sd=Da;this.Sd.NMa(10,vf.a.instance);this.Sd.NMa(9,Ud.a.instance);this.Sd.NMa(6,20);this.Sd.NMa(13,df.a.instance);this.Sd.NMa(17,!1)}L$e(Da,jb=!1){this.Sd.NMa(15,jb);return new od(Da,
20,this.Sd)}}Object(m.a)(dh,"ModernPresenceTooltipFactory",null,[1085]);class Ki extends yd{constructor(Da,jb){super(Da);this.rq=null;this.cMa=jb.get(8,!1);this.f$a=jb.get(6,0);this.element=Da;this.element.className=Ki.Nkf;this._ul=this.createElement("ul");this.element.appendChild(this._ul);this.hg=jb.get(10);this.hg.lb(xf.a.click,this.element,Object(e.a)(this,this.onClick,"onClick"));this.Yr=jb.get(9);this.Yr.lb(xf.a.pointerOut,this.element,Object(e.a)(this,this.yJ,"onPointerOut"));this.Yr.lb(xf.a.pointerDown,
this.element,Object(e.a)(this,this.cja,"stopPropagationAndPreventDefaultBehavior"));this.pE=jb.get(13);this.pE.lb(this.element,Object(e.a)(this,this.cja,"stopPropagationAndPreventDefaultBehavior"))}Zyb(Da){this.addHandler(ee.lU,Da)}GMb(Da){this.removeHandler(ee.lU,Da)}get users(){return this.rq}dispose(){this.element&&(this.hg.rc(xf.a.click,this.element,Object(e.a)(this,this.onClick,"onClick")),this.Yr.rc(xf.a.pointerDown,this.element,Object(e.a)(this,this.cja,"stopPropagationAndPreventDefaultBehavior")),
this.Yr.rc(xf.a.pointerOut,this.element,Object(e.a)(this,this.yJ,"onPointerOut")),this.pE.rc(this.element,Object(e.a)(this,this.cja,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}hide(){this.visible=!1}show(Da,jb,ic){this.hide();!Da||0>=Da.length||(this.cMa?this.element.style.right=jb+"px":this.element.style.left=jb+"px",this.element.style.top=ic+"px",this.Puk(Da),this.visible=!0)}Puk(Da){this.rq=Da;nf.a.tC(this._ul);for(let jb=Da.length-1;0<=jb;jb--)this.Wea(Da[jb])}Wea(Da){const jb=
document.createElement("li");jb.style.backgroundColor=Da.color;jb.style.height=this.f$a+"px";jb.id="fly_"+Da.clientId;jb.style.lineHeight=this.f$a+"px";nf.a.Ey(jb,Da.userName);jb.setAttribute("dir","auto");this._ul.appendChild(jb)}onClick(){this.hide();return!1}yJ(Da){this.raiseEvent(ee.lU,new ee(3,Da));return!1}}Ki.Nkf="prFlyout UIFont";Object(m.a)(Ki,"PresenceTooltipFlyoutControl",yd,[]);class Zh extends yd{constructor(Da,jb,ic){super(Da);this._img=null;this.rq=[];this.element.className="prGlyph";
this.Sd=jb;this.GXb=this.Sd.get(9);this.Jq=this.Sd.get(10);this.pE=this.Sd.get(13);this.xrm();this.Wea(ic);this.aFe=!1}get r4a(){return this.rq.length}get users(){return this.rq}Zyb(Da){this.addHandler(ee.lU,Da)}GMb(Da){this.removeHandler(ee.lU,Da)}dispose(){this.JOo();super.dispose()}Wea(Da){Array.add(this.rq,Da);2===this.r4a?this.wja(!0):1===this.r4a?this.wja(!1):this.wja(this.aFe)}C5a(Da){this.AAl(Da)&&(1<this.r4a&&this.wja(!0),1===this.r4a?this.wja(!1):1>this.r4a&&this.hide())}show(){this.wja(2<=
this.r4a);this.visible=!0}hide(){this.visible=!1}AYl(Da){return Da?this.s5h(0,5):this.s5h(1,4)}AAl(Da){for(let jb=0;jb<this.r4a;jb++)if(this.rq[jb].clientId===Da)return Da=this.rq[jb],Array.removeAt(this.rq,jb),Da;return null}wja(Da){this.aFe!==Da&&(this._img&&this.element.removeChild(this._img),this._img=this.AYl(Da),this.element.appendChild(this._img),this.aFe=Da);this._img.childNodes[0].style.backgroundColor=this.rq[this.rq.length-1].color}s5h(Da,jb){const ic=this.Sd.get(6,0),Lc=this.Sd.get(14);
return ve.createClusteredImageFromClusterWithImageClass(ic,ic,this.Sd.get(Da),this.Sd.get(jb),"cui-img-cont-float cui-img-16by16","",!1,"",this.element.ownerDocument,Lc?Lc.cloneNode(!0):null)}fP(Da){3!==Da.jg&&this.raiseEvent(ee.lU,new ee(2,Da));return!1}onClick(Da){this.raiseEvent(ee.lU,new ee(1,Da));return!0}yJ(Da){3!==Da.jg&&this.raiseEvent(ee.lU,new ee(3,Da));return!1}JOo(){this.element&&(this.GXb.rc(xf.a.pointerDown,this.element,Object(e.a)(this,this.cja,"stopPropagationAndPreventDefaultBehavior")),
this.GXb.rc(xf.a.pointerOver,this.element,Object(e.a)(this,this.fP,"onPointerOver")),this.GXb.rc(xf.a.pointerOut,this.element,Object(e.a)(this,this.yJ,"onPointerOut")),this.Jq.rc(xf.a.mB,this.element,Object(e.a)(this,this.cja,"stopPropagationAndPreventDefaultBehavior")),this.Jq.rc(xf.a.click,this.element,Object(e.a)(this,this.onClick,"onClick")),this.pE.rc(this.element,Object(e.a)(this,this.cja,"stopPropagationAndPreventDefaultBehavior")))}xrm(){this.element&&(this.GXb.lb(xf.a.pointerDown,this.element,
Object(e.a)(this,this.cja,"stopPropagationAndPreventDefaultBehavior")),this.GXb.lb(xf.a.pointerOver,this.element,Object(e.a)(this,this.fP,"onPointerOver")),this.GXb.lb(xf.a.pointerOut,this.element,Object(e.a)(this,this.yJ,"onPointerOut")),this.Jq.lb(xf.a.mB,this.element,Object(e.a)(this,this.cja,"stopPropagationAndPreventDefaultBehavior")),this.Jq.lb(xf.a.click,this.element,Object(e.a)(this,this.onClick,"onClick")),this.pE.lb(this.element,Object(e.a)(this,this.cja,"stopPropagationAndPreventDefaultBehavior")))}}
Object(m.a)(Zh,"PresenceTooltipGlyph",yd,[]);class rh extends yd{constructor(Da,jb,ic){super(Da);this.rq=[];this.tK=[];this.tLa=0;this.VAc=this.RUb=!1;this.qKg=null;this.vkd={};this.Sd=ic;this.em=ic.get(8,!1);this.Bka=ic.get(11,!1);Da=ic.get(12,0);this.imageDimension=ic.get(6,0);this.fla=jb;this.element.id=rh.Sgb();this.element.className=yd.mMh(this.em);Da&&(this.zIndex=Da);this.rtl=this.em;this.$$f(jb);this.xAa=this.createElement("div");this.xAa.className=this.Bka?"prContainerV":"prContainerHr";
this.element.appendChild(this.xAa);this.oVg=Array(this.tLa);for(jb=0;jb<this.tLa;jb++)this.hba[jb]=new Ki(this.createElement("div"),this.Sd),this.hba[jb].Zyb(Object(e.a)(this,this.xRa,"onInteractivityChanged")),this.element.appendChild(this.hba[jb].element)}get L$d(){return Ye.a.clone(this.rq)}get hba(){return this.oVg}get xmh(){return this.qKg}get bje(){return this.imageDimension+2}get width(){return this.Bka?this.bje:this.fla}get height(){return this.Bka?this.fla:this.bje}Zyb(Da){this.addHandler(ee.lU,
Da)}GMb(Da){this.removeHandler(ee.lU,Da)}dispose(){if(this.hba)for(const Da of this.hba)Da.GMb(Object(e.a)(this,this.xRa,"onInteractivityChanged")),$d.a.UB(Da);$d.a.K8f(this.tK);this.tK=this.oVg=null;super.dispose()}Ejc(){this.R1a();this.$dg();this.visible=!0;this.RUb=!1}f8c(){!this.tK||1>this.tK.length||(this.R1a(),this.visible=!0,this.$dg(),this.z$d(this.tK[this.tK.length-1]),this.RUb=!0)}Ndg(){if(this.tK&&!(1>this.tK.length)){this.visible=!0;this.$dg();var Da=0;for(const jb of this.tK)this.z$d(jb,
Da++);this.RUb=!1;this.VAc=!0}}hide(){this.visible=!1;this.R1a();for(let Da=0;Da<this.tK.length;Da++)this.tK[Da].hide();this.RUb=!1}wCh(){if(!this.VAc)return!1;let Da=0;for(const jb of this.hba)jb.visible&&Da++;return this.VAc=0<Da&&(this.rq.length<=this.tLa?Da===this.rq.length:Da===this.tLa)}Wea(Da){if(!(0>=this.tLa)){Da.clientId||(Da.clientId=(rh.zuc++).toString());if(Da.clientId in this.vkd){var jb=this.TCb(Da.clientId);if(0<=jb){jb=this.rq[jb];if(jb.color===Da.color&&jb.userName===Da.userName)return;
this.C5a(Da.clientId)}}jb=this.wCh();var ic=0;if(this.rq.length<this.tLa){var Lc=new Zh(this.createElement("div"),this.Sd,Da);Lc.Zyb(Object(e.a)(this,this.xRa,"onInteractivityChanged"));this.em&&!this.Bka&&0<this.rq.length?this.xAa.insertBefore(Lc.element,this.xAa.firstChild):(this.xAa.appendChild(Lc.element),ic=this.tK.length);Array.add(this.tK,Lc)}else this.em&&!this.Bka?Lc=this.tK[0]:(ic=this.tK.length-1,Lc=this.tK[ic]),Lc.Wea(Da);Lc.show();this.vkd[Da.clientId]=Lc;Array.add(this.rq,Da);this.GEj(Lc,
ic);jb&&this.Ndg()}}C5a(Da){const jb=this.wCh();jb&&this.R1a();this.a4c(Da);this.rq.length>=this.tLa&&this.tK.length<this.tLa&&this.oOn();0>=this.rq.length?this.hide():jb&&this.Ndg()}GOi(){}a4c(Da){var jb=this.TCb(Da);0>jb||(Da=this.rq[jb],Array.removeAt(this.rq,jb),jb=this.vkd[Da.clientId],delete this.vkd[Da.clientId],jb.C5a(Da.clientId),this.GEj(jb),0>=jb.r4a&&(this.xAa.removeChild(jb.element),Array.remove(this.tK,jb),jb.dispose()))}oOn(){var Da=this.H4l();!Da||1>=Da.users.length||(Da=Array.clone(this.rq),
Da.forEach(jb=>{this.a4c(jb.clientId)}),Da.forEach(jb=>{this.Wea(jb)}))}TCb(Da){for(let jb=0;jb<this.rq.length;jb++)if(this.rq[jb].clientId===Da)return jb;return-1}H4l(){return this.em&&!this.Bka?this.tK[0]:this.tK[this.tK.length-1]}position(Da,jb){this.element.style.top=jb+"px";this.element.style.left=Da+"px"}$dg(){for(let Da=0;Da<this.tK.length;Da++)this.tK[Da].show()}R1a(){for(let Da=0;Da<this.tLa;Da++)this.hba[Da].hide();this.VAc=!1}z$d(Da,jb=0){if(Da)if(this.qKg=Da,this.Bka){const ic=this.imageDimension;
if(1<Da.users.length)this.hba[jb].show(Da.users,ic,this.height-this.imageDimension);else{const Lc=this.xAa.children.length;for(let ad=0;ad<this.xAa.children.length;ad++)Da.element===this.xAa.children[ad]&&this.hba[jb].show(Da.users,ic,this.height-(Lc-ad)*this.bje+2)}}else this.hba[jb].show(Da.users,this.width,0)}xRa(Da,jb){var ic=Object(z.a)(Zh,Da);ic=ic?this.wZh(ic):-1;if(2===jb.type||1===jb.type&&-1!==ic&&!this.hba[ic].visible)this.z$d(Da);else if(1===jb.type)this.R1a(),this.RUb=!1;else if(3===
jb.type){if(this.kif(jb.Jo))return;this.RUb||this.R1a()}this.raiseEvent(ee.lU,jb)}kif(Da){Da=rh.htf(Da);let jb=!1;for(const ic of this.hba)if(nf.a.VPa(ic.element,Da)){jb=!0;break}return this.xAa!==Da&&nf.a.VPa(this.xAa,Da)||jb}GEj(Da,jb=0){const ic=this.uDm(Da);ic&&0>=Da.r4a?this.hba[jb].hide():ic?this.z$d(Da):this.hba[jb].hide()}wZh(Da){let jb=0;for(const ic of this.tK){if(Da===ic)return jb;jb++}return-1}uDm(Da){const jb=this.wZh(Da);return!!this.xmh&&Da===this.xmh&&-1!==jb&&this.hba[jb].visible}$$f(Da){this.tLa=
Da===this.imageDimension?1:Math.floor(Da/this.bje);this.Bka?(this.element.style.height=Da+"px",this.element.style.width=this.imageDimension+"px"):(this.element.style.width=Da+"px",this.element.style.height=this.imageDimension+"px")}static Sgb(){return String.format("{0}-{1}","presencetooltip",rh.zuc++)}static htf(Da){Da=Da.Gb.rawEvent;return Da.relatedTarget||Da.toElement}}rh.zuc=0;Object(m.a)(rh,"PresenceTooltipControl",yd,[1087,9]);class bm{constructor(Da){this.Sd=Da;this.Sd.NMa(10,vf.a.instance);
this.Sd.NMa(9,Ud.a.instance);this.Sd.NMa(6,16);this.Sd.NMa(13,df.a.instance)}L$e(Da){return new rh(Da,16,this.Sd)}}Object(m.a)(bm,"PresenceTooltipFactory",null,[1085]);var Bf=c(251),ig=c(112),md=c(53),td=c(6),wd=c(5),pm=c(18),ai=c(78),Zg=c(510),Tk=c(306),el=c(110);class zl extends Sys.EventArgs{constructor(Da,jb){super();this.paragraphId=Da;this.nXm=jb}}Object(m.a)(zl,"PresenceControlRenderedEventArgs",Sys.EventArgs,[]);class ei extends yd{constructor(Da,jb,ic,Lc,ad,ce=null,fc=null){super(null);this.okd=
this.Um=null;this.eXc=!1;this.Jqa=0;this.xp=Da;this.XBc=jb;this.Yr=ic;this.mj=Lc;this.zJa=ad;ei.Htb=0;this.Nrh=new Rb.a;this.cdj=new Rb.a;this.kW=ce;this.Ma=fc;this.o2j=this.Ma.mc("PresenceIpRenderedFloodgateTimeLapseSec",30);this.amk=this.Ma.mc("PresenceIpRenderedFloodgateTriggerThreshold",3);this.Ara=0}get h4a(){return n.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}Bvk(Da){this.addHandler("CR",Da)}O$i(Da){this.removeHandler("CR",Da)}Wbe(){this.raiseEvent("CR",new zl(this.xp.ip.paragraphId,
this.eXc))}LNf(){if(Object(el.a)(od,this.Um)){const Da=Object(z.a)(od,this.Um);ei.Htb=0<ei.Htb?ei.Htb+1:Da.B_a+1;Da.zIndex=ei.Htb;this.element.style.zIndex=String(ei.Htb)}}Z3n(){if(Object(el.a)(od,this.Um)){const Da=Object(z.a)(od,this.Um);ei.Htb=Da.B_a;Da.zIndex=Da.B_a;this.element.style.zIndex=String(Da.B_a)}}uJi(){this.kW&&!this.cLo()&&this.kW.continueWith(()=>{this.kW.result.logActivity("PresenceIpRendered","PresenceIpRenderedFloodgateEnabled",this.o2j)&&this.Ara++})}cLo(){return this.Ara>=this.amk}static JIi(){ei.aVg||
(ei.aVg=!0,l.ULS.sendTraceTag(4006594,302,50,"First presence ip rendered on the page"))}static Sgb(Da){return ei.Nsm+Da.m9h()}}ei.V1i="data-presence-control";ei.KYi="OverlayControlElementOwner";ei.Nsm="ipId_";ei.W1i="WacPresence";ei.xwn="PresenceIpPaddingDiv";ei.aVg=!1;ei.Htb=0;Object(m.a)(ei,"APresenceControl",yd,[1268,9]);class fi{constructor(){this.rotation=this.height=this.width=this.top=this.left=0;this.B6a=!1}}Object(m.a)(fi,"PresenceImageControlStyle",null,[1267]);class Lj extends ei{constructor(Da,
jb,ic,Lc,ad,ce=null,fc=null){super(Da,jb,ic,Lc,ad,ce,fc);this.yJ=()=>{this.MNi();return!1};this.e8d=kf=>{this.Um&&3===kf.jg&&(2!==this.Jqa?(this.LNf(),this.UOb()):this.MNi());return!1}}C5a(Da){this.Um&&this.Um.C5a(Da)}eoe(){return this.Um?this.Um.L$d.length:0}updatePosition(Da){if(this.element&&this.element.parentNode){var jb=this.M9h(Da);if(jb){var ic=Sys.UI.DomElement.getBounds(this.element.parentNode),Lc,ad;({left:ic,top:Lc,height:ad,width:jb}=this.i7l(jb,ic,this.element.parentNode,this.mj.instance));
this.element.style.top=Lc+"px";this.element.style.left=ic+"px";this.element.style.height=ad+"px";this.element.style.width=jb+"px";ic=this.U9h(Da);Df.a.d5(this.element,ic);Da=this.Eqf(Da,this.xp.ip.shapeId);this.Hmj(ic,jb,this.isSelected(Da),n.AFrameworkApplication.isRtl);this.UOb()}}}BY(){this.element&&(nf.a.gx(this.element),this.Um.C5a(this.xp.user.clientId),this.Wbe())}JGh(Da,jb,ic,Lc){jb=new fi;if(!Lc||!ic)return jb;ic=this.M9h(Da);if(!ic)return jb;jb.top=ic.y;jb.left=ic.x;jb.height=ic.height;
jb.width=ic.width;jb.rotation=this.Q9l(Da);jb.B6a=!0;return jb}Maj(Da,jb,ic,Lc){ei.JIi();this.okd=Da;if(Lc){const ad=this.Eqf(Da,this.xp.ip.shapeId);if(!ad)return;const ce=!this.element;ce&&this.P$e(jb.ownerDocument,Da);ce||!this.element.parentNode?ad.appendChild(this.element):this.element.parentNode!==ad&&(this.element.parentNode.removeChild(this.element),ad.appendChild(this.element));this.Um.Wea(this.xp.user);this.element.style.borderColor=this.xp.user.color;this.element.id=ei.Sgb(this.xp);ic.B6a&&
(this.element.style.height=ic.height+"px",this.element.style.top=ic.top+"px",this.element.style.left=ic.left+"px",this.element.style.width=ic.width+"px",Df.a.d5(this.element,ic.rotation),Df.a.d5(this.Um.element,-1*ic.rotation),this.Hmj(ic.rotation,ic.width,this.isSelected(ad),n.AFrameworkApplication.isRtl),this.UOb())}this.eXc=!Lc;this.Wbe()}Q9l(Da){return this.element&&this.element.parentNode&&this.Zei(Df.a.getTransform(this.element.parentNode))?this.Zei(Df.a.getTransform(this.element)):this.U9h(Da)}Zei(Da){return Da&&
-1<Da.indexOf("deg")&&(Da=parseInt(Da.substring(Da.indexOf("(")+1,Da.indexOf("deg"))),!isNaN(Da))?Da:0}gEj(Da){this.element.style.borderColor=this.xp.user.color;this.element.id=ei.Sgb(this.xp);this.updatePosition(Da)}P$e(Da,jb){this.element=Da.createElement("div");this.element.setAttribute(ei.V1i,!0);ig.a.ql(this.element,ei.KYi,this);this.element.className=Lj.CEn;n.AFrameworkApplication.K&&n.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.LoopsCoAuthSelectionIssueFixIsEnable",
!1)&&(Da=jb.Bb)&&Da.rQ&&(this.element.style.pointerEvents="none");this.element.dir=n.AFrameworkApplication.isRtl?"rtl":"ltr";this.Um=this.XBc.L$e(this.createElement("div"),!0);this.Um.Wea(this.xp.user);this.Um.hide();this.Yr.lb(xf.a.pointerOut,this.Um.element,this.yJ);this.Yr.lb(xf.a.pointerDown,this.Um.element,this.e8d);this.Um.element.classList.add(ei.W1i);this.element.appendChild(this.Um.element)}i7l(Da,jb,ic,Lc){let ad=Da.y,ce=Da.x,fc=Da.height;Da=Da.width;(1<Math.abs(jb.width-ic.offsetWidth)||
1<Math.abs(jb.height-ic.offsetHeight))&&Lc&&(ad=Math.round(ad/Lc.ij),ce=Math.round(ce/Lc.ij),fc=Math.round(fc/Lc.ij),Da=Math.round(Da/Lc.ij));return{left:ce,top:ad,height:fc,width:Da}}isSelected(Da){return Da.classList.contains(Tk.a.m4b)}Hmj(Da,jb,ic,Lc){this.Um.element.style.left="auto";this.Um.element.style.top="auto";this.Um.element.style.right="auto";this.Um.element.style.bottom="auto";ic=ic?Math.round(.5*Lj.Iqa)+Lj.SIo:0;0<=Da&&90>Da||360===Da?(this.Um.element.style.top=-.5*Lj.Iqa-ic+"px",Lc?
this.Um.element.style.right=jb-.5*Lj.Iqa+"px":this.Um.element.style.left=jb-.5*Lj.Iqa+"px"):90<=Da&&180>Da?(this.Um.element.style.left=-.5*Lj.Iqa-ic+"px",Lc?this.Um.element.style.bottom=-.5*Lj.Iqa+"px":this.Um.element.style.top=-.5*Lj.Iqa+"px"):180<=Da&&270>Da?(this.Um.element.style.bottom=-.5*Lj.Iqa-ic+"px",Lc?this.Um.element.style.left=jb-.5*Lj.Iqa+"px":this.Um.element.style.right=jb-.5*Lj.Iqa+"px"):(this.Um.element.style.right=-.5*Lj.Iqa-ic+"px",Lc?this.Um.element.style.top=-.5*Lj.Iqa+"px":this.Um.element.style.bottom=
-.5*Lj.Iqa+"px")}yl(Da,jb){const ic=this.APd(Da,jb);return ic?ic.properties:(Da=this.S9h(Da,jb))?Da.properties:null}Eqf(Da,jb){var ic=this.APd(Da,jb);return ic&&(ic=ic.Lva(Da.eh,Da))?ic.element:(jb=this.S9h(Da,jb))?Object(z.a)(Zg.a,jb).De(Da.ic).htmlElement:null}APd(Da,jb){Da=ai.i(Da.Bb,5);for(const ic of Da)if(ic.properties.getValue(td.a.hCb)===jb)return ic;return null}S9h(Da,jb){Da=wd.GraphIterator.$a(Da.Bb);let ic=Da.Rb(6);for(;ic;){const Lc=ic.properties.getValue(td.a.hCb);if(pm.ImageReader.gv(ic)&&
Lc===jb)return ic;ic=Da.vf(6)}return null}oYl(Da){const jb=md.a.xf(pm.ImageReader.fF(Da),0);Da=md.a.xf(pm.ImageReader.wG(Da),1);return{Dja:jb,sqm:Da}}U9h(Da){Da=this.yl(Da,this.xp.ip.shapeId);return pm.ImageReader.z_(Da)}M9h(Da){var jb=this.xp.ip;if(!jb||!jb.shapeId)return null;var ic=this.yl(Da,jb.shapeId);const Lc=this.Eqf(Da,jb.shapeId);if(!ic||!Lc)return null;const ad=pm.ImageReader.mk(ic);let ce=Da=1,fc;({Dja:jb,sqm:fc}=this.oYl(ic));Fa.App.instance&&Fa.App.instance.c4(ad)?(ic=pm.ImageReader.mna(ic),
Da=md.a.xf(ic[0],0),ce=md.a.xf(ic[2],1)):ic.hasProperty(td.a.Cca)?(ic=ic.getValue(td.a.Cca),Da+=md.a.xf(ic[0],0),ce+=md.a.xf(ic[2],1)):(Da+=0<Lc.offsetWidth?(Lc.offsetWidth-jb)/2:2,ce+=0<Lc.offsetHeight?(Lc.offsetHeight-fc)/2:2);return new Sys.UI.Bounds(Math.round(Da),Math.round(ce),Math.round(jb),Math.round(fc))}MNi(){this.Um&&(this.Um.Ejc(),this.Jqa=1)}UOb(){for(const Da of this.Um.L$d)if(Da.clientId===this.xp.user.clientId&&!Da.equals(this.xp.user)){this.Um.Wea(this.xp.user);break}if(this.xp.kTa||
2===this.Jqa)this.Um.f8c(),this.xp.kTa=!1,this.xp.Vba=!0,this.Jqa=2;this.xp.Vba&&1!==this.Jqa||(this.Um.Ejc(),this.xp.Vba=!0,this.Jqa=1)}}Lj.CEn="WACImgPresenceHighlight";Lj.Iqa=20;Lj.SIo=6;Object(m.a)(Lj,"PresenceImageControl",ei,[]);var cm=c(276);class Rg{constructor(){this.height=this.top=this.left=this.iti=0;this.B6a=!1;this.LB=this.Ih=null}}Object(m.a)(Rg,"PresenceIpControlStyle",null,[1267]);var Xf=c(61);class Si extends ei{constructor(Da,jb,ic,Lc,ad,ce=null,fc=null,kf=null){super(Da,jb,ic,
Lc,ad,ce,fc);this.bBc=this.mWa=this.dZb=null;this.fP=Tc=>{!this.Um||this.h4a&&!this.Um.kif(Tc)||(this.LNf(),this.Ree(Tc));this.gEj(this.okd);return!1};this.yJ=()=>{this.Um&&this.RQ();return!1};this.e8d=Tc=>{this.Um&&3===Tc.jg&&(2!==this.Jqa?(this.LNf(),this.Ree(Tc)):this.RQ());return!1};this.uD=kf}P$e(Da){this.element=Da.createElement("div");this.element.setAttribute(ei.V1i,!0);ig.a.ql(this.element,ei.KYi,this);this.element.className=ei.xwn;this.element.dir=n.AFrameworkApplication.isRtl?"rtl":"ltr";
this.Yr.lb(xf.a.pointerOver,this.element,this.fP);this.h4a&&(this.Yr.lb(xf.a.pointerOut,this.element,this.yJ),this.Yr.lb(xf.a.pointerDown,this.element,this.e8d));this.mWa=this.createElement("div");this.mWa.className=Si.DEn;this.h4a||(this.bBc=this.createElement("div"),this.bBc.className=Si.GEn,this.mWa.appendChild(this.bBc));this.Um=this.XBc.L$e(this.createElement("div"),this.h4a);Da=this.Ma.$("NoPresenceUserLookUpBeforeRender");this.uD&&!Da&&(this.xp.user=this.uD.eLf(this.xp.user.clientId)||this.xp.user);
this.Um.Wea(this.xp.user);this.Um.hide();this.Um.element.classList.add(this.h4a?ei.W1i:Si.Qzn);this.mWa.appendChild(this.Um.element);this.element.appendChild(this.mWa)}pil(){this.dZb&&(gc.a.instance.Ve(this.dZb),this.dZb=null)}UOb(Da){for(var jb of this.Um.L$d)if(jb.clientId===this.xp.user.clientId&&!jb.equals(this.xp.user)){this.Um.Wea(this.xp.user);break}jb=!1;Si.kgl===this.xp.user.color?({value:jb}=this.Nrh.Dc(this.xp.user.clientId,!1),jb||(this.Nrh.Z(this.xp.user.clientId,!0),l.ULS.sendTraceTag(17954772,
302,50,'{ "ClientID" : "'+this.xp.user.clientId+'" , "Event" : "RenderGrayPawn"}'))):({value:jb}=this.cdj.Dc(this.xp.user.clientId,!1),jb||(this.cdj.Z(this.xp.user.clientId,!0),l.ULS.sendTraceTag(17954773,302,50,'{ "ClientID" : "'+this.xp.user.clientId+'" , "Event" : "RenderColoredPawn"}')));return Da||this.xp.kTa||2===this.Jqa?(this.uJi(),this.Um.f8c(),this.xp.kTa=!1,this.xp.Vba=!0,this.Jqa=2,Si.CHo):this.xp.Vba&&1!==this.Jqa?0:(this.uJi(),this.Um.Ejc(),this.xp.Vba=!0,this.Jqa=1,Si.BHo)}Ree(Da=null){this.pil();
const jb=this.UOb(!!Da);this.h4a&&Da&&Da.eventName===xf.a.pointerOver||this.N9n(jb)}RQ(){this.Um&&this.Jqa&&(this.Z3n(),this.Um.hide(),this.Jqa=0)}N9n(Da){this.dZb=new ha.a(2,1,Da,()=>{this.dZb=null;this.RQ()},56);gc.a.instance.Vb(this.dZb)}updatePosition(Da){if(this.element&&this.element.parentNode){var jb=this.B$h(Da);if(jb){Da=Sys.UI.DomElement.getBounds(this.element.parentNode);jb=new Sys.UI.Bounds(jb.x-Da.x,jb.y-Da.y,Si.mti,jb.height);var ic;({left:Da,top:jb,height:ic}=this.l7l(jb,Da,this.element.parentNode,
this.mj.instance));this.element.style.height=2*Si.gfc+ic+"px";this.element.style.top=jb-Si.gfc+"px";this.element.style.left=Da-Si.gfc+"px";this.mWa.style.height=Math.max(Si.ANi,ic)+"px";this.Ree()}}}BY(){this.element&&(nf.a.gx(this.element),this.Wbe())}JGh(Da,jb,ic,Lc,ad){const ce=new Rg;if(!Lc||!ic)return ce;Lc=this.B$h(Da);if(!Lc)return ce;var fc=ic;ic=Da;if(Da.yj){var kf=Da.oc;fc=Da.Pg.s8b(this.xp.ip.o9.cp);0>fc&&0==fc;Da.oc.uwa?nf.a.VPa(kf.editingElement,Da.Pg.Ri.J(fc))||(ic=Xf.InteractiveViewManager.instance.Bd.Qj(Da.source),
jb=ic.Pg.Ri.J(fc)):jb=ic.Pg.Ri.J(fc);fc=jb.getBoundingClientRect()}fc=new Sys.UI.Bounds(Lc.x-fc.x,Lc.y-fc.y,Si.mti,Lc.height);Da=fc.y;Lc=fc.x;fc=fc.height;kf=this.mj.instance;ad&&kf&&(ad=kf.ij,Da=Math.round(Da/ad),Lc=Math.round(Lc/ad),fc=Math.round(fc/ad));ce.top=Da-Si.gfc;ce.left=Lc-Si.gfc;ce.height=2*Si.gfc+fc;ce.iti=Math.max(Si.ANi,fc);ce.B6a=!0;ce.Ih=jb;ce.LB=ic;return ce}Maj(Da,jb,ic,Lc){ei.JIi();this.okd=Da;Da=ic.Ih;jb=ic.LB;if(Da&&jb){if(Lc){const ad=!this.element;ad&&this.P$e(Da.ownerDocument);
ad||!this.element.parentNode?Da.appendChild(this.element):this.element.parentNode!==Da&&(this.element.parentNode.removeChild(this.element),Da.appendChild(this.element));this.okd=jb;Da=this.xp.user.color;this.mWa.style.borderColor=Da;this.h4a||(this.bBc.style.borderColor=Da);this.element.id=ei.Sgb(this.xp);ic.B6a&&(this.element.style.height=ic.height+"px",this.element.style.top=ic.top+"px",this.element.style.left=ic.left+"px",this.mWa.style.height=ic.iti+"px",this.Ree())}this.eXc=!Lc;this.Wbe()}else l.ULS.sendTraceTag(520950942,
302,50,`Skip IpControl rendering due to paragraphElement is null:${!Da} or paragraphViewElement is null:${!jb}`)}dispose(){this.element&&(this.BY(),this.Yr.rc(xf.a.pointerOver,this.element,this.fP),this.h4a&&(this.Yr.rc(xf.a.pointerOut,this.element,this.yJ),this.Yr.rc(xf.a.pointerDown,this.element,this.e8d)),$d.a.UB(this.Um),this.element=this.Um=null);super.dispose()}gEj(Da){const jb=this.xp.user.color;this.mWa.style.borderColor=jb;this.h4a||(this.bBc.style.borderColor=jb);this.element.id=ei.Sgb(this.xp);
this.updatePosition(Da)}l7l(Da,jb,ic,Lc){let ad=Da.y,ce=Da.x;Da=Da.height;(1<Math.abs(jb.width-ic.offsetWidth)||1<Math.abs(jb.height-ic.offsetHeight))&&Lc&&(ad=Math.round(ad/Lc.ij),ce=Math.round(ce/Lc.ij),Da=Math.round(Da/Lc.ij));return{left:ce,top:ad,height:Da}}B$h(Da){const jb=this.xp.ip;if(!jb)return null;let ic;try{const Lc=jb.o9.cp;ic=cm.a.a_(Lc,Da,0<Lc,!1,!1,!1)}catch(Lc){l.ULS.sendTraceTag(4301318,302,15,"Could not determine the bounds of IP: isYielding={0} message={1} stack={2}",gc.a.instance.Fv,
Lc.message,Lc.stack),ic=null}return ic}}Si.Qzn="WacPawn";Si.mti=2;Si.BHo=7E3;Si.CHo=2E3;Si.gfc=5;Si.DEn="presenceIp";Si.GEn="PresenceSmallBox";Si.ANi=10;Si.kgl="0xcccccc";Object(m.a)(Si,"PresenceIpControl",ei,[]);class Sl{constructor(Da,jb,ic,Lc,ad=null,ce=null,fc=null){this.Dqc={};this.Bqc={};this.qOg={};this.XBc=Da;this.Yr=jb;this.Vm=ic;this.zJa=Lc;this.kW=ad;this.Ma=ce;this.uD=fc}get Sel(){return this.Dqc}get HNh(){return this.Bqc}h7l(Da){const jb=!!this.Ma&&this.Ma.$("PeoplesWellExtraButtonInfoIsEnabled");
return Da.ip.shapeId&&jb?this.m7l(Da):this.n7l(Da)}m7l(Da){const jb=Da.ip.shapeId.toString();this.qOg[Da.user.clientId]=jb;const ic=this.Bqc[jb];return ic?(ic.xp=Da,{returnValue:ic,coe:!0}):{returnValue:this.Bqc[jb]=new Lj(Da,this.XBc,this.Yr,this.Vm,this.zJa,this.kW,this.Ma),coe:!1}}n7l(Da){const jb=Da.user.clientId,ic=this.Dqc[jb];return ic&&ic.xp.user.equals(Da.user)?(ic.xp=Da,{returnValue:ic,coe:!0}):{returnValue:this.Dqc[jb]=new Si(Da,this.XBc,this.Yr,this.Vm,this.zJa,this.kW,this.Ma,this.uD),
coe:!1}}C$h(Da){return this.Dqc[Da]}kYl(Da){return(Da=this.Bqc[this.qOg[Da]])&&!Da.eoe()?Da:null}Fnl(){var Da=this.Dqc;for(const jb in Da)Da[jb].dispose();Da=this.Bqc;for(const jb in Da)Da[jb].dispose()}}Object(m.a)(Sl,"PresenceControlProvider",null,[]);var Om=c(157);class sg{constructor(){this.wbb=0}tbi(){this.wbb++;this.wbb===Number.MAX_VALUE&&(this.wbb=1);return this.wbb}static get instance(){return sg.fyc}}sg.fyc=new sg;Object(m.a)(sg,"PacketIdGenerator",null,[756]);var Dk=c(1090);class yj{constructor(Da,
jb,ic){this.a$n=Da;this.rum=jb;this.VDi=ic}}Object(m.a)(yj,"SuccessfulInboundReplicationCallbackData",null,[]);class Qj{constructor(Da,jb,ic,Lc,ad,ce,fc){this.F7n=(kf,Tc)=>{Tc.type||(kf=this.Nk.jUh>=this.J0j,this.rlk&&kf?(kf=this.CBe())?kf.bWh():l.ULS.sendTraceTag(19682513,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt."):this.cF())};this.Asn=kf=>{if(kf=Object(z.a)(yj,kf)){var Tc=kf.rum.si.toString(),Mg=this.CBe(),yf=Mg.wt,ng="";yf!==kf.VDi&&(l.ULS.sendTraceTag(19964236,
500,50,"Time saved due to force inbound on update notification message = {0} ms",kf.a$n.toString()),ng=this.E2l(Mg,yf,kf.VDi));l.ULS.sendTraceTag(19964237,500,50,"Revisions: {0}, InboundDuration: {1}",ng,Tc)}else l.ULS.sendTraceTag(19964235,500,10,"The callback data was null")};this.x7n=Da;this.CBe=jb;this.Nk=ic;this.rlk=ad;this.J0j=ce;this.$Vb=Lc;this.Dq=fc;this.x7n.b3(this.F7n)}cF(){const Da=this.CBe();if(!Da)l.ULS.sendTraceTag(19682514,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt.");
else if(!this.$Vb()&&Da.GQa){let jb=-1;Object(el.a)(Dk.a,Da)&&(jb=Da.ek.bHa());const ic=this.Dq.Zf("Task","ShoulderTapInboundReplicationTimer");Da.cF(this.Asn,null,new yj(jb,ic,Da.wt))}}E2l(Da,jb,ic){const Lc=new Sys.StringBuilder;Da=Da.node.od.store.getRevision(jb);if(!Da)return l.ULS.sendTraceTag(19964238,500,10,"The revision we got from the last replicator revisionId was null - {0}",{["lastRevisionId"]:jb}),"";for(Lc.append(Da.id.guid);jb!==ic;){Lc.append(", ");Lc.append(jb.guid);Da=Da.im;if(!Da)break;
jb=Da.id}return Lc.toString()}}Object(m.a)(Qj,"ContentNotificationManager",null,[]);class tg extends Qj{constructor(Da,jb,ic,Lc,ad,ce,fc){super(Da,jb,ic,Lc,ad,ce,fc)}static get Wpa(){return null!=tg.MFg?tg.MFg:tg.MFg=Ka.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}static init(){if(Fa.App.ya){var Da=Fa.App.ya.gb;Da&&(Da.Xea(tg.a_c),Da=Da.Uc)&&(tg.vv=Da.contentReplicator,tg.vv&&Fa.App.Gna().continueWith(tg.$Sf))}}static $Sf(){tg.pfd=Fa.App.Gna().result;tg.pfd&&tg.pfd.Yo&&tg.Wpa.OD().continueWith(tg.N_c)}static N_c(){tg.fj=
tg.Wpa.OD().result;if(tg.fj){var Da=n.AFrameworkApplication.K,jb=Da.$("Box4ThrottleInboundRequests");Da=Da.mc("Box4ThrottleInboundsAtUserCount",20);tg.vv.JRd=()=>tg.fj.VQa;tg.mfd=tg.mfd||new tg(tg.fj,()=>tg.vv,tg.pfd,()=>n.AFrameworkApplication.Lk,jb,Da,Fa.App.ya.Fq);tg.mfd.cF()}}static a_c(Da){tg.mfd||(Da.unb(tg.a_c),tg.init())}}tg.mfd=null;tg.fj=null;tg.vv=null;tg.pfd=null;Object(m.a)(tg,"WordContentNotificationManager",Qj,[]);var Gh=c(48);class zj{constructor(Da,jb,ic,Lc,ad,ce){this.kgd=null;this.Cah=
Da;this.ud=ic;this.xLa=Lc;this.Jy=ad;this.yh=ce;this.Aqb=jb}clone(){return new zj(this.Cah,this.Aqb.clone(),this.ud,this.xLa,this.Jy,this.yh)}get cp(){if(null!=this.kgd)return this.kgd;var Da=this.Cah.paragraphId;if(Da.equals(Ue.a.nil))return 0;var jb=this.xLa();if(!jb)return 0;Da=jb.Db(Da);if(!Da)return l.ULS.sendTraceTag(7685326,302,15,"Paragraph Node is null so returning a CP with value 0"),0;jb=this.ud.XAb(this.ud.LRa(Da.characterData,Da.pa),this.Aqb);if(Gh.a.Pj&&this.Jy){var ic=cb.a.Rc(Da,jb);
this.yh&&Da.Qs&&(ic.Eb=this.yh.CQd(Da,jb,this.Aqb.mua));jb=this.Jy.Taa(ic,!0)}else this.Jy&&this.yh&&Da.Qs&&(ic=cb.a.Rc(Da,jb),ic.Eb=this.yh.CQd(Da,jb,this.Aqb.mua),jb=this.Jy.Taa(ic,!0));return jb}jVf(){null==this.kgd&&(this.kgd=this.cp)}equals(Da){return Da?this.Aqb.isEqual(Da.Aqb,!1):!1}}Object(m.a)(zj,"WordPresenceCp",null,[771,98,772]);class pj{constructor(Da,jb){this.Jy=Da;this.yh=jb}create(Da,jb,ic,Lc){return new zj(Da,jb,ic,Lc,this.Jy,this.yh)}}Object(m.a)(pj,"Factory",null,[754]);class Il extends Sys.EventArgs{constructor(Da,
jb,ic){super();this.paragraphId=Da;this.presence=jb;this.pBf=ic}}Object(m.a)(Il,"ParagraphChangedEventArg",Sys.EventArgs,[]);class Tl{constructor(Da){this.cp=Da}equals(Da){return Da?this.cp===Da.cp:!1}clone(){return new Tl(this.cp)}}Object(m.a)(Tl,"PresenceCp",null,[771,98]);class Qg{constructor(Da,jb,ic,Lc,ad){this.paragraphId=Da;this.cp=jb;this.length=ic;this.shapeId=Lc;this.dryDeletion=ad}}Object(m.a)(Qg,"SerializablePresenceIpData",null,[]);class An{constructor(Da,jb,ic,Lc=0,ad=0){this.Gsa=null;
Da&&(this.Gsa=Ue.a.If(Da));this.Bah=new Tl(jb);this.EGa=ic;this.efh=Lc;this.NSg=ad}get paragraphId(){return this.Gsa}get o9(){return this.Bah}get shapeId(){return this.efh}get dryDeletion(){return this.NSg}isValid(){return 0<=this.o9.cp&&!!this.paragraphId&&!this.paragraphId.equals(Ue.a.nil)}getData(){return new Qg(this.paragraphId.toString(),this.o9.cp,this.EGa,this.shapeId,this.dryDeletion)}clone(){const Da=new An;Da.Gsa=this.paragraphId;Da.Bah=this.o9?this.o9.clone():null;Da.EGa=this.EGa;Da.efh=
this.shapeId;Da.NSg=this.dryDeletion;return Da}static aBb(Da){return Da.paragraphId&&void 0!==Da.cp&&null!==Da.cp&&void 0!==Da.length&&null!==Da.length?new An(Da.paragraphId,Da.cp,Da.length,void 0,Da.dryDeletion):null}}Object(m.a)(An,"PresenceIp",null,[718,98]);class Xj{constructor(Da,jb){this.ip=Da;this.user=jb}}Object(m.a)(Xj,"SerializablePresenceData",null,[]);class Gk{constructor(Da,jb){this.kTa=this.Vba=this.kdc=!1;this.lWa=jb;this.user=Da}get ip(){return this.lWa}Htf(){return new Xj(this.ip?
this.ip.getData():null,this.user.getData())}m9h(){return this.user.clientId+(this.lWa?this.lWa.paragraphId.toString():Ue.a.nil.toString())}isValid(){const Da=!!this.user&&this.user.isValid(),jb=!this.ip||this.ip.isValid();return Da&&jb}clone(){const Da=new Gk;Da.user=this.user?this.user.clone():null;Da.lWa=this.lWa?this.lWa.clone():null;Da.Vba=this.Vba;Da.kdc=this.kdc;Da.kTa=this.kTa;return Da}static aBb(Da){return Da?new Gk(eb.aBb(Da.user),Da.ip?An.aBb(Da.ip):null):null}}Object(m.a)(Gk,"PresenceInfo",
null,[732,98]);class dm extends ya.a{constructor(){super();this.syc={};this.WUa={};this.VUg=!1}get Bxn(){return this.syc}get Nyi(){return!!n.AFrameworkApplication.K&&n.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}qqh(Da){this.addHandler("PPC",Da)}taj(Da){this.removeHandler("PPC",Da)}NOc(Da){return Da.ip.paragraphId.toString()}dZe(Da,jb=!1){this.VUg||(this.VUg=!0,l.ULS.sendTraceTag(4289312,302,50,"First presence added to data manager"));var ic=({EEn:Lc}=this.DSm(Da)).returnValue;
if(Lc&&!jb)(ic=this.WUa[Da.user.clientId])&&0<=ic.length&&(ic[ic.length-1].ip.EGa=Da.ip.EGa);else{ic||this.k$i(Da.user.clientId);this.Nyi&&ic&&this.NTo(Da);jb=this.NOc(Da);var Lc=Da.user.clientId;var ad=this.syc[jb]||[],ce=this.WUa[Lc]||[];ce.length>=dm.jMi&&(ce=ce.splice(-dm.ahn,dm.jMi));ic||ad.push(Lc);ce.push(Da);this.syc[jb]=ad;this.WUa[Lc]=ce;Da.ip.paragraphId.equals(Ue.a.nil)||this.z2f(Da.ip.paragraphId,Da,!0)}}DSm(Da){var jb=this.WUa[Da.user.clientId];const ic=!jb||0>=jb.length?null:jb[jb.length-
1],Lc=!!ic&&this.NOc(ic)===this.NOc(Da);jb=Lc&&ic.ip.o9.equals(Da.ip.o9)&&ic.user.equals(Da.user);this.Nyi&&jb&&ic.ip.shapeId&&Da.ip.shapeId&&ic.ip.shapeId!==Da.ip.shapeId&&(jb=!1);return{returnValue:Lc,EEn:jb}}NTo(Da){const jb=this.dfl(Da);jb&&jb.ip.shapeId&&(Da.ip.shapeId&&Da.ip.shapeId===jb.ip.shapeId||this.z2f(jb.ip.paragraphId,jb,!1))}dfl(Da){Da=this.WUa[Da.user.clientId];return!Da||0>=Da.length?null:Da[Da.length-1]}k$i(Da){const jb=this.WUa[Da];if(jb&&0<jb.length){const ic=jb[0].ip.paragraphId,
Lc=this.NOc(jb[0]);delete this.WUa[Da];this.yYn(Lc,Da);ic.equals(Ue.a.nil)||this.z2f(ic,jb[0],!1)}}l5h(Da){return this.syc[Da]}SMc(Da,jb,ic,Lc=!1){const ad=[],ce=this.l5h(Da);if(!ce)return ad;for(let fc=0;fc<ce.length;fc++){const kf=ce[fc],Tc=this.WUa[kf];let Mg=!1;for(let yf=Tc.length-1;0<=yf;yf--){const ng=Tc[yf];if(Lc){if(ng.Vba&&ng.ip.paragraphId.equals(Ue.a.If(Da))){Mg=!0;ad.push(ng);break}}else if(Object(el.a)(Gk,ng)?ng.ip.EGa===jb:ng.ip.EGa===ic){Mg=!0;ng.kdc=!0;ad.push(ng);this.WUa[kf]=Tc.splice(yf,
Tc.length);break}}!Mg&&0<Tc.length&&Tc[0].kdc&&Tc[0].ip.paragraphId.equals(Ue.a.If(Da))&&ad.push(Tc[0])}return ad}BKl(Da){if(!Da||!Da.Qa||!Da.Qa.node)return null;Da=this.SMc(Da.Qa.node.id.toString(),0,0,!0);Da=this.zgm(Da);Da.sort((jb,ic)=>{if(!(jb&&jb.userName&&ic&&ic.userName))return l.ULS.sendTraceTag(542165082,302,15,"Missing presence user info for user in PresenceInfos"),0});return Da}zgm(Da){if(!Da||!Da.length)return[];const jb=[],ic=new K.a(J.a.ei());for(let Lc=0;Lc<Da.length;Lc++){const ad=
Da[Lc].user;ad.isAnonymous&&ic.contains(ad.clientId)||!ad.isAnonymous&&ad.email&&ic.contains(ad.email)||(jb.push(ad),ic.add(ad.isAnonymous?ad.clientId:ad.email))}return jb}z2f(Da,jb,ic){this.raiseEvent("PPC",new Il(Da,jb,ic))}yYn(Da,jb){Array.remove(this.syc[Da],jb)}}dm.jMi=10;dm.ahn=2;Object(m.a)(dm,"PresenceDataManager",ya.a,[1218]);class Pm extends dm{constructor(Da){super();this.hH=Da}dZe(Da,jb=!1){super.dZe(Da,jb)}NOc(Da){return Da.ip.Lc.toString()}l5h(Da){Da=this.hH.Db(Ue.a.If(Da));if(!Da)return null;
Da=Da.ia(td.a.Lc,0);return this.Bxn[Da.toString()]}}Object(m.a)(Pm,"WordPresenceDataManager",dm,[]);var qm=c(1465),eg=c(1059),Hk=c(1855),Qm=c(17);class Uf{constructor(Da,jb,ic,Lc,ad,ce,fc,kf,Tc,Mg,yf,ng,ji,kj,fl,dj,yk,kn,Ei,al,ph,qf,lj,Ph){this.zMa=Array(5);this.cWe=this._started=this.dRe=!1;this.INe=null;this.cbh=new K.a(J.a.ei());this.Mqd={};this.dGe=!1;this.hxn=()=>{if(!this.cWe&&!this.ul.oz){var ze=new ha.a(0,1,20,()=>{const Be=new R.a;var hf=this.Fbb.Sel;for(var pe in hf){const jm=hf[pe];jm.eXc&&
Be.add(jm.xp.ip.paragraphId)}if(this.H5d){hf=this.Fbb.HNh;for(const jm in hf)pe=hf[jm],pe.eXc&&!Be.contains(pe.xp.ip.paragraphId)&&Be.add(pe.xp.ip.paragraphId)}this.v3h(Be);this.cWe=!1},72);this.Hb.Vb(ze);this.cWe=!0}};this.JTi=()=>{this.dRe&&(this.W9f(),this.dRe=!1)};this.F4=(ze,Be)=>{this.fij(Be.nl.kb)};this.E4=(ze,Be)=>{ze=Be.Sqa;for(var hf in ze){const pe=ze[hf];this.Ma.$("CashTelemetryIsEnabled")&&this.AKc(pe,new Date,null);pe.ip?this.XYe(pe):this.b4c(pe.user.clientId)}Be=Be.HId;for(hf=0;hf<
Be.length;++hf)this.cjl(Be[hf]);this.jde()};this.kVf=(ze,Be)=>{Be.paragraphId?this.OVo(Be.paragraphId.toString(),Be.nXm,this.Mqd):l.ULS.shipAssertTag(8758481,302,!1,"null paraid")};this.X1i=(ze,Be)=>{Be.paragraphId&&(ze=this.eC.Db(Be.paragraphId))&&((Object(el.a)(Gk,Be.presence)?this.sBe(ze):this.tBe(ze))===Be.presence.ip.EGa&&this.U9n(Be.paragraphId),this.H5d&&this.FEn(Be))};this.Uv=Da;this.ib=Lc;this.uD=ad;this.nwb=ce;this.ul=Tc;this.H0j=Mg;this.Fbb=yf;this.eC=ic;this.UWg=ng;this.sBe=ji;this.tBe=
kj;this.MTj=fc;this.K0j=kf;this.qLa=fl;this.Vp=dj;this.Hc=yk;this.Hb=kn;this.nih=qf;this.wfk=Ph;this.JNe=al;this.Ma=ph;this.oqd=jb;Uf.trd=new Rb.a;for(Da=0;Da<this.oqd.length;Da++)this.oqd[Da].TUn(this);this.nwb.qqh(this.X1i);this.Uv.XYa(this.E4);lj&&this.ul.Hla(this.hxn);this.Uv.zce(this)}get H5d(){return!!this.Ma&&this.Ma.$("PeoplesWellExtraButtonInfoIsEnabled")}jde(Da=!1){this.nih&&!Da||this.Iaj()}Iaj(){const Da=new R.a,jb=this.Mqd;for(const ic in jb)Da.add(Ue.a.If(ic));this.v3h(Da);this.Mqd={}}W9f(){this.ib.hb&&
this.fij(this.ib.hb.kb,!0)}fij(Da,jb=!1){this.wfk||(this.eC.jm.Kwa||jb?Da?(jb=this.zbl(Da))?this.Uv.d$f(jb):(this.Uv.d$f(null),l.ULS.sendTraceTag(4281418,302,50,"Not supported selection context {0}",Da.Qa.contextId)):this.Uv.d$f(null):this.dRe=!0)}zbl(Da){if(!this.H5d||!Da.lkb)if(Da=Qm.SelectionEditor.Cj(Da,!0,!1),!Qm.SelectionEditor.km(Da))return null;return this.iyh(Da)}iyh(Da){const jb=Da.Qa.cpBegin,ic=Da.Qa.node.id;Da=this.sBe(Da.Qa.node);return new An(ic.toString(),jb,Da)}AKc(Da,jb,ic){if(this.JNe)if(Da&&
Da.user&&Da.user.clientId){var Lc=Da.user.clientId;this.cbh.contains(Lc)||(this.INe?(this.INe.AKc(Lc,jb,null,Uf.$9l(ic||Da.user.client)),this.cbh.add(Lc)):this.JNe.continueWith(()=>{this.INe=this.JNe.result;this.AKc(Da,jb,ic)}))}else l.ULS.sendTraceTag(42262876,302,15,"invalid presence")}j7l(Da){const jb=new R.a;for(let ic=0;ic<Da.length;ic++)jb.add(this.qgm(Da[ic]));return jb}XYe(Da){var jb=null;Da&&Da.user&&(jb=Da.user.client);Da=Da.clone();Da.user=this.uD.eLf(Da.user.clientId)||Da.user;this.Ma.$("CashTelemetryIsEnabled")&&
this.AKc(Da,new Date,jb);Da.isValid()&&!Da.user.nU()&&(jb=Da.user.clientId,Uf.trd.nb(jb)||this.vki(jb),this.CVo(jb),Da.user.userName=CommonUIStrings.l_AnonymousUserName);this.nwb.dZe(Da,!1)}CVo(Da){const {value:jb}=Uf.trd.Dc(Da,!1);jb||(Uf.trd.Z(Da,!0),l.ULS.sendTraceTag(17954774,302,50,'{ "ClientID" : "'+Da+'" , "Event" : "CreateAnonymousGrayPawn"}'))}vki(){}b4c(Da){this.nwb.k$i(Da)}cjl(Da){this.b4c(Da);const jb=this.Fbb.C$h(Da);jb&&(jb.O$i(this.kVf),jb.dispose());this.H5d&&(Da=this.Fbb.kYl(Da))&&
(Da.O$i(this.kVf),Da.dispose())}T7b(Da){if(12!==Da.type)return new R.a;Da=this.nwb.SMc(Da.id.toString(),this.sBe(Da),this.tBe(Da));return 0>=Da.length?new R.a:this.j7l(Da)}OVo(Da,jb,ic){!jb&&Da in ic&&delete ic[Da]}dispose(){this.stop();this.nwb.taj(this.X1i);this.Uv.LMb(this.E4);this.Uv.rlg(this);for(let Da=0;Da<this.oqd.length;Da++)this.oqd[Da].FPo(this);$d.a.K8f([this.MTj,this.K0j,this.Uv]);this.Fbb.Fnl()}qgm(Da){let jb=!1;Da=({coe:jb}=this.Fbb.h7l(Da)).returnValue;jb||Da.Bvk(this.kVf);return Da}Cii(Da){Da=
this.eC.Db(Da);if(!Da)return this.zMa[0]||(l.ULS.sendTraceTag(4281420,302,50,"Could not find the node in object space"),this.zMa[0]=!0),null;if(!Bb.ParagraphReader.Wb(Da))return this.zMa[1]||(l.ULS.sendTraceTag(4281421,302,50,"Not a paragraph node"),this.zMa[1]=!0),null;if(!Da.De(this.ul.ic))return this.zMa[2]||(l.ULS.sendTraceTag(4281422,302,50,"No ViewElement found for this node"),this.zMa[2]=!0),null;if(!Da.anchor)return this.zMa[3]||(l.ULS.sendTraceTag(4281423,302,50,"node is not anchored"),this.zMa[3]=
!0),null;this.zMa[4]||(l.ULS.sendTraceTag(4564931,302,50,"Valid paragraph node found for rendering ip"),this.zMa[4]=!0);return Da}Q9i(Da){Da=this.nwb.SMc(Da.toString(),-1,-1,!0);if(!Ye.a.jf(Da))for(const jb of Da)(Da=this.Fbb.C$h(jb.user.clientId))&&Da.element&&Da.BY()}v3h(Da){if(Da.count){var jb=new R.a;for(var ic of Da)(Da=this.Cii(ic))?jb.add(Da):this.Q9i(ic);if(jb.count){ic=this.Hc.Mc(2);try{ic.set(this.Vp);for(const Lc of jb)this.xSh(Lc)}finally{ic&&ic.dispose()}}}}xSh(Da){Da.kJ(this.ul.ic,32,
!0);Da.kJ(this.H0j,32,!0)}U9n(Da){this.Mqd[Da.toString()]=null;this.nih&&!this.dGe&&(Da=new ha.a(0,1,200,()=>{this.dGe=!1;this.Iaj()},70),this.Hb.Vb(Da),this.dGe=!0)}FEn(Da){if(Da.presence.ip.shapeId&&!Da.pBf){var jb=this.Fbb.HNh[Da.presence.ip.shapeId.toString()];jb&&jb.C5a(Da.presence.user.clientId)}}stop(){this._started&&(this._started=!1,this.ib.CY(this.F4),this.UWg.oaj(this.JTi))}start(){if(!this._started){this._started=!0;this.ib.Lw(this.F4);this.UWg.c_e(this.JTi);var Da=this.Uv.qDb();delete Da[this.qLa.clientId];
this.E4(null,new Hk.a(Da,[]));this.W9f()}}wie(Da){if(Da&&Da.isValid()&&Da.ip){var jb=this.nwb.SMc(Da.ip.paragraphId.toString(),-1,-1),ic=!1,Lc=null;for(let ad=0;ad<jb.length;ad++)if(Lc=jb[ad],Lc.user.clientId===Da.user.clientId){ic=Lc.kTa=!0;break}if(ic)if(jb=Lc.ip.paragraphId,Da=this.Cii(jb)){jb=this.Hc.Mc(2);try{jb.Cb(Da),this.xSh(Da)}finally{jb&&jb.dispose()}}else this.Q9i(jb)}}static $9l(Da){return Da?Da?1===Da?1:2===Da?2:0:2:0}}Uf.trd=null;Object(m.a)(Uf,"PresenceManager",null,[1214,9,673,1215,
1216,1217]);class Jd{constructor(Da,jb,ic,Lc){this.uTb=null;this._started=this.EEe=!1;this.oyb=null;this.gpa=(ad,ce)=>{if(!n.AFrameworkApplication.Lk&&(ad=this.fFj(ce.nl),this.uTb&&ad)){ad=this.fxe.SMc(this.uTb.toString(),-1,-1,!0);for(ce=0;ce<ad.length;ce++)this.oyb[ad[ce].user.clientId]=ad[ce];0>=ad.length||(ad=this.b9k(ad),this.Rp.sendNotification(ad,!0))}};this.yVi=(ad,ce)=>{this.ib.hb&&!n.AFrameworkApplication.Lk&&this.EEe&&this.uTb&&this.uTb.equals(ce.paragraphId)&&(ad=null,!ce.pBf||ce.presence.user.clientId in
this.oyb?ce.pBf||(ad=this.ZLh(ce.presence.user.userName,!1),delete this.oyb[ce.presence.user.clientId]):(ad=this.ZLh(ce.presence.user.userName,!0),this.oyb[ce.presence.user.clientId]=ce.presence),ad&&this.Rp.sendNotification(ad,!0))};this.fj=Lc;this.ib=jb;this.fxe=Da;this.Rp=ic;this.fj.zce(this)}start(){this._started||(this._started=!0,this.oyb={},this.fxe.qqh(this.yVi),this.ib.Lw(this.gpa),this.fFj(this.ib.hb))}stop(){this._started&&(this._started=!1,this.oyb=null,this.fxe.taj(this.yVi),this.ib.CY(this.gpa))}b9k(Da){if(1===
Da.length)return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphSingle,Da[0].user.userName);const jb=[],ic=Da.length;for(let Lc=0;Lc<ic;Lc++)jb.push(Da[Lc].user.userName);return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphMany,jb.join(Box4Intl.Box4Strings.l_DisplayNameSeparator))}ZLh(Da,jb){return String.format(jb?Box4Intl.Box4Strings.l_UserJoiningParagraph:Box4Intl.Box4Strings.l_UserLeavingParagraph,Da)}dispose(){this.fj.rlg(this);this.stop()}fFj(Da){if(!Da)return!1;
Da=Da.kb;if(!Da)return!1;Da=Da.Qa;if(!Da)return!1;this.EEe=Qm.SelectionEditor.gf(Da);Da=Da.node.id;if(Da.equals(this.uTb)||!this.EEe)return!1;this.uTb=Da;this.oyb={};return!0}}Object(m.a)(Jd,"PresenceAccessibilityManager",null,[9,673]);class kl{constructor(Da,jb){this._started=!1;this.cK=null;this.vld=!1;this.r_c=()=>{this._started&&this.Qhj()};this.fj=Da;jb&&(this.cK=jb,this.cK.qdb(this.r_c));this.fj.zce(this)}start(){this._started||(this._started=!0,this.cK?this.Qhj():this.fj.XM(1,this.HKh()))}Qhj(){const Da=
this.vld;(this.vld=!!this.cK.Jx)&&!Da&&this.fj.XM(1,this.HKh())}HKh(){const Da={};Da.Id="{"+n.AFrameworkApplication.userSessionId.toUpperCase()+"}";Da.HQ=!1;Da.NT=1;Da.WEB=!0;return Da}stop(){this._started&&(this._started=this.vld=!1)}dispose(){this.fj.rlg(this);this.cK&&this.cK.Q$i(this.r_c)}}Object(m.a)(kl,"EditorsTableNotifier",null,[9,673]);var Ik=c(332),tf=c(16);class hd extends Uf{constructor(Da,jb,ic,Lc,ad,ce,fc,kf,Tc,Mg,yf,ng,ji,kj,fl,dj,yk,kn,Ei,al,ph,qf,lj,Ph,ze,Be,hf,pe,jm,rk,af){super(Da,
jb,ic,Lc,ad,ce,fc,kf,Tc,Mg,yf,ji,kj,fl,dj,Ei,al,ph,qf,lj,Ph,ze,Be,jm);this.Nk=null;this.vrl=Cf=>{const Hi=!!this.Nk.XB.b7b(Cf);l.ULS.sendTraceTag(579179741,302,50,"ClientId:{0} isPresentAfterPoll:{1}",Cf,Hi)};this.trl=(Cf,Hi)=>{l.ULS.sendTraceTag(579179742,302,15,"EditorsReplicator failed with {0} when looking for ClientId {1}",Hi,Cf)};this.Wha=()=>{if(2===hd.fj.connectionState&&!La.SessionStatusManager.instance.Rba){const Cf={};Cf.qs=n.AFrameworkApplication.rootQuerySignature;hd.fj.cqb(Cf)}};ng.fb(tf.a.Zuo,
Wa.a.application,hd.$sk,64);ng.fb(tf.a.k5f,Wa.a.application,hd.k5f,64);ng.fb(tf.a.X1f,Wa.a.application,hd.X1f,96);ng.fb(Ra.a.wie,Wa.a.application,hd.Yuo,64);this.zI=yk;this.ud=kn;this.Eyb=hf;this.qLa.Zfc=pe;this.qLa.Zfc.Fxk(hd.zVi);rk.continueWith(()=>{this.Nk=rk.result});l.ULS.sendTraceTag(4006600,302,50,"WordPresenceManager Initialized");(this.G2=af)&&this.G2.execute(Cf=>{Cf.VYa(this.Wha)})}tEa(Da){if(!Da||!Da.anchor)return null;for(Da=Da.anchor.aq;Da;Da=Da.zA)if(Da.qFa)return Da.xr.node;return null}iyh(Da){var jb=
null;jb=n.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled");var ic=Da.Qa.cpBegin,Lc=Da.Qa.node;jb&&pm.ImageReader.gv(Lc)&&(Lc=this.tEa(Lc));if(!Lc)return l.ULS.sendTraceTag(51242309,302,15,"selectedNode is null"),null;Lc=this.tBe(Lc);const ad=Da.Qa.node.ia(td.a.Lc,0);if(!this.zI)return l.ULS.sendTraceTag(35997152,302,15,"paragraphWordIdMapping is null"),null;var ce=this.zI.value.Ihb(ad);const fc=hd.hH.Db(ce);if(!fc)return l.ULS.sendTraceTag(16791249,302,15,"Can't find pid "+ce),null;
ic=this.ud.cnc(this.ud.LRa(fc.characterData,fc.pa),ic);ic.mua=-1===Da.Qa.Eb?0:Da.Qa.Eb;ce=0;jb&&Da.lkb&&(ce=this.Kam(Da));return jb=new pc(this.zI.value,ad,Lc,ic,this.ud,()=>hd.hH,this.Eyb,ce)}Kam(Da){const jb=pm.ImageReader.mEa(Da.Qa);return jb?jb.properties.ia(td.a.hCb,0):Da.Qa.node.properties.ia(td.a.hCb,0)}vki(Da){this.Nk&&this.Nk.Lma&&this.Nk.Lma.cF(this.vrl,this.trl,Da)}dispose(){this.G2&&this.G2.execute(Da=>{Da.KMb(this.Wha)});super.dispose()}static get su(){return Ka.a.instance.resolve("Common.Utils.IAriaNotifier")}static OD(){return hd.Auc.task}static get_instance(){return hd.srd.task}static o7l(){return hd.Dah.task}static get Wpa(){return null!=
hd.LFg?hd.LFg:hd.LFg=Ka.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}static init(){hd.srd||(hd.srd=new y.a);hd.hVg&&(l.ULS.sendTraceTag(4256585,302,50,"WordPresenceManager Init"),hd.hVg=!1);if(Fa.App.ya){var Da=Fa.App.ya.gb;Da?(Da.Xea(hd.a_c),hd.myc=Da.wc,Da.soa()?(hd.BN=Da.Uc.contentReplicator,hd.BN?(hd.hH=Da.Uc.od,hd.hH?hd.Wpa.OD().continueWith(hd.qrn):l.ULS.sendTraceTag(4006599,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to content ObjectSpace of the app")):
l.ULS.sendTraceTag(4252228,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to the GraphSpaceReplicator object")):l.ULS.sendTraceTag(4006598,302,50,"PageView doesn't seem to have been initialized yet. Will try again once we know it's initialized")):l.ULS.sendTraceTag(4006597,302,15,"Can't initialize the WordPresenceManager because workspace is not initialized")}else l.ULS.sendTraceTag(4006596,302,15,"Can't initialize the WordPresenceManager because active AppFrame is not initialized")}static qrn(){hd.fj=
hd.Wpa.OD().result;if(hd.fj){var Da=[hd.myc.k0c,hd.myc.editingView.k0c],jb=yb.a.instance,ic=Ka.a.instance.resolve("Box4.Presence.WordPresenceDataManager"),Lc=new Jd(ic,jb,hd.su,hd.fj),ad=n.AFrameworkApplication.K.$("DoNotAddToEditorsTableOnFrameIsEnabled")?Fa.App.rd.XB:null;ad=new kl(hd.fj,ad);var ce=Ka.a.instance.Ue("WordEditor.IParagraphWordIdMapping"),fc=Ka.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),kf=Ka.a.instance.resolve("Common.IPeopleInfoProvider");
hd._instance=new hd(hd.fj,Da,hd.hH,jb,kf,ic,Lc,ad,hd.myc,hd.myc.editingView.ic,Ka.a.instance.resolve("Box4.Presence.PresenceControlProvider"),n.AFrameworkApplication.va,hd.BN,Bb.ParagraphReader.textLength,Bb.ParagraphReader.Mma,Ka.a.instance.resolve("Box4.Presence.MyPresenceUser"),ce,fc,Fa.App.Lj.Bl,new Ik.a,gc.a.instance,qm.a.get_instance(),Ma.a.Ap(Ka.a.instance.Sa("Common.App.CoauthTelemetry.IPresenceBootTelemetry")),n.AFrameworkApplication.K,n.AFrameworkApplication.K.$("Box4ThrottleAndBatchPresenceRendering"),
n.AFrameworkApplication.K.$("Box4DoNotRenderPresenceOutOfView"),Ka.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),Ka.a.instance.resolve("Common.IPresenceStatusProvider"),!Fa.App.es&&!Fa.App.um,Fa.App.Gna(),Ka.a.instance.Sa("Common.ISessionExpirationManager"));l.ULS.sendTraceTag(23196878,302,50,"WordPresenceManager instance created");hd.srd.Ag(hd._instance);hd.Auc.Ag(hd._instance);hd.Dah.Ag(hd._instance);Da=Ka.a.instance;Da.ha("WordEditor.Presence.WordPresenceManager",()=>hd._instance).as("Common.IPresenceRemover").as("Common.IPresenceSender").singleInstance();
Da.resolve("WordEditor.Presence.WordPresenceManager")}else l.ULS.sendTraceTag(4203468,302,15,"Can't initialize the WordPresenceManager because can't get a handle to RtcProxy")}static a_c(Da){hd._instance||(l.ULS.sendTraceTag(4006601,302,50,"WordPresenceManager.OnAppIsInteractive: Trying to initialize again"),(Da=Object(z.a)(16,Da))&&Da.unb(hd.a_c),hd.init())}static zVi(){hd._instance.W9f()}static $sk(Da,jb,ic,Lc,ad){ic=ad.split(",");if(!ic||3!==ic.length)return 8;Da=ic[0].trim();jb=ic[1].trim();ic=
Number.parseInvariant(ic[2].trim());Da=new Gk(new eb(Da),new An(jb,ic,-1));if(!hd.Auc.task.isCompleted)return 8;jb=hd.OD().result;jb.XYe(Da);jb.jde();return 32}static k5f(Da,jb,ic,Lc,ad){if(!hd.Auc.task.isCompleted)return 8;Da=hd.OD().result;Da.b4c(ad);Da.jde();return 32}static Yuo(Da,jb,ic,Lc,ad){if(!hd.Auc.task.isCompleted)return 8;Da=hd.OD().result;if(!Da)return 8;Da.wie(ad);return 32}static X1f(Da,jb,ic,Lc,ad){if(1===ic)return 32;if(!hd.Wpa.OD().isCompleted)return 8;Da=hd.Wpa.OD().result;if(!Da)return l.ULS.sendTraceTag(4301136,
302,10,"rtcProxy is null when trying to display RTC connection status"),8;ad[eg.a.Value]=2===Da.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnected:1===Da.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnecting:"";return 32}}hd._instance=null;hd.hVg=!0;hd.srd=new y.a;hd.Auc=new y.a;hd.Dah=new y.a;hd.hH=null;hd.myc=null;hd.BN=null;hd.fj=null;Object(m.a)(hd,"WordPresenceManager",Uf,[]);class lg{constructor(Da){this.ra=new ya.a;this.kZ=Da;this.kZ.CWR(()=>this.kZ.result.Dvk(()=>{this.ra.raiseEvent("X")}))}Fxk(Da){this.ra.addHandler("X",
Da)}H_n(Da){this.ra.removeHandler("X",Da)}getStatus(){return this.kZ.isCompleted&&this.kZ.result?this.kZ.result.nHd.toString():"0"}}Object(m.a)(lg,"WordPresenceStatusProvider",null,[755]);class Bn{constructor(Da,jb,ic,Lc){this.fj=null;this.$Ug=this.ZIe=!1;this.rrn=()=>{this.GZ.isCompleted&&this.GZ.result?(this.fj=this.GZ.result,this.fj.XYa(this.E4),l.ULS.sendTraceTag(5604372,302,50,"Presence Update Monitor is ready.")):l.ULS.sendTraceTag(5604373,302,15,"RtcTask did not complete successfully. No monitoring")};
this.E4=(ad,ce)=>{ad=ce.Sqa;for(const fc in ad)if(ce=ad[fc],!this.ZIe&&ce.user.bP&&ce.user.bP!==this.w2.bP){l.ULS.sendTraceTag(5604375,302,15,"Presence received from different local cobalt session Mine:{0} Theirs:{1}",this.w2.bP,ce.user.bP);this.ZIe=!0;break}this.ZIe&&this.fj.LMb(this.E4);this.$Ug||(l.ULS.sendTraceTag(5604374,302,50,"First presence received"),this.$Ug=!0)};this.Nk=Da;this.w2=jb;this.GZ=ic;ic.continueWith(this.rrn);this.pak=Lc;this.pak.PJf=this.w2}}Object(m.a)(Bn,"WordPresenceUpdateMonitor",
null,[]);var Rj=c(411),ge=c(1523),Uc=c(223),ql=c(1857),Cg=c(1858),yg=c(1740);class Bh{constructor(Da,jb,ic,Lc,ad,ce,fc){this.ra=new ya.a;this.D0g=this.s2g=this.aHe=this.d5g=!1;this.hWe=this.jxd=0;this.j_b=null;this.qLa=ce;this.qLa.clientId=Da.clientId;this.Fl=Da;this.j$=jb;this.I$=Lc;this.B2j=ad;this.Hb=ic;this.a$a=new Uc.a;this.kn=fc;this.j$&&this.j$.continueWith(()=>{this.j$.zo||this.j$.Ci||this.j$.result.kph(Object(e.a)(this,this.RRi,"onAmIAloneChanged"))})}get connectionState(){return this.Fl.connectionState}XYa(Da){this.ra.addHandler("PU",
Da)}LMb(Da){this.ra.removeHandler("PU",Da)}Ata(Da){this.ra.addHandler("CSC",Da)}Ygc(Da){this.ra.removeHandler("CSC",Da)}DDc(Da){this.ra.addHandler("PSU",Da)}j4c(Da){this.ra.removeHandler("PSU",Da)}Dzd(Da){this.ra.addHandler("PSC",Da)}ede(Da){this.ra.removeHandler("PSC",Da)}aij(){}get clientId(){return this.Fl.clientId}b3(Da){this.ra.addHandler("UN",Da)}MMb(Da){this.ra.removeHandler("UN",Da)}jwm(){this.j_b=Array(12);for(let Da=0;12>Da;Da++)this.j_b[Da]=0;this.s2g=this.kn?this.kn.$("UpdateNotificationTaskExperimentIsEnabled"):
!0;n.AFrameworkApplication.$H(()=>{this.d6m()})}init(){this.Fl.Ata(Object(e.a)(this,this.Qha,"onConnectionStateChanged"));this.Fl.XYa(Object(e.a)(this,this.E4,"onPresenceUpdated"));this.Fl.DDc(Object(e.a)(this,this.ARa,"onPersistentStateUpdated"));this.Fl.Dzd(Object(e.a)(this,this.Dec,"onPersistentStateCleared"));this.Fl.b3(Object(e.a)(this,this.w0,"onUpdateNotificationReceived"));this.WGh();this.jwm()}zce(Da){this.a$a.contains(Da,(jb,ic)=>jb===ic)||(this.a$a.add(Da),2===this.connectionState&&Da.start())}rlg(Da){for(let jb=
0;jb<this.a$a.length;jb++)if(this.a$a.J(jb)===Da){this.a$a.lG(jb);break}}connect(){this.aHe||this.Fl.connect()}disconnect(){this.Fl.disconnect()}get wee(){return this.Fl}mQh(Da){return Gk.aBb(Da)}t$f(Da,jb){return(new Gk(Da,jb)).Htf()}d$f(Da){Da&&Da.isValid()&&!this.I$()?this.Fl.aij(this.t$f(this.qLa.j2l(),Da)):G.Task.J3(null)}gic(Da,jb){return this.Fl.gic(Da,jb)}M6b(Da){return this.Fl.M6b(Da)}UMc(){return this.Fl.UMc()}XM(Da,jb,ic=!1){return this.Fl.XM(Da,jb,ic)}qDb(){return this.yKh(this.Fl.qDb())}cqb(Da){const jb=
new y.a;yg.a.getInstance().A5i(Da,jb);return jb.task}get VQa(){return this.Fl.VQa}Qha(Da,jb){2===jb.newState&&this.a$a.forEach(ic=>{ic.start();return!0});jb.newState||this.kn.$("SendRTCMessagesWhileDisconnectedIsEnabled")&&!this.aHe||this.a$a.forEach(ic=>{ic.stop();return!0});this.ra.raiseEvent("CSC",jb)}vkf(Da){return Da.toLowerCase()}E4(Da,jb){if(!this.I$()){Da=this.yKh(jb.Sqa);jb=this.AKh(jb.HId);var ic=new Hk.a(Da,jb);jb=new ha.a(0,1,0,()=>{this.ra.raiseEvent("PU",ic)},57);this.Hb.Vb(jb)}}yKh(Da){const jb=
{};for(const Lc in Da){var ic=Lc;const ad=this.mQh(Da[Lc]);ad&&ad.isValid()?jb[this.vkf(ic)]=ad:l.ULS.sendTraceTag(562661590,302,50,"No Valid User {0}",ic)}return jb}AKh(Da){const jb=Array(Da.length);for(let ic=0;ic<Da.length;ic++)jb[ic]=this.vkf(Da[ic]);return jb}ARa(Da,jb){if(!this.I$()){var ic={};Da=jb.Sqa;for(var Lc in Da)ic[this.vkf(Lc)]=Da[Lc];Lc=new ha.a(0,1,0,()=>{this.ra.raiseEvent("PSU",new ql.a(jb.type,ic))},80);this.Hb.Vb(Lc)}}Dec(Da,jb){if(!this.I$()){Da=this.AKh(jb.QDd);var ic=new Cg.a(Da);
Da=new ha.a(0,1,0,()=>{this.ra.raiseEvent("PSC",ic)},81);this.Hb.Vb(Da)}}w0(Da,jb){this.s2g?this.xXi(jb):(Da=new ha.a(0,1,0,()=>{this.xXi(jb)},58),this.Hb.Vb(Da))}xXi(Da){var jb=Date.now();this.ra.raiseEvent("UN",Da);jb=Date.now()-jb;500<=jb&&(this.jxd++,l.ULS.sendTraceTag(42563487,302,15,"Update Notification Heuristics: UpdateNotification Type {0} took {1} ms",Da.type,jb),this.vCl(Da));this.hWe++}vCl(Da){0>Da.type||21<=Da.type?l.ULS.sendTraceTag(42541602,302,15,"Update Notification Heuristics: UpdateNotification Type out of range {0}",
Da.type):this.j_b[Da.type]++}d6m(){if(!this.D0g){var Da={};Da.TC=this.hWe;Da.HRC=this.jxd;this.j_b&&0<this.jxd&&(Da.TBC=this.j_b);this.jxd=this.hWe=0;this.j_b=null;l.ULS.sendTraceTag(42541603,302,50,"UpdateNotificationHeuristics: {0}",Da);this.D0g=!0}}dispose(){this.a$a=new Uc.a;this.Fl.Ygc(Object(e.a)(this,this.Qha,"onConnectionStateChanged"));this.Fl.LMb(Object(e.a)(this,this.E4,"onPresenceUpdated"));this.Fl.j4c(Object(e.a)(this,this.ARa,"onPersistentStateUpdated"));this.Fl.ede(Object(e.a)(this,
this.Dec,"onPersistentStateCleared"));this.Fl.MMb(Object(e.a)(this,this.w0,"onUpdateNotificationReceived"));this.j$&&this.j$.continueWith(()=>{this.j$.zo||this.j$.Ci||this.j$.result.GZn(Object(e.a)(this,this.RRi,"onAmIAloneChanged"))});this.Fl.disconnect();l.ULS.sendTraceTag(4564935,302,50,"Disposing of rtcProxyCompleted")}RRi(){this.WGh()}WGh(){let Da=!1;this.j$?this.j$.continueWith(()=>{this.j$.zo||this.j$.Ci||(Da=!this.j$.result.amIAlone);this.Fl.connectionState||!Da&&!this.B2j()?2!==this.Fl.connectionState||
Da||(this.disconnect(),l.ULS.sendTraceTag(4564937,302,50,"Disconnecting because there are no other users in the doc")):(this.connect(),l.ULS.sendTraceTag(4564936,302,15,"Connecting because there are other authors in the doc"));!this.d5g&&Da&&(l.ULS.sendTraceTag(4203466,302,50,"There are other real-time authors in this session"),this.d5g=!0)}):(this.connect(),l.ULS.sendTraceTag(589321547,302,50,"Connecting to rtc because Rtc Always On is enabled"))}sJc(){this.aHe=!0;this.disconnect();l.ULS.sendTraceTag(4564938,
302,50,"DisconnectForever")}}Object(m.a)(Bh,"RtcProxy",null,[1194,9,875,1195]);class ug extends Bh{constructor(Da,jb,ic,Lc,ad,ce,fc,kf,Tc,Mg,yf,ng,ji){super(Da,jb,ic,Lc,ad,ce,ji);this.Gea=null;this.zI=fc;this.ud=kf;this.xLa=Tc;this.fyc=Mg;this.VSe=yf;this.Eyb=ng}get JJ(){return this.Gea||(this.Gea=this.VSe())}Qha(Da,jb){2===jb.newState&&l.ULS.sendTraceTag(4315102,302,50,"RTC Connected");this.dWo();super.Qha(Da,jb)}dWo(){this.JJ&&this.JJ.KU("RtcConnectionStatusLabel")}mQh(Da){return id.faf(xc(Da),
this.zI,this.ud,this.xLa,this.Eyb)}t$f(Da,jb){return Object(el.a)(pc,jb)?(Da=new id(this.fyc.tbi(),Da,jb),Ae(Da.Htf())):super.t$f(Da,jb)}}Object(m.a)(ug,"WordRtcProxy",Bh,[]);class Ee{constructor(Da,jb,ic,Lc,ad,ce,fc,kf,Tc,Mg,yf,ng,ji){this.Xp=new y.a;this.Mfh=!0;this.he=jb;this.Hb=ic;this.I$=Lc;this.qLa=ad;this.zI=ce;this.pta=fc;this.xLa=kf;this.fyc=Tc;this.VSe=Mg;this.G2=yf;this.Eyb=ng;this.Ma=ji}OD(){this.HLo();return this.Xp.task}mOc(){return Rj.a.then(this.OD(),Da=>Da)}HLo(){if(this.Mfh)if(this.Mfh=
!1,Fa.App.XFf()&&Fa.App.VDf()){var Da=n.AFrameworkApplication.Ne;if(Da){Da=ge.RealtimeChannel.createInstance("{"+n.AFrameworkApplication.userSessionId+"}",n.AFrameworkApplication.userSessionId,n.AFrameworkApplication.Qej,Da,this.G2,1,this.he,this.Ma.jb("RtcEndpointUrl"),void 0,void 0,null,this.Ma.$("FindSessionOnBootIsEnabled")?Ka.a.instance.resolve("Common.IFindSessionUtils"):null,this.Ma.jb("RtcBootToken"));var jb=this.Ma.$("RtcAlwaysOnEnabled"),ic=new ug(Da,jb?null:Fa.App.Gna(),this.Hb,this.I$,
Ee.NFl,this.qLa,this.zI,this.pta,this.xLa,this.fyc,this.VSe,this.Eyb,n.AFrameworkApplication.K);Fa.App.Xjo(ic);this.KUn(ic);ic.init();Om.App.Z5a=ic;this.G2.execute(Lc=>{Lc.sdb(()=>{ic.sJc()})});this.Xp.Ag(ic)}else l.ULS.sendTraceTag(8206365,302,15,"Can't initialize the RtcProxy because ClientRequestManager is null")}else l.ULS.sendTraceTag(8206362,302,10,"Can't initialize the RtcProxy because dependent scripts are not loaded")}KUn(Da){const jb=Ka.a.instance;jb.ha("WordEditor.Presence.WordRtcProxy",
()=>Da).as("Box4.Presence.IRtcProxy").as("Common.IRealtimeChannelBasic").singleInstance();jb.resolve("Common.IRealtimeChannelBasic")}static NFl(){return!1}}Object(m.a)(Ee,"WordRtcProxyProvider",null,[720,721]);class pf{constructor(){this.W=null;this.$l=!1}get name(){return"WordEditor.Presence"}init(){l.ULS.sendTraceTag(50995799,302,50,"PresencePackage Init");Fa.App.lKj&&(this.W.resolve("WordEditor.Presence.WordRtcProxyProvider").OD(),hd.init(),this.W.resolve("WordEditor.Presence.WordPresenceUpdateMonitor"));
Fa.App.jHc&&tg.init();this.W.resolve("Common.App.Presence.AwayManager");this.W.resolve("Common.IPeopleInfoProvider");if(pf.r0g){const Da=this.W.resolve("WordEditor.IMainViewModeManager");Da.$yb(this.rWf);pf.IFe=1===Da.Uu}}dispose(){if(!this.$l){this.$l=!0;hd.OD().continueWith(()=>{$d.a.UB(hd.OD().result)});var Da=this.W.resolve("Box4.Presence.MyPresenceUser");Da&&Da.Zfc&&Da.Zfc.H_n(hd.zVi)}}xc(Da){this.W=Da;this.W.ha("Box4.Presence.MyPresenceUser",()=>new ib).as("Box4.Presence.IMyPresenceUser").as("Common.IPresenceUser").as("Common.IPresenceConverter").singleInstance();
Da.ha("WordEditor.Presence.IWordPresenceCpFactory",()=>new pj(Da.resolve("Box4.CpConversionManagerImpl"),Da.resolve("Box4.IContentControlReader"))).singleInstance();Da.ha("WordEditor.Presence.WordPresenceUpdateMonitor",()=>new Bn(new W.a(()=>Fa.App.rd),Bf.a.instance,Da.resolve("WordEditor.Presence.WordRtcProxyProvider").mOc(),Da.resolve("Box4.Presence.IMyPresenceUser"))).singleInstance();Da.ha("WordEditor.Presence.WordRtcProxyProvider",()=>new Ee(n.AFrameworkApplication.buildVersion,Fa.App.ya.Fq,
gc.a.instance,()=>n.AFrameworkApplication.Lk,Ka.a.instance.resolve("Box4.Presence.IMyPresenceUser"),Ka.a.instance.Na("WordEditor.ParagraphWordIdMapping"),Ka.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),()=>n.AFrameworkApplication.ta&&Fa.App.ya.gb&&Fa.App.ya.gb.Uc?Fa.App.ya.gb.Uc.od:null,sg.instance,()=>Ka.a.instance.Na("WordEditor.IStatusBarUser"),Ka.a.instance.Sa("Common.ISessionExpirationManager"),Ka.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),
n.AFrameworkApplication.K)).singleInstance().as("Box4.Presence.IRtcProxyProvider").as("Common.Interface.IRtcBasicProvider");Da.ha("Box4.Presence.PresenceControlProvider",()=>new Sl(pf.tdl(),Ud.a.instance,Ka.a.instance.Sa("Common.IZoomManager"),Ka.a.instance.resolve("Box4.ICoauthCashTelemetry"),Ma.a.Ap(Ka.a.instance.Sa("Common.ISystemInitiatedFeedbackWithTimeLapse")),n.AFrameworkApplication.K,Da.resolve("Common.IPeopleInfoProvider"))).singleInstance();Da.ha("Common.App.Presence.AwayManager",()=>new Jf(Ka.a.instance.resolve("Common.IPresenceUser"),
Ka.a.instance.resolve("WordEditor.Presence.WordRtcProxyProvider").mOc(),hd.o7l(),Ka.a.instance.resolve("Common.IPresenceConverter"),gc.a.instance,n.AFrameworkApplication.K.$("AwayStatusOneMinuteTimeoutIsEnabled")?6E4:n.AFrameworkApplication.K.mc("AwayCoauthorThresholdMs",9E5),Object(e.a)(n.AFrameworkApplication.va,n.AFrameworkApplication.va.processAction,"processAction"),Fa.App.ya.notificationBar,n.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"))).singleInstance();Da.ha("WordEditor.Presence.WordPresenceStatusProvider",
()=>new lg(Ma.a.Ap(Ka.a.instance.Sa("Common.ICurrentPageCalculator")))).as("Common.IPresenceStatusProvider").singleInstance();Da.ha("Common.App.Presence.PeopleInfoProvider",()=>new bc(Da.resolve("WordEditor.Presence.WordRtcProxyProvider").mOc(),Fa.App.Gna().CWR(()=>Fa.App.Gna().result.XB),Da.resolve("Common.App.People.IPeopleColorUtils"),Da.resolve("Common.IPresenceConverter"),Ma.a.Ap(Da.Sa("Common.App.Presence.AwayManager")))).as("Common.IPeopleInfoProvider").singleInstance();Da.ha("Box4.Presence.WordPresenceDataManager",
()=>new Pm(Fa.App.ya.gb.Uc.od)).as("Box4.IPresenceDataManager").singleInstance()}rWf(Da,jb){Fa.App.ya&&Fa.App.ya.jD&&(pf.lqd=null,pf.IFe=1===jb.vlb)}static get zYi(){if(!pf.lqd&&Fa.App.ya&&Fa.App.ya.jD){const Da=Om.App.Ln.jD;pf.lqd=pf.IFe&&pf.r0g?Da.getElementsByClassName("PaginatedContentContainerDisplayWrapper")[0]:Da.getElementsByClassName("OutlineContainerDisplayWrapper")[0]}return pf.lqd}static tdl(){const Da=n.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"),jb=n.AFrameworkApplication.K.$("PresenceIgnoreEventOnExpandedTooltip"),
ic=n.AFrameworkApplication.K.$("PresenceIpWidthAdjustForFlyout"),Lc=new Vc;Lc.add(vc.multipleBrowsersImageClassName,ve.getImageClassWithCluster(n.AFrameworkApplication.Dba,"MoreUsersGlyph16"));Lc.add(vc.multipleBrowserImageClusterPath,n.AFrameworkApplication.Rs);Lc.add(vc.peopleImageClassName,ve.getImageClassWithCluster(n.AFrameworkApplication.Dba,Da?"DoughboyWhiteGlyph_20x20x32":"SingleCollabUserGlyph16"));Lc.add(vc.peopleImageClusterPath,n.AFrameworkApplication.Rs);Lc.add(vc.zIndex,1);Lc.add(vc.rtl,
n.AFrameworkApplication.isRtl);Lc.add(vc.viewportBoundsCallback,pf.ahm);Lc.add(vc.ignoreEventOnExpandedTooltip,jb);Lc.add(vc.ipWidthAdjustForFlyout,ic);return Da?new dh(Lc):new bm(Lc)}static ahm(){return pf.zYi?wb.a.getElementBounds(pf.zYi):null}}pf.IFe=!0;pf.r0g=n.AFrameworkApplication.K.$("FlippedFlyoutForPaginationViewIsEnabled");pf.lqd=null;Object(m.a)(pf,"WordPresencePackage",null,[1,2]);var sj=c(1036),Nn=c(1389),Sg=c(1042),Rf=c(177);class $k{constructor(Da,jb){this.YYe=Da;this.paragraphId=jb}get opType(){return 2}get operation(){return this.YYe}}
Object(m.a)($k,"RttAppliedAddParagraphOp",null,[710]);class gi{constructor(Da,jb){this.L1n=Da;this.paragraphId=jb}get opType(){return 6}get operation(){return this.L1n}}Object(m.a)(gi,"RttAppliedReplaceSymbolRangeOp",null,[710]);class ym{constructor(Da,jb){this.P1n=Da;this.paragraphId=jb}get opType(){return 1}get operation(){return this.P1n}}Object(m.a)(ym,"RttAppliedReplaceTextRangeOp",null,[710]);class jn{constructor(Da,jb,ic){this.Ctj=Da;this.aje=jb;this.oIc=ic}get opType(){return 4}get operation(){return this.Ctj}get ook(){return this.Ctj.D3b()?
this.oIc:this.aje}}Object(m.a)(jn,"RttAppliedSplitParagraphOp",null,[710]);class ii{constructor(){this.X8a=new Rb.a}FHf(Da){return Da.toString()}iDc(Da,jb){Da=this.FHf(Da);this.X8a.nb(Da)||this.X8a.Z(Da,new R.a);this.X8a.J(Da).add(jb)}TUf(Da){switch(Da.opType){case 1:var jb=Object(z.a)(ym,Da);this.iDc(jb.paragraphId,Da);break;case 6:jb=Object(z.a)(gi,Da);this.iDc(jb.paragraphId,Da);break;case 4:jb=Object(z.a)(jn,Da);this.iDc(jb.aje,Da);this.iDc(jb.oIc,Da);break;case 2:jb=Object(z.a)($k,Da),this.iDc(jb.paragraphId,
Da)}}Pmn(Da){return this.Slb(Da)}Slb(Da){Da=this.FHf(Da);if(!this.X8a.nb(Da))return new R.a;const jb=this.X8a.J(Da);this.X8a.remove(Da);for(const ic of jb)ic.operation&&(ic.operation.i7=null);return jb}e4l(Da){let jb;return({value:jb}=this.X8a.Dc(this.FHf(Da),jb)).returnValue?jb:new R.a}MJl(Da){for(const jb of this.X8a.values){if(!jb.count)continue;if(2!==jb.J(0).opType)continue;const ic=jb.J(0);if(ic.YYe.FQf===Da)return ic}return null}}Object(m.a)(ii,"RttAppliedOpTracker",null,[690]);var Hh=c(244),
qk;(function(Da){Da[Da.Ywl=0]="expired";Da[Da.Acp=1]="dried"})(qk||(qk={}));Object(m.b)("RemoveChangeReason",qk);class Vf{constructor(){this.sza=new Hh.a}aqk(Da){if(!Da)return l.ULS.sendTraceTag(7685333,355,15,"Cannot add a null change to RTTStore"),!1;const jb=Da.Lc,ic=Da.qj;this.sza.nb(jb)||this.sza.add(jb,new Hh.a);this.sza.J(jb).Z(ic,Da);return this.zfl(jb,ic)?(l.ULS.sendTraceTag(7619921,355,15,"Detected an infinite loop in paragraph {0}, dropping the last packet!",jb),this.sza.J(jb).remove(ic),
!1):!0}Rrf(Da,jb){if(!this.sza.nb(Da))return null;Da=this.sza.J(Da);return Da.nb(jb)?Da.J(jb):null}JQd(Da){const jb=new R.a;for(const ic of this.sza.keys){const Lc=this.sza.J(ic);for(const ad of Lc.keys){const ce=Lc.J(ad);Da(ce)&&jb.add(ce)}}return jb}d$i(Da,jb){let ic=null;({value:ic}=this.sza.Dc(Da.Lc,ic)).returnValue?(Da.activity.USf(qk[jb]),ic.remove(Da.qj),ic.count||this.sza.remove(Da.Lc)):l.ULS.sendTraceTag(50938848,355,15,"Cannot remove an op that not exist in _changes. WordId: {0}; Reason: {1}",
Da.Lc,jb)}S4f(Da){this.d$i(Da,1)}V4f(Da){this.d$i(Da,0)}zfl(Da,jb){if(!this.sza.nb(Da))return!1;Da=this.sza.J(Da);if(!Da.nb(jb))return!1;for(var ic=Da.J(jb);ic;){ic=ic.d1;if(ic===jb)return!0;if(!Da.nb(ic))break;ic=Da.J(ic)}return!1}}Object(m.a)(Vf,"RttDataStore",null,[688,689]);var Sj=c(281),fe=c(103),cj=c(274),im=c(15);class vg{constructor(Da,jb){this.F6d=(ic,Lc)=>{4===this.nq.opType?l.ULS.shipAssertTag(9204866,355,12===Lc.node.type||11===Lc.node.type,"Unexpected graph modification detected during RTT edit"):
l.ULS.shipAssertTag(9204867,355,!1,"Unexpected graph modification detected during RTT edit")};this.Slb=()=>{l.ULS.shipAssertTag(9204868,355,!1,"Unexpected graph modification detected during RTT edit")};this.KTi=()=>{l.ULS.shipAssertTag(9204869,355,!1,"Unexpected graph modification detected during RTT edit")};this.nq=Da;if(this.lq=jb)Da=this.lq.Ze(12),Da.Ot(this.F6d),Da.Kw(this.Slb),Da.Fo(this.KTi)}dispose(){if(this.lq){const Da=this.lq.Ze(12);Da.PU(this.F6d);Da.yia(this.Slb);Da.QU(this.KTi)}}}Object(m.a)(vg,
"GraphChangeValidator",null,[9]);class Wf{constructor(Da,jb,ic,Lc){this.id=Da;this.cpBegin=jb;this.cpEnd=ic;this.zTk=Lc}PZo(Da){var jb=this.id===Da.id;jb&&(jb=this.zTk.replace("\u00a0"," "),Da=Da.characterData.substr(this.cpBegin,this.cpEnd-this.cpBegin).replace("\u00a0"," "),jb=jb===Da);return jb}}Object(m.a)(Wf,"RttOpValidator",null,[773]);class $g{constructor(Da,jb){this.i7=this.a8a=this.activity=null;this.opType=Da;this.metadata=jb}Duf(){return""}serialize(){return null}}Object(m.a)($g,"RttOp",
null,[702]);class Ti extends $g{constructor(Da,jb,ic,Lc,ad,ce,fc,kf,Tc){super(Tc,kf);this.Lc=Da;this.qj=jb;this.sR=ic;this.y4=Lc;this.d1=ad;this.Apb=ce;this.AH=fc}tMh(){return this.sR.isEqual(this.y4,!0)?new Se.a(0,this.Lc,this.qj,this.sR,void 0,void 0,void 0,this.AH):new Se.a(1,this.Lc,this.qj,this.sR,this.Lc,this.qj,this.y4,this.AH)}static ZAj(Da){let jb,ic;var Lc=Da.fT;if(1===Lc.bce&&(Lc.JRa!==Lc.BGa||Lc.j7a!==Lc.Ykc))return l.ULS.sendTraceTag(8914769,355,15,"We received a ReplaceRange operation spanning multiple paragraphs"),
ic=jb=null,Da=Lc=-1,{returnValue:!1,sR:ic,y4:jb,Lc:Da,qj:Lc};if(Lc.AH)return ic=jb=null,Da=Lc=-1,{returnValue:!1,sR:ic,y4:jb,Lc:Da,qj:Lc};jb=ic=Lc.sR;1===Lc.bce&&(jb=Lc.y4);Da=Lc.JRa;Lc=Lc.j7a;return{returnValue:!0,sR:ic,y4:jb,Lc:Da,qj:Lc}}}Object(m.a)(Ti,"RttReplaceRangeOp",$g,[]);var Rm=c(1387),Rd=c(382),Mo=c(582);class Bd extends Mo.a{constructor(){super();this.RttStatusRecords=this.FileId=null}$k(){return 110}static Paa(Da,jb){const ic=new Bd;ic.FileId=Da;ic.RttStatusRecords=jb;return ic}}Object(m.a)(Bd,
"RttStatusRequest",Mo.a,[]);class ll{}Object(m.a)(ll,"RttStatusOp",null,[]);class $f{constructor(){this.contentState=this.contentType=this.timeToRender=this.strictlySequentialId=this.packetVersion=this.clientType=this.clientId=this.packetId=null}}Object(m.a)($f,"WireRttStatusOpRecord",null,[]);class mg extends Rd.a{constructor(){super();const {App:Da}=c(157);this.tYb=new R.a;this.kQe=new R.a;this.ek=new Rm.a(n.AFrameworkApplication.K.mc("WordEditorRttStatusReplicatorIntervalMs",6E4));this.enabled=
1;Da.e1.register(this)}UQj(){const Da=Date.now();for(const jb of this.tYb)jb.GKb&&1===jb.GKb&&(jb.GKb=2,jb.timeToRender=Da-jb.metadata.ajg)}xpe(Da){const jb=new ll;jb.metadata=Da.operation.metadata;jb.opType=Da.opType;jb.GKb=1;this.tYb.add(jb)}get Kha(){return"RttStatusReplicator"}S3(){return this.ee&&2===this.ee.status?!0:1===this.enabled&&this.ek.FX()?this.MC():!1}MC(){for(const Da of this.tYb)if(Da.GKb&&2===Da.GKb)return!0;return!1}uSa(){if(1===this._state){this._state=3;const jb=this.tYb.toArray().filter(ic=>
2===ic.GKb);var Da=this.B8k(jb);Da=Bd.Paa(n.AFrameworkApplication.rootQuerySignature,Da);jb.forEach(ic=>this.tYb.remove(ic));jb.forEach(ic=>this.kQe.add(ic));this.ee.Cq=Da;this.ee.GG="RttStatusRequest";this.ee.status=1}else 3===this._state&&this.ee&&2===this.ee.status&&(this.ek.q1(),2!==this.ee.statusCode&&this.tYb.PC(0,this.kQe),this.kQe.clear(),this._state=1)}B8k(Da){const jb=[];Da.forEach(ic=>{const Lc=new $f;Lc.clientId=ic.metadata.clientId;Lc.clientType=ic.metadata.clientType;Lc.packetId=ic.metadata.packetId;
Lc.packetVersion=ic.metadata.packetVersion;Lc.strictlySequentialId=ic.metadata.strictlySequentialId;Lc.contentType=ic.opType;Lc.contentState=ic.GKb;Lc.timeToRender=ic.timeToRender;jb.push(Lc)});return jb}njc(){return!0}cF(){}forceOutbound(){}}Object(m.a)(mg,"RttStatusReplicator",Rd.a,[]);class Za{constructor(Da,jb,ic,Lc,ad,ce){this.packetId=Da;this.clientId=jb;this.clientType=ic;this.ajg=Lc;this.packetVersion=ad;this.strictlySequentialId=ce}static create(Da){let jb=null;null!=Da.strictlySequentialId&&
(jb=Da.strictlySequentialId);return new Za(Da.packetId,Da.clientId,Da.client,Date.now(),Da.version,jb)}}Object(m.a)(Za,"RttOpMetadata",null,[]);class Hb extends $g{constructor(Da,jb,ic,Lc,ad,ce,fc,kf,Tc){super(4,Tc);this.d1=0;this.Lc=Da;this.qj=jb;this.offset=ic;this.AH=Lc;this.fpg=ad;this.Hig=ce;this.Yoe=fc;this.Iig=kf;this.fpg===this.Lc?this.d1=this.Hig:this.Yoe===this.Lc?this.d1=this.Iig:(l.ULS.sendTraceTag(8397766,355,10,"Bad data passed to RttSplitParagraphOp"),this.d1=0)}D3b(){return this.Lc===
this.Yoe}get qGo(){return this.d1}get p2o(){return this.D3b()?this.fpg:this.Yoe}get zxj(){return this.D3b()?this.Hig:this.Iig}serialize(){const Da=new Se.a(3,this.Lc,this.qj,this.offset,null,null,null,this.AH),jb=new Pc(this.fpg,this.Hig,this.Yoe,this.Iig);return new Ac(this.metadata.packetId,this.metadata.clientId,1,4,Da,null,void 0,void 0,void 0,void 0,jb,void 0,void 0,this.metadata.strictlySequentialId)}static create(Da){const jb=Da.fT,ic=Da.aPb;return new Hb(jb.JRa,jb.j7a,jb.sR,jb.AH,ic.CXf,ic.Gig,
ic.DXf,ic.Jig,Za.create(Da))}static i$l(Da,jb,ic){if(1!==Da.type)return null;const Lc=ic.LRa(Da.z4.characterData,Da.z4.pa);return new Hb(Da.z4.Lc,Da.z4.qj,ic.cnc(Lc,Da.otj),Da.AH,Da.Iyb.Lc,Da.Iyb.qj,Da.IEc.Lc,Da.IEc.qj,jb)}}Object(m.a)(Hb,"RttSplitParagraphOp",$g,[676,702]);class $b{constructor(Da,jb,ic,Lc){this.Rin=()=>{this.Zwb.UQj()};this.Sja=Da;this.Cxc=jb;this.vka=ic;this.Rxb=Lc;null!=n.AFrameworkApplication.K&&n.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.WordEditorRttStatusReplicatorIsEnabled",
!1)&&(this.Zwb=new mg,Sj.GraphTransactionManager.instance.jph(this.Rin))}VDk(Da,jb,ic,Lc=null){if(jb.isDirty)return Lc&&Lc.properties.Z($b.OZi,"1"),!1;const ad=new vg(Da,jb.hj);try{if(1===Da.opType||6===Da.opType){const kf=Object(z.a)(Ti,Da),Tc=this.u4k(kf,jb);var ce=Tc.node.characterData;const Mg=10<=Tc.cpBegin?Tc.cpBegin-10:0;let yf=Tc.cpEnd+10<=ce.length?Tc.cpEnd+10:ce.length;const ng=ce.substr(Mg,Tc.cpBegin-Mg),ji=ce.substr(Tc.cpEnd,yf-Tc.cpEnd);yf=yf+kf.Apb.length-(Tc.cpEnd-Tc.cpBegin);var fc=
new Wf(Tc.node.id,Mg,yf,ng+kf.Apb+ji);const kj=6===kf.opType;ce="";kj&&(ce=kf.font);if(!this.w1n(Tc,kf.Apb,kj,ce,Lc))return!1;let fl;fl=1===Da.opType?new ym(kf,jb.id):new gi(kf,jb.id);jb.Mma=Da.d1;kf.a8a=fc;Da.i7=fl;ic.TUf(fl);null!=this.Zwb&&this.Zwb.xpe(fl)}else return 4===Da.opType?this.UDk(Da,jb,ic):!1}finally{ad&&ad.dispose()}return!0}UDk(Da,jb,ic){const Lc=Object(z.a)(Hb,Da);var ad=this.Rxb.LRa(jb.characterData,jb.pa);ad=this.Rxb.XAb(ad,Lc.offset);if(!this.tAi(cb.a.createTextRange(jb,0,Bb.ParagraphReader.textLength(jb))))return!1;
var ce=wd.GraphIterator.$a(jb);ce.zb(10);if(this.Yac(ce))return!1;let fc;ce=this.vka.Mc(3);try{ce.Cb(jb);const kf=jb.MY();try{const Tc=wd.GraphIterator.$a(jb);Tc.zb(10);Tc.hd(11);let Mg=Tc.currentNode;Lc.D3b()&&(Tc.bDf?Mg=null:(Tc.hJ(),Mg=Tc.currentNode));Tc.uc();const yf=this.Cxc.gfb();Tc.HH(yf,Mg,89);Tc.Gi(yf);fc=jb.clone();const ng=fc.MY();try{fc.setValue(td.a.Lc,Lc.p2o);fc.setValue(td.a.qj,Lc.zxj);fc.isDirty=!1;Tc.Hf(fc,2);Tc.Gi(fc);this.m6k(jb,fc);const ji=Lc.D3b()?fc:jb,kj=Lc.D3b()?jb:fc;ji.eO=
!0;kj.eO=!0;this.Sja.D6f(this.k_a(ji,ad,Bb.ParagraphReader.textLength(ji)),"",!1,"");this.Sja.D6f(this.k_a(kj,0,ad),"",!1,"");jb.Mma=Lc.qGo;fc.Mma=Lc.zxj}finally{ng&&ng.dispose()}}finally{kf&&kf.dispose()}ce.QSa()}finally{ce&&ce.dispose()}jb=new jn(Lc,jb.id,fc.id);Da.i7=jb;ic.TUf(jb);null!=this.Zwb&&this.Zwb.xpe(jb);return!0}Yac(Da){const jb=new wd.GraphIterator;jb.Yc(Da);jb.hd(11);return fe.ListItemReader.sh(jb)?(l.ULS.sendTraceTag(16868566,355,50,"Blocked RTT para operation: in a list"),!0):!1}zBl(Da,
jb,ic){var Lc=jb.Ihb(Da.Lc);if(Lc.equals(Ue.a.nil))return null;Lc=ic.Db(Lc);if(!Lc||!Bb.ParagraphReader.Wb(Lc)||!Lc.isConnected)return null;const ad=wd.GraphIterator.$a(Lc);if(!ad.zb(23))return null;if(Da.epg){Da=jb.Ihb(Da.epg);if(Da.equals(Ue.a.nil))return null;ic=ic.Db(Da);if(!ic||!Bb.ParagraphReader.Wb(ic)||!ic.isConnected)return null;ic=wd.GraphIterator.$a(ic);if(!ic.zb(23))return null;ic.hd(11);ic.hJ();ic.Qd();if(ic.currentNode!==Lc)return null}return this.Yac(ad)?null:ad}BLo(Da,jb,ic,Lc){const ad=
jb.currentNode,ce=this.vka.Mc(3);try{ce.Cb(ad);jb.hd(11);const fc=jb.currentNode;jb.uc();const kf=this.Cxc.gfb();jb.HH(kf,fc,89);jb.Gi(kf);const Tc=cj.a.instance.createInstance(393230),Mg=Tc.MY();try{Tc.setValue(im.a.mo,""),Tc.rFa=!0,Lc.EMb(Tc),Lc=[0],Tc.setValue(td.a.iq,Lc),Tc.setValue(td.a.Vs,Lc),Tc.rFa=!1,Tc.setValue(td.a.Lc,Da.FQf),Tc.setValue(td.a.qj,Da.EQf),Tc.isDirty=!1,jb.Hf(Tc,2),Tc.eO=!0,Tc.Mma=Da.EQf}finally{Mg&&Mg.dispose()}ce.QSa();Da.i7=new $k(Da,Tc.id);ic.TUf(Da.i7);null!=this.Zwb&&
this.Zwb.xpe(Da.i7)}finally{ce&&ce.dispose()}return!0}k_a(Da,jb,ic){return jb===ic?cb.a.Rc(Da,jb):cb.a.createTextRange(Da,jb,ic)}w1n(Da,jb,ic,Lc,ad=null){const ce=Da.node;if(Da.cpBegin!==Da.cpEnd&&!this.tAi(Da))return ad&&ad.properties.Z($b.YCj,"1"),!1;ad=this.vka.Mc(3);try{ad.Cb(ce);const fc=ce.MY();try{ce.eO=!0,this.Sja.D6f(Da,jb,ic,Lc)}finally{fc&&fc.dispose()}ad.QSa()}finally{ad&&ad.dispose()}return!0}m6k(Da,jb){jb.rFa=!0;jb.dqa(Da.characterData);jb.Mma=Da.Mma;jb.pa.clear();for(var ic=0;ic<Da.pa.length;ic++){const Lc=
Da.pa.J(ic).ema(jb);jb.pa.add(Lc)}jb.Xl();if(jb.ze.length)for(Da=0;Da<jb.pa.length;Da++){if((ic=jb.pa.J(Da).formatting)&&-1!==ic.re)for(;jb.ze.length<=ic.re;)jb.ze.PX(jb.ze.length-1,256)}else l.ULS.sendTraceTag(9204881,355,15,"Cannot update WordRunProperties after splitting paragraph");jb.rFa=!1}fHf(Da){Da=wd.GraphIterator.$a(Da);Da.zb(23);Da.uc();return{returnValue:89===Da.role,iterator:Da}}D5f(Da){const jb=new wd.GraphIterator;jb.Yc(Da);jb.uc();const ic=this.vka.Mc(3);try{ic.Cb(jb.currentNode),
Da.wg()}finally{ic&&ic.dispose()}}$Wn(Da){if(Da.anchor)if(({iterator:jb}=this.fHf(Da)).returnValue)this.D5f(jb);else{var jb=Da.Kc.jm;var ic=this.vka.Mc(3);try{ic.Cb(Da),Da.load(jb.Db(Da.id)),Da.anchor.QX(4)}finally{ic&&ic.dispose()}}}a8f(Da,jb,ic){for(let ce=jb.count-1;0<=ce;ce--){var Lc=jb.J(ce);switch(Lc.opType){case 4:Lc=Object(z.a)(jn,Lc);if(!Da.id.equals(Lc.aje)){l.ULS.shipAssertTag(9204885,355,Da.id.equals(Lc.oIc));continue}Lc=ic.Db(Lc.oIc);if(!Lc)break;if(!Lc||!Bb.ParagraphReader.Wb(Lc)){l.ULS.shipAssertTag(9204886,
355,!1);break}if(!Lc.isConnected)continue;var ad=({iterator:Lc}=this.fHf(Lc)).returnValue;l.ULS.shipAssertTag(9204887,355,ad);ad&&this.D5f(Lc);break;case 2:(Lc=Object(z.a)($k,Lc),Da.id.equals(Lc.paragraphId))?Da.isConnected&&(ad=({iterator:Lc}=this.fHf(Da)).returnValue,l.ULS.shipAssertTag(16820002,355,ad),ad&&this.D5f(Lc)):l.ULS.shipAssertTag(16820001,355,!1)}}}u4k(Da,jb){const ic=this.Rxb.LRa(jb.characterData,jb.pa),Lc=this.Rxb.XAb(ic,Da.sR);Da=this.Rxb.XAb(ic,Da.y4);return Lc===Da?cb.a.Rc(jb,Lc):
cb.a.createTextRange(jb,Lc,Da)}tAi(Da){const jb=Da.node.pa,ic=Da.cpBegin;Da=Da.cpEnd;for(let Lc=0;Lc<jb.length;Lc++){const ad=jb.J(Lc);if(ad.cp>=Da)break;if(ad.cp>=ic){if(ad.tf)return l.ULS.sendTraceTag(8242647,355,15,"Rejected unsafe wet change: range contains comment"),!1;if(ad.blob)return l.ULS.sendTraceTag(8242648,355,15,"Rejected unsafe wet change: range contains blob"),!1;if(ad.$c||ad.ckb||ad.dac)return l.ULS.sendTraceTag(8242649,355,15,"Rejected unsafe wet change: range contains field"),!1}}return!0}}
$b.OZi="ParagraphAlreadyDirty";$b.YCj="UnsafeWetChange";Object(m.a)($b,"RttEditor",null,[687]);var zc=c(20),Jc=c(1434),pd=c(248);class Qd{constructor(){this.Fdd=new R.a}add(Da){this.Fdd.add(Da);return!0}JQd(Da){const jb=new R.a;for(const ic of this.Fdd)Da(ic)&&jb.add(ic);return jb}S4f(Da){Da.activity.USf("dried");this.Fdd.remove(Da)}V4f(Da){Da.activity.USf("expired");this.Fdd.remove(Da)}}Object(m.a)(Qd,"RttAddParagraphDataStore",null,[]);class ye extends $g{constructor(Da,jb,ic,Lc,ad,ce,fc,kf){super(2,
kf);this.Lc=Da;this.qj=jb;this.d1=ic;this.epg=Lc;this.FQf=ad;this.EQf=ce;this.AH=fc}serialize(){const Da=new Se.a(2,this.Lc,this.qj,null,this.epg,null,null,this.AH),jb=new Yb(this.d1,this.FQf,this.EQf);return new Ac(this.metadata.packetId,this.metadata.clientId,1,3,Da,null,void 0,void 0,jb,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Da){const jb=Da.fT,ic=Da.$_b;let Lc=null;null!=Da.fT.BGa&&(Lc=Da.fT.BGa);return new ye(jb.JRa,jb.j7a,ic.Kig,Lc,ic.FXf,ic.d1,jb.AH,Za.create(Da))}static e$l(Da,
jb){return 3!==Da.type?null:new ye(Da.cpa.Lc,Da.cpa.qj,Da.ten.qj,Da.rRa?Da.rRa.Lc:null,Da.hxa.Lc,Da.hxa.qj,Da.AH,jb)}}Object(m.a)(ye,"RttAddParagraphOp",$g,[]);class Le{constructor(Da){this.pV=Da}P6i(){this.pV&&this.pV.properties.Z(Le.cYh,"1")}FOn(Da){this.pV&&(this.pV.properties.nb(Le.XNf)||this.pV.properties.Z(Le.XNf,(Da-this.pV.startTime).toString()))}USf(Da){this.pV&&(this.pV.properties.Z(Le.xaj,Da),this.pV.end())}eQn(Da){this.pV&&this.pV.properties.Z(Le.QYi,Da.toString())}dQn(Da){this.pV&&this.pV.properties.Z(Le.kYi,
Da)}static ozf(Da){Da.Y4(tf.a.oNb,Le.cYh,Jc.a.Jvj);Da.Y4(tf.a.oNb,Le.oyl,Jc.a.Jvj);Da.Y4(tf.a.oNb,Le.XNf,Jc.a.KHk);Da.Y4(tf.a.oNb,Le.xaj,Jc.a.qua);Da.Y4(tf.a.oNb,Le.QYi,Jc.a.qua);Da.Y4(tf.a.oNb,Le.kYi,Jc.a.qua)}static create(Da){if(!Da)return null;Da=Da.zp(tf.a.oNb,Le.h1o);return new Le(Da)}}Le.cYh="FailedToFindInitialParaID";Le.oyl="FailedToFindInitialTextID";Le.XNf="MsecUntilApplied";Le.xaj="RemovedBecause";Le.QYi="PacketVersions";Le.kYi="OperationType";Le.h1o=48E4;Object(m.a)(Le,"RttOpActivity",
null,[]);var Af;(function(Da){Da[Da.unknown=0]="unknown";Da[Da.ejp=1]="replaceTextRangeOp";Da[Da.Z$o=2]="addParagraphOp";Da[Da.$bp=3]="deleteParagraphOp";Da[Da.dlp=4]="splitParagraphOp";Da[Da.Mgp=5]="mergeParagraphOp";Da[Da.djp=6]="replaceSymbolRangeOp"})(Af||(Af={}));Object(m.b)("RttOpType",Af);var dc=c(124);class of extends Ti{constructor(Da,jb,ic,Lc,ad,ce,fc,kf,Tc,Mg,yf){super(Lc,ad,ce,fc,kf,Tc,Mg,yf,6);this.font=Da;this.legacy=jb}Duf(){return"OffsetStart: "+this.sR+"OffsetEnd: "+this.y4}serialize(){const Da=
this.tMh();return new Ac(this.metadata.packetId,this.metadata.clientId,1,7,Da,null,this.d1,this.Apb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Da){let jb,ic,Lc,ad;if(!({sR:jb,y4:ic,Lc,qj:ad}=Ti.ZAj(Da)).returnValue)return null;let ce,fc;if(1===Da.text.length)ce=!1,fc=dc.AParagraphNode.yC;else if(2===Da.text.length)if(nb.a.Wwi(Da.text,0)&&nb.a.mz(Da.text,1))ce=!0,fc=Da.text;else return l.ULS.sendTraceTag(8914772,355,15,"RTT symbol packet has text length 2 but is not a valid surrogate pair",
Da.zt),null;else return l.ULS.sendTraceTag(8914773,355,15,"RTT symbol packet text is of unsupported length (length must be 1 or 2)",Da.zt),null;const kf=Da.y9c,Tc=Za.create(Da);return new of(kf.jhg,kf.khg,ce,Lc,ad,jb,ic,Da.IPb,fc,Da.fT.AH,Tc)}}Object(m.a)(of,"RttReplaceSymbolRangeOp",Ti,[676,702]);class Mj extends Ti{constructor(Da,jb,ic,Lc,ad,ce,fc,kf){super(Da,jb,ic,Lc,ad,ce,fc,kf,1)}Duf(){return"OffsetStart: "+this.sR+"OffsetEnd: "+this.y4+"TextAddedLength: "+this.Apb.length}serialize(){const Da=
this.tMh();return new Ac(this.metadata.packetId,this.metadata.clientId,1,2,Da,null,this.d1,this.Apb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Da){let jb,ic,Lc,ad;if(!({sR:jb,y4:ic,Lc,qj:ad}=Ti.ZAj(Da)).returnValue)return null;let ce="";Da.text&&(ce=Da.text);const fc=Za.create(Da);return new Mj(Lc,ad,jb,ic,Da.IPb,ce,Da.fT.AH,fc)}static g9l(Da,jb,ic){if(Da.type)return null;const Lc=ic.LRa(Da.z4.characterData,Da.z4.pa);return new Mj(Da.z4.Lc,Da.z4.qj,ic.cnc(Lc,
Da.cpBegin),ic.cnc(Lc,Da.cpEnd),Da.hxa.qj,Da.U8,Da.AH,jb)}}Object(m.a)(Mj,"RttReplaceTextRangeOp",Ti,[676,702]);class bi{constructor(Da,jb,ic,Lc,ad,ce,fc,kf,Tc,Mg,yf,ng,ji,kj,fl,dj,yk,kn,Ei){this.Fl=null;this.eGe=this.Zkh=!1;this.Ehd=!0;this.d8g=0;this.Beh=this.eRe=this.Deh=this.Aeh=this.Ceh=!1;this.CVf=()=>{l.ULS.sendTraceTag(7685328,355,50,"All prerequisite ready for RttManager");this.Fl=this.GZ.result;l.ULS.sendTraceTag(7685330,355,50,"Subscribing to presence updates");this.Fl.b3(this.w0)};this.w0=
(al,ph)=>{if(3===ph.type||10===ph.type)if(10===ph.type)this.d8g="boolean"===typeof ph.tL?ph.tL?1:0:ph.tL;else if(this.KWb.value&&!this.KWb.value.JUd)l.ULS.sendTraceTag(8454939,355,15,"RTT channel did not get disconnected on lock release");else if(ph.tL){if(this.rQn(),(al=this.vjl(ph.tL))&&1!==al.metadata.clientType){this.qQn();if(!(!this.Ro||this.Ro.Xba||zc.a.SPa||zc.a.Wba||(n.AFrameworkApplication.ue("1i00j689;ba0dg262"),zc.a.SPa||zc.a.Wba)))return;if(2!==this.d8g)switch(this.Ehd&&(this.sYb.X6i(),
this.Ehd=!1),this.Zkh||this.lwm(),al.opType){case 1:case 6:case 4:if(!({zg:al}=this.bqk(al)).returnValue)break;this.oih?this.igj(al):this.dCj(al);break;case 2:this.loc.add(al),this.Spi(al),this.oih?this.igj(Ue.a.nil):this.cCj(al)}}}else l.ULS.sendTraceTag(7685331,355,15,"RTT packet was empty")};this.Xwl=()=>{const al=this.ni.value;if(al){var ph=this.pD()-bi.lXn,qf=this.msb.JQd(Ph=>Ph.metadata.ajg<ph);0<qf.count&&this.GOn();var lj=new pd.a;for(const Ph of qf)if(this.msb.V4f(Ph),Ph.i7)switch(Ph.i7.opType){case 1:lj.add(Ph.i7.paragraphId.toString());
break;case 6:lj.add(Ph.i7.paragraphId.toString());break;case 4:lj.add(Ph.i7.aje.toString()),lj.add(Ph.i7.oIc.toString())}qf=this.loc.JQd(Ph=>Ph.metadata.ajg<ph);for(const Ph of qf)this.loc.V4f(Ph),Ph.i7&&lj.add(Ph.i7.paragraphId.toString());for(const Ph of lj)(lj=al.Db(Ue.a.If(Ph)))?lj.eO?(this.Ywb.$Wn(lj),lj.eO||this.pwc.value.M$i(lj)):l.ULS.sendTraceTag(8765829,355,15,"Expiring wet change from paragraph with no applied changes"):l.ULS.sendTraceTag(8765828,355,15,"Expiring wet change with invalid object ID")}else this.ni.rxf&&
l.ULS.sendTraceTag(7685332,355,10,"Failed to find the IObjectSpace! Wet changes will never expire")};this.Ywb=Da;this.msb=jb;this.pwc=ic;this.KWb=Lc;this.zI=ad;this.GZ=ce;this.ni=fc;this.Hb=kf;this.pD=Tc;this.Rxb=Mg;this.qd=yf;this.MNe=ji;this.Hc=kj;this.oih=fl;this.sYb=dj;this.lrb=yk;this.oXe=kn;this.tyc=new K.a(J.a.ei());this.loc=new Qd;ng.execute(bi.ozf);this.Ro=Ei}lwm(){const Da=new ha.a(3,2,bi.lZn,this.Xwl);this.Hb.Vb(Da);this.Zkh=!0}init(){return this.GZ?this.GZ.continueWith(this.CVf):G.Task.J3(!1)}vjl(Da){Da=
xc(Da);if(!Da)return null;switch(Da.zt){case 2:return Mj.create(Da);case 7:return of.create(Da);case 4:return Hb.create(Da);case 3:return ye.create(Da);default:return l.ULS.sendTraceTag(8459668,355,50,"RTT packet is of unexpected operationType {0}",Da.zt),null}}bqk(Da){let jb=Ue.a.nil;if(!this.msb.aqk(Da))return{returnValue:!1,zg:jb};this.Spi(Da);if(!this.zI)return{returnValue:!1,zg:jb};const ic=this.zI.Ihb(Da.Lc);if(ic.equals(Ue.a.nil)||!this.ni.value.Db(ic))return Da.activity.P6i(),{returnValue:!1,
zg:jb};this.Z6i();return{returnValue:!0,zg:ic}}igj(Da){Da.equals(Ue.a.nil)||this.tyc.add(Da.toString());this.eGe||(Da=new ha.a(0,1,200,()=>{this.qNo();this.eGe=!1},71),this.Hb.Vb(Da),this.eGe=!0)}J9n(Da){Da=new ha.a(0,1,0,Da,71);this.Hb.Vb(Da)}Spi(Da){Da.activity=Le.create(this.qd);Da.activity.eQn(Da.metadata.packetVersion);Da.activity.dQn(Af[Da.opType])}qNo(){var Da=this.loc.JQd(ic=>!ic.i7);for(const ic of Da)this.cCj(ic);if(this.tyc.count){Da=null;for(var jb of this.tyc){jb=Ue.a.If(jb);Da=this.ni.value.Db(jb);
break}jb=this.Hc.Mc(3);try{jb.Cb(Da);for(const ic of this.tyc)this.dCj(Ue.a.If(ic))}finally{jb&&jb.dispose()}this.tyc.clear()}}dCj(Da){Da=this.ni.value.Db(Da);let jb;const ic=this.Hc.Mc(3);try{ic.Cb(Da);jb=this.qd.zp(tf.a.Cth);const Lc=this.Ith(Da,jb);jb.end();Lc&&this.Zsk(Lc)}finally{ic&&ic.dispose(),this.sYb.l3f(1),this.Ehd=!0}}cCj(Da){var jb=this.Ywb.zBl(Da,this.zI,this.ni.value);jb&&(this.Z6i(),this.Ywb.BLo(Da,jb,this.lrb,Ka.a.instance.resolve("Box4.IParagraphEditor"))&&(jb=this.ni.value.Db(Da.i7.paragraphId),
this.auh(jb,Da),this.sYb.l3f(1),this.Ehd=!0))}Zsk(Da){this.MNe.continueWith(()=>{if(1===Da.opType){var jb=this.k7l(Da);jb&&(this.MNe.result.XYe(jb),this.MNe.result.jde(!0))}})}k7l(Da){const jb=Da.serialize();if(2!==jb.zt||jb.fT.BGa&&jb.fT.JRa!==jb.fT.BGa)return null;const ic=Da.sR.clone();0<Da.Apb.length&&(ic.aEh(),ic.cp+=Da.Apb.length);jb.zt=0;jb.text=null;jb.fT.bce=0;jb.fT.sR=ic;jb.fT.j7a=jb.IPb;jb.fT.BGa=null;jb.fT.Ykc=null;jb.fT.y4=null;jb.IPb=null;return id.faf(jb,this.zI,this.Rxb,()=>this.ni.value,
this.oXe.instance)}auh(Da,jb){return this.pwc.value?this.pwc.value.Rok(Da,jb.metadata.clientId).returnValue?!0:(l.ULS.sendTraceTag(7866379,355,15,"Unable to apply a wet change lock"),!1):(l.ULS.shipAssertTag(7866378,355,!!this.pwc.value,"Unable to apply wet changes as LockManager unavailable"),!1)}Hth(Da,jb){this.Ith(Da,jb)}Ith(Da,jb){if(!Da)return null;if(!Da.anchor)return jb&&jb.properties.Z(bi.gQi,"1"),null;if(!Da.hasProperty(td.a.Lc))return l.ULS.sendTraceTag(7619922,355,15,"Paragraph is missing the WordId property"),
null;if(!Da.hasProperty(td.a.qj))return l.ULS.sendTraceTag(8197722,355,15,"Paragraph is missing the TextId property"),null;if(Da.hasProperty(td.a.CRh)&&Da.getValue(td.a.CRh))return l.ULS.sendTraceTag(16815506,355,50,"RTT edit disabled in paragraph"),null;const ic=Da.getValue(td.a.Lc);var Lc=Da.Mma;jb&&(jb.properties.Z(bi.pfn,Lc.toString()),jb.properties.Z(bi.rfn,ic.toString()));Lc=this.msb.Rrf(ic,Lc);if(!Lc)return jb&&jb.properties.Z(bi.TPi,"1"),null;if(!this.auh(Da,Lc))return jb&&jb.properties.Z(bi.tJh,
"1"),null;let ad=0,ce=null;for(;Lc;){if(!this.Ywb.VDk(Lc,Da,this.lrb,jb)){jb&&jb.properties.Z(bi.zJj,"1");break}ad++;Lc.activity.FOn(this.pD());ce=Lc;Lc=Da.Mma;Lc=this.msb.Rrf(ic,Lc)}0<ad&&this.t6i();jb&&jb.properties.add(bi.AJj,ad.toString());return ce}Qce(Da){if(Da.hasProperty(td.a.Lc)&&Da.hasProperty(td.a.qj)){var jb=Da.getValue(td.a.Lc),ic=Da.ia(td.a.qj,0),Lc=this.qd.zp(tf.a.Q8i),ad=this.lrb.Pmn(Da.id);0<ad.count&&(this.Ywb.a8f(Da,ad,this.ni.value),this.IXn(Da,ad,ic));var ce=this.lrb.MJl(jb);
if(ce&&!Da.id.equals(ce.paragraphId)){const fc=this.ni.value;this.J9n(()=>{const kf=this.lrb.Slb(ce.paragraphId),Tc=fc.Db(ce.paragraphId);l.ULS.shipAssertTag(16820032,355,!!Tc,"Could not find added graph node");Tc&&(this.Ywb.a8f(Tc,kf,fc),this.loc.S4f(ce.YYe))})}this.msb.Rrf(jb,ic)||this.pwc.value.M$i(Da);this.Hth(Da,Lc);Lc.end()}}IXn(Da,jb,ic){let Lc=!1;for(let ce=jb.count-1;0<=ce;ce--){var ad=jb.J(ce);switch(ad.opType){case 1:case 6:case 4:ad=Object(z.a)(676,ad.operation);break;default:continue}ad.d1===
ic&&(Lc=!0,ad.a8a&&!ad.a8a.PZo(Da)&&l.ULS.sendTraceTag(8765831,355,15,"Validating wet change location failed. Type {0} OffsetInfo {1} NodeId {2} ValidatorNodeId {3} ValidatorNodeCpBegin {4} ValidatorNodeCpEnd {5}",ad.opType,ad.Duf(),Da.id,ad.a8a.id,ad.a8a.cpBegin,ad.a8a.cpEnd));Lc&&this.msb.S4f(ad)}Lc&&this.t6i()}C_c(Da){const jb=this.lrb.Slb(Da.id);0<jb.count&&(2===jb.J(0).opType&&jb.removeAt(0),this.Ywb.a8f(Da,jb,this.ni.value))}xhe(Da){var jb=this.lrb.e4l(Da.id);for(const ic of jb)if(4===ic.opType&&
(jb=Object(z.a)(jn,ic),Da.id.equals(jb.ook)))return!0;return!1}rQn(){this.Ceh||(l.ULS.sendTraceTag(8704354,355,50,"Received a wet change"),this.Ceh=!0)}qQn(){this.Aeh||(l.ULS.sendTraceTag(8185606,355,50,"Received a wet change that we could deserialize"),this.Aeh=!0)}Z6i(){this.Deh||(l.ULS.sendTraceTag(17147533,355,50,"Received a usable wet change"),this.Deh=!0)}t6i(){this.eRe||(l.ULS.sendTraceTag(8185607,355,50,"Successfully applied a wet change"),this.eRe=!0)}GOn(){this.eRe||this.Beh||(l.ULS.sendTraceTag(8185608,
355,15,"Failed to apply any wet changes so far"),this.Beh=!0)}static ozf(Da){const jb=[tf.a.Cth,tf.a.Q8i];for(const ic of jb)Da.Y4(ic,bi.AJj,Jc.a.qua),Da.Y4(ic,bi.TPi,Jc.a.qua),Da.Y4(ic,bi.gQi,Jc.a.qua),Da.Y4(ic,bi.tJh,Jc.a.qua),Da.Y4(ic,bi.zJj,Jc.a.qua),Da.Y4(ic,$b.OZi,Jc.a.qua),Da.Y4(ic,$b.YCj,Jc.a.qua);Le.ozf(Da)}}bi.lZn=6E4;bi.lXn=18E4;bi.AJj="WetChangeCount";bi.TPi="NoChangesToApply";bi.gQi="NodeNotConnected";bi.tJh="CouldNotGetLock";bi.zJj="WetChangeBlocked";bi.rfn="NodeWordId";bi.pfn="NodeTextId";
Object(m.a)(bi,"RttManager",null,[677]);class rl{constructor(Da,jb){this.Sej=0;this.Qi=Da;this.H7n=jb}X6i(){this.Sej=this.Qi()}l3f(Da){const jb=this.Qi()-this.Sej;0<=jb&&this.H7n.track(Math.round(jb),0===Da?"CTB":"RTP")}}Object(m.a)(rl,"RttPerfCounter",null,[675]);var jj=c(1942);class be{constructor(){this.Yzc=new jj.a}Dtk(Da,jb){this.Yzc.back()&&jb&&this.Yzc.back().Ceb(Da)||this.Yzc.enqueue(Da)}I2l(){return this.Yzc.isEmpty?null:this.Yzc.dequeue()}}Object(m.a)(be,"RttSendDataStore",null,[674]);class fh extends $g{constructor(Da,
jb,ic,Lc){super(3,Lc);this.Lc=Da;this.qj=jb;this.AH=ic}get d1(){return 0}serialize(){const Da=new Se.a(4,this.Lc,this.qj,null,null,null,null,this.AH);return new Ac(this.metadata.packetId,this.metadata.clientId,1,5,Da,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Da){const jb=Da.fT;return new fh(jb.JRa,jb.j7a,jb.AH,Za.create(Da))}static f$l(Da,jb){return 4!==Da.type?null:new fh(Da.r4b.Lc,Da.r4b.qj,Da.AH,jb)}}Object(m.a)(fh,"RttDeleteParagraphOp",
$g,[676,702]);class zg extends $g{constructor(Da,jb,ic,Lc,ad,ce,fc,kf){super(5,kf);this.dpg=Da;this.yxj=jb;this.o2o=ic;this.rGo=Lc;this.AH=ad;this.oKj=ce;this.Zkc=fc}get Lc(){return this.dpg}get qj(){return this.yxj}get d1(){return this.dpg===this.oKj?this.Zkc:0}serialize(){const Da=new Se.a(5,this.dpg,this.yxj,null,this.o2o,this.rGo,null,this.AH),jb=new ub(this.oKj,this.Zkc);return new Ac(this.metadata.packetId,this.metadata.clientId,1,6,Da,null,void 0,void 0,void 0,jb,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Da){const jb=
Da.fT,ic=Da.MYc;return new zg(jb.JRa,jb.j7a,jb.BGa,jb.Ykc,jb.AH,ic.EXf,ic.Zkc,Za.create(Da))}static g$l(Da,jb){return 2!==Da.type?null:new zg(Da.cpa.Lc,Da.cpa.qj,Da.rRa.Lc,Da.rRa.qj,Da.AH,Da.V3d.Lc,Da.V3d.qj,jb)}}Object(m.a)(zg,"RttMergeParagraphOp",$g,[676,702]);class em{constructor(Da,jb,ic,Lc,ad,ce){this.CAc=this.fj=null;this.gea=!1;this.eVe=this.Lih=0;this.kvd=this.Xjh=!1;this.iQe=0;this.CVf=()=>{l.ULS.sendTraceTag(8245954,355,50,"All prerequisites ready for RttSendManager");this.fj=this.GZ.result;
this.fj.zce(this)};this.kVi=(fc,kf)=>{if(this.fj&&2===this.fj.connectionState&&(fc=kf.jF,fc.length))if(kf.p7)100>this.eVe&&(this.eVe++,l.ULS.sendTraceTag(8270467,355,50,"Blocking send. Reason: {0} OverallSends: {1} OverallBlocked: {2}",kf.rJk,this.Lih,this.eVe));else{for(kf=0;kf<fc.length;kf++)if(!this.USm(fc[kf]))return;for(kf=0;kf<fc.length;kf++){const Tc=fc[kf];this.Ddh.Dtk(Tc,!Tc.type&&!kf)}this.CAc||this.OUi(this.CAc,this.fj)}};this.GZ=Da;this.Ddh=jb;this.Qab=ic;this.Mt=Lc;this.pta=ad;this.sYb=
ce}get un(){return this.Qab.value}init(){return this.GZ?this.GZ.continueWith(this.CVf):G.Task.J3(!1)}start(){this.gea||(this.Mt.Uc?(this.Mt.Uc.jF.zxk(this.kVi),this.gea=!0):l.ULS.sendTraceTag(522740420,355,10,"No activePage, RttSendManager not started"))}stop(){this.gea&&(this.gea=!1,this.Mt.Uc.jF.D_n(this.kVi))}USm(Da){return Da&&-1!==Da.AH?Da.type&&3!==Da.type&&1!==Da.type?!1:!0:!1}c5m(){this.kvd||(this.Xjh||(l.ULS.sendTraceTag(8270468,355,50,"Preparing to send RTT change"),this.Xjh=!0),!this.kvd&&
5>=this.iQe&&this.iQe++)}r5m(){!this.kvd&&5>=this.iQe&&(l.ULS.sendTraceTag(8270469,355,50,"Sent Rtt Message"),this.kvd=!0)}OUi(Da,jb){this.c5m();Da&&(Da.Ci||Da.zo)&&l.ULS.sendTraceTag(8245956,355,15,"Task is faulted or cancelled with exception {0}",Da.exception);this.sYb.X6i();(Da=this.h$l(this.Ddh.I2l()))?(this.Lih++,this.CAc=jb.XM(3,Ae(Da.serialize())),this.r5m(),this.sYb.l3f(0),this.CAc.continueWith(ic=>{this.OUi(ic,jb)})):this.CAc=null}h$l(Da){if(!Da)return null;if(!this.un)return l.ULS.sendTraceTag(8245957,
355,15,"GetParagraphAnchoredOpFromGraphTransactionOperation: CoAuth manager is null"),null;const jb=new Za(sg.instance.tbi(),this.un.kj,1,0,0,ef.instance.Z2l());let ic=null;switch(Da.type){case 0:ic=Mj.g9l(Da,jb,this.pta);break;case 4:ic=fh.f$l(Da,jb);break;case 3:ic=ye.e$l(Da,jb);break;case 2:ic=zg.g$l(Da,jb);break;case 1:ic=Hb.i$l(Da,jb,this.pta)}return ic}}Object(m.a)(em,"RttSendManager",null,[673]);class fo{constructor(){this.W=null;this.G0l=()=>Fa.App.rd&&Fa.App.rd.kq?Fa.App.rd.kq:(l.ULS.sendTraceTag(7866377,
304,15,"Unable to get the lock manager"),null)}get name(){return"WordEditor.RealTimeTyping"}xc(Da){const jb=Ma.a.Ap(Da.Sa("Box4.IOutlineElementEditor")),ic=Ma.a.Ap(Da.Sa("Box4.IFeatureHelper")),Lc=Ma.a.Ap(Da.Sa("Common.IActivityAggregationInfo")),ad=Ma.a.Ap(Da.Sa("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator")),ce=Ma.a.Ap(Da.Sa("Box4.CompositionStateManager"));this.W=Da;const fc=new Ik.a;G.Task.WAA.call(null,jb,ic,Lc,ad,ce).continueWith(()=>{Da.ha("WordEditor.RealTimeTyping.IRttEditor",
()=>new $b(Da.resolve("Box4.ICharacterPropertiesEditor"),Da.resolve("Box4.IOutlineElementEditor"),fc,Da.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"))).singleInstance();Da.register(rl,"WordEditor.RttPerfCounter").as("WordEditor.IRttPerfCounter").singleInstance().Rd(()=>new rl(wb.a.$e,sj.a.eF(17,1,new Nn.a(new Sg.a(.25)))));Da.ha("WordEditor.RealTimeTyping.RttManager",()=>new bi(Da.resolve("WordEditor.RealTimeTyping.IRttEditor"),new Vf(Rf.a.instance),new W.a(this.G0l),new W.a(()=>
Fa.App.fV),Da.resolve("WordEditor.ParagraphWordIdMapping"),Da.resolve("Box4.Presence.IRtcProxyProvider").OD(),new W.a(()=>Fa.App.ya.gb&&Fa.App.ya.gb.Uc?Fa.App.ya.gb.Uc.od:(l.ULS.sendTraceTag(522740419,304,10,"No activePage or workspace."),null)),gc.a.instance,()=>Date.now(),Da.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Rf.a.instance,Da.Sa("Common.IActivityAggregationInfo"),hd.OD(),fc,n.AFrameworkApplication.K.$("WordEditorThrottleAndBatchRTTRendering"),Da.resolve("WordEditor.IRttPerfCounter"),
new ii,Da.Sa("WordEditor.Presence.IWordPresenceCpFactory"),Da.resolve("Box4.CompositionStateManager"))).as("WordEditor.RealTimeTyping.IRttManager").singleInstance();Da.ha("WordEditor.RealTimeTyping.RttSendManager",()=>new em(Da.resolve("Box4.Presence.IRtcProxyProvider").OD(),new be,new W.a(()=>Fa.App.rd),Fa.App.ya.gb,Da.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Da.resolve("WordEditor.IRttPerfCounter"))).singleInstance();this.pzf()})}pzf(){this.W.resolve("WordEditor.RealTimeTyping.RttManager").init();
this.W.resolve("WordEditor.RealTimeTyping.RttSendManager").init()}init(){}dispose(){}static main(){Ia.a.instance.Fc(new fo)}}Object(m.a)(fo,"WordEditorRealTimeTypingPackage",null,[1,2]);Type.registerNamespace("BPr");Type.registerNamespace("Box4.Presence");Type.registerNamespace("RealtimePresenceUI");Type.registerNamespace("WERTT");Type.registerNamespace("WordEditor.PeoplesWellControl");Type.registerNamespace("WordEditor.Presence");Type.registerNamespace("AppRealtimeChannel");Type.registerNamespace("Common.App.CoauthTelemetry");
sa.main();Type.registerNamespace("Common.App.CollabControls");eb.prototype.toString=Ca.a.prototype.toString;ib.prototype.toString=Ca.a.prototype.toString;Ia.a.instance.Fc(new pf);fo.main();Type.registerNamespace("RealtimePresenceUI");Ia.a.instance.Fc(new he);Type.registerNamespace("Common.App.RtcHostNotificationSubscription");oa.main()}}]);

//# sourceMappingURL=https://res-dev.cdn.officeppe.net/1js/build/19580616/wdjs/WordEditorDS.collab.js.map